{
  "schema": "olm.package",
  "name": "costmanagement-metrics-operator",
  "defaultChannel": "stable",
  "icon": {
    "base64data": "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIyLjEuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAzMDAgMzAwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAzMDAgMzAwOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0VFMDAwMDt9Cjwvc3R5bGU+Cjx0aXRsZT5Db3N0LWljb248L3RpdGxlPgo8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KPGc+Cgk8Zz4KCQk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNMjM5LjAzNzAzMzEsMTE3LjI3NTE3N2MtMy4yNjU4MDgxLTQxLjk4OTA1MTgtMzguMjU2NjgzMy03NC42NDcyMDE1LTgxLjE3ODgzMy03NC42NDcyMDE1CgkJCWMtMjcuNTI2MTUzNiwwLTUzLjE4NjEyNjcsMTMuOTk2MzQ5My02OC4xMTU1NzAxLDM3LjMyMzYwMDhjLTEuODY2MTgwNCwwLTMuNzMyMzUzMi0wLjQ2NjU0NTEtNi4wNjUwNzg3LTAuNDY2NTQ1MQoJCQljLTM0LjUyNDMzMDEsMC02Mi45ODM1Nzc3LDI3Ljk5MjY5ODctNjIuOTgzNTc3Nyw2Mi45ODM1NjYzczI3Ljk5MjY5ODcsNjIuOTgzNTY2Myw2Mi45ODM1Nzc3LDYyLjk4MzU2NjNoMTYuMzI5MDcxCgkJCWMzLjczMjM2MDgsMCw2Ljk5ODE3NjYtMy4yNjU4MDgxLDYuOTk4MTc2Ni02Ljk5ODE2ODlzLTMuMjY1ODE1Ny02Ljk5ODE2ODktNi45OTgxNzY2LTYuOTk4MTY4OWgtMTYuMzI5MDcxCgkJCWMtMjcuMDU5NjEyMywwLTQ4LjUyMDY3OTUtMjEuOTI3NjI3Ni00OC41MjA2Nzk1LTQ4LjUyMDY3NTdzMjEuOTI3NjEyMy00OC41MjA2ODMzLDQ4LjUyMDY3OTUtNDguNTIwNjgzMwoJCQljMi43OTkyNzA2LDAsNS41OTg1NDEzLDAuNDY2NTQ1MSw4LjM5NzgwNDMsMC45MzMwOTAyYzIuNzk5MjcwNiwwLjQ2NjU0NTEsNi4wNjUwNzg3LTAuOTMzMDkwMiw3LjQ2NDcyMTctMy43MzIzNjA4CgkJCWMxMi4xMzAxNzI3LTIwLjk5NDUyOTcsMzQuNTI0MzMwMS0zNC4wNTc3ODg4LDU4LjMxODEyMjktMzQuMDU3Nzg4OGMzNi44NTcwNzA5LDAsNjcuMTgyNDk1MSwzMC4zMjU0MjA0LDY3LjE4MjQ5NTEsNjcuMTgyNDc5OQoJCQljMCwzLjczMjM1MzIsMy4yNjU4MDgxLDYuOTk4MTc2Niw2Ljk5ODE2ODksNi45OTgxNzY2YzE2LjMyOTA3MSwwLDI5Ljg1ODkwMiwxMy41Mjk4MDA0LDI5Ljg1ODkwMiwyOS44NTg4NzE1CgkJCXMtMTMuNTI5ODMwOSwyOS44NTg4ODY3LTI5Ljg1ODkwMiwyOS44NTg4ODY3Yy0zLjczMjM2MDgsMC02Ljk5ODE2ODksMy4yNjU4MDgxLTYuOTk4MTY4OSw2Ljk5ODE2ODkKCQkJczMuMjY1ODA4MSw2Ljk5ODE2ODksNi45OTgxNjg5LDYuOTk4MTY4OWMyNC4yNjAzMzAyLDAsNDQuMzIxNzYyMS0yMC4wNjE0MTY2LDQ0LjMyMTc2MjEtNDQuMzIxNzYyMQoJCQlDMjc2LjM2MDYyNjIsMTM5LjIwMjc4OTMsMjYwLjAzMTU1NTIsMTIwLjU0MDk5MjcsMjM5LjAzNzAzMzEsMTE3LjI3NTE3N3oiLz4KCQk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNMjA2Ljg0NTQyODUsMjIwLjg0ODE3NWM3LjQ2NDcwNjQtOC44NjQzNjQ2LDExLjY2MzYyLTIwLjUyNzk4NDYsMTEuNjYzNjItMzIuNjU4MTU3MwoJCQljMC0yOC45MjU3OTY1LTIzLjMyNzI0LTUyLjI1MzAzNjUtNTIuMjUzMDM2NS01Mi4yNTMwMzY1cy01Mi4yNTMwNDQxLDIzLjMyNzI0LTUyLjI1MzA0NDEsNTIuMjUzMDM2NQoJCQlzMjMuMzI3MjQ3Niw1Mi4yNTMwNTE4LDUyLjI1MzA0NDEsNTIuMjUzMDUxOGMxMS4xOTcwODI1LDAsMjEuOTI3NjEyMy0zLjczMjM2MDgsMzAuMzI1NDI0Mi05Ljc5NzQzOTZsMzEuNzI1MDUxOSwzMC43OTE5NjE3CgkJCWMxLjM5OTYyNzcsMS4zOTk2Mjc3LDMuMjY1ODIzNCwxLjg2NjE4MDQsNS4xMzE5ODg1LDEuODY2MTgwNGMxLjg2NjE5NTcsMCwzLjczMjM2MDgtMC45MzMwNzUsNS4xMzE5ODg1LTIuMzMyNzMzMgoJCQljMi43OTkyNzA2LTIuNzk5MjU1NCwyLjc5OTI3MDYtNy40NjQ3MDY0LDAtMTAuMjYzOTc3MUwyMDYuODQ1NDI4NSwyMjAuODQ4MTc1eiBNMTI4LjQ2NTg2NjEsMTg4LjE5MDAxNzcKCQkJYzAtMjAuOTk0NTIyMSwxNy4yNjIxNzY1LTM4LjI1NjY5ODYsMzguMjU2Njk4Ni0zOC4yNTY2OTg2czM4LjI1NjY5ODYsMTcuMjYyMTc2NSwzOC4yNTY2OTg2LDM4LjI1NjY5ODYKCQkJcy0xNy4yNjIxNzY1LDM4LjI1NjY5ODYtMzguMjU2Njk4NiwzOC4yNTY2OTg2UzEyOC40NjU4NjYxLDIwOS4xODQ1Mzk4LDEyOC40NjU4NjYxLDE4OC4xOTAwMTc3eiIvPgoJPC9nPgoJPGc+CgkJPHBhdGggY2xhc3M9InN0MCIgZD0iTTE3NC4yODA2Mzk2LDE4NS44NzM2MTE1YzIuMjE2Mjc4MSwwLjY4NjUzODcsNC4xMTAwMzExLDEuODcwNzEyMyw1LjY3NjYzNTcsMy41NTI1MDU1CgkJCWMxLjU2NjYwNDYsMS42ODE4MDg1LDIuNTk4NzA5MSwzLjY0OTI2MTUsMy4wOTE3MzU4LDUuOTAyNDA0OGMwLjQ5NzYxOTYsMi4yNTMxNDMzLDAuMzYzOTk4NCw0LjUyOTMyNzQtMC40MDA4Nzg5LDYuODE5MzM1OQoJCQljLTAuOTE2OTE1OSwyLjUyMDM4NTctMi40ODM1MjA1LDQuNTI5MzEyMS00LjY5OTc5ODYsNi4wMTc1OTM0Yy0yLjIxNjI2MjgsMS40ODgyODEyLTQuNjk1MjA1NywyLjI3MTU3NTktNy40NTA1NzY4LDIuMzQ5ODk5MwoJCQl2NS41MDE1NTY0YzAsMC41MzQ0ODQ5LTAuMTcwNDcxMiwwLjk3MjIxMzctMC41MTE0NTk0LDEuMzE3Nzc5NWMtMC4zNDU1NjU4LDAuMzQ1NTgxMS0wLjc4MzI5NDcsMC41MTYwNjc1LTEuMzIyMzg3NywwLjUxNjA2NzUKCQkJaC0zLjY2NzY5NDFjLTAuNTM0NTAwMSwwLTAuOTcyMjEzNy0wLjE3MDQ4NjUtMS4zMTc3Nzk1LTAuNTE2MDY3NWMtMC4zNDA5NzI5LTAuMzQ1NTY1OC0wLjUxNjA2NzUtMC43ODMyOTQ3LTAuNTE2MDY3NS0xLjMxNzc3OTUKCQkJdi01LjUwMTU1NjRjLTMuNjY3Njk0MSwwLTYuOTg5ODIyNC0xLjE0NzI5MzEtOS45Njg2NTg0LTMuNDM3MzAxNmMtMC4zODI0NDYzLTAuMzgyNDMxLTAuNjEyODIzNS0wLjg0MzIwMDctMC42ODg4NDI4LTEuMzc3NzAwOAoJCQljLTAuMDc2MDM0NS0wLjUzNDQ4NDksMC4xMTUxODg2LTEuMDMyMTA0NSwwLjU3MzYzODktMS40ODgyNTA3bDMuODk1NzgyNS0zLjg5ODA4NjUKCQkJYzAuMzA4NzAwNi0wLjIzMDM5MjUsMC42NjgxMDYxLTAuMzgyNDMxLDEuMDkyMDEwNS0wLjQ1NjE2MTVjMC40MTkyOTYzLTAuMDc4MzIzNCwwLjgyMDE1OTksMC4wMzY4NSwxLjIwMjYwNjIsMC4zNDA5NzI5CgkJCWMxLjE0NzI5MzEsMC43NjQ4NzczLDIuNDQyMDQ3MSwxLjE0NzMwODMsMy44OTM0NjMxLDEuMTQ3MzA4M2g3LjY4MDk1NGMwLjkxNjk0NjQsMCwxLjcwMDI0MTEtMC4zMjI1NDAzLDIuMzQ5ODk5My0wLjk3MjIxMzcKCQkJYzAuNjQ5Njg4Ny0wLjY0OTY4ODcsMC45NzIyMjktMS40NzQ0NTY4LDAuOTcyMjI5LTIuNDY1MTAzMWMwLTAuNjg2NTU0LTAuMjI1NzY5LTEuMzM2MjI3NC0wLjY4NjUzODctMS45NDkwMzU2CgkJCWMtMC40NTYxNjE1LTAuNjEyODIzNS0xLjAzMjExOTgtMS4wMzIxMTk4LTEuNzE4NjQzMi0xLjI2MjQ5NjlsLTExLjgwNDg0MDEtMy40MzczMTY5CgkJCWMtMi41OTg2OTM4LTAuNzY0ODc3My00Ljc3MzUyOTEtMi4xMzc5NTQ3LTYuNTMzNjQ1Ni00LjEyODQ0ODVjLTEuNzU3ODEyNS0xLjk4NTkwMDktMi43ODc2NDM0LTQuMjc1OTI0Ny0zLjA5NDAzOTktNi44NzQ2MzM4CgkJCWMtMC4xNTIwNTM4LTIuNDQ2NjU1MywwLjMwNjM5NjUtNC43MTgyMzEyLDEuMzc1Mzk2Ny02LjgxOTMzNTljMS4wNjg5Njk3LTIuMTAxMDg5NSwyLjU5ODcwOTEtMy43ODI4ODI3LDQuNTg0NjEtNS4wNDUzNzk2CgkJCWMxLjk4NTkwMDktMS4yNTc4ODg4LDQuMjAyMTc5LTEuODg5MTI5Niw2LjY0ODg0OTUtMS44ODkxMjk2aDAuMjI1NzY5di01LjUwMTU0MTEKCQkJYzAtMC41MzQ1MDAxLDAuMTc1MDk0Ni0wLjk3MjIyOSwwLjUxNjA2NzUtMS4zMTc3OTQ4YzAuMzQ1NTY1OC0wLjM0NTU4MTEsMC43ODMyNzk0LTAuNTE2MDUyMiwxLjMxNzc3OTUtMC41MTYwNTIyaDMuNjY3Njk0MQoJCQljMC41MzkwOTMsMCwwLjk3NjgyMTksMC4xNzA0NzEyLDEuMzIyMzg3NywwLjUxNjA1MjJjMC4zNDA5ODgyLDAuMzQ1NTY1OCwwLjUxMTQ1OTQsMC43ODMyOTQ3LDAuNTExNDU5NCwxLjMxNzc5NDh2NS41MDE1NDExCgkJCWMzLjY2NzY5NDEsMCw2Ljk1NzU2NTMsMS4xNDcyOTMxLDkuODYwMzgyMSwzLjQzNzMwMTZjMC40NTYxNzY4LDAuMzgyNDQ2MywwLjcyMzQxOTIsMC44NDMyMDA3LDAuODAxNzQyNiwxLjM3NzY4NTUKCQkJYzAuMDczNzE1MiwwLjUzNDUwMDEtMC4xMTUyMDM5LDAuOTkwNjQ2NC0wLjU3MTM1MDEsMS4zNzMwNzc0bC0zLjg5ODA4NjUsNC4wMTMyNzUxCgkJCWMtMC4zMDg3MTU4LDAuMjMwMzkyNS0wLjY2ODEwNjEsMC4zODI0MzEtMS4wOTIwMTA1LDAuNDU2MTYxNWMtMC40MTkyOTYzLDAuMDc4MzIzNC0wLjgyMDE1OTksMC0xLjIwMjU5MDktMC4yMjU3NjkKCQkJYy0xLjE0MjcxNTUtMC44NDMyMDA3LTIuNDQyMDc3Ni0xLjI2MjQ5NjktMy44OTgwODY1LTEuMjYyNDk2OWgtNy42NzYzNjExYy0wLjkxNjkxNTksMC0xLjcwMDIyNTgsMC4zMjI1MjUtMi4zNDk4OTkzLDAuOTcyMjEzNwoJCQljLTAuNjQ5Njg4NywwLjY0OTY3MzUtMC45NzY4MjE5LDEuNDc0NDQxNS0wLjk3NjgyMTksMi40NjUwODc5YzAsMC42ODY1NTQsMC4yMzAzOTI1LDEuMzM2MjEyMiwwLjY5MTE0NjksMS45NDkwMzU2CgkJCWMwLjQ1NjE2MTUsMC42MTI4MjM1LDEuMDMyMTE5OCwxLjAzMjExOTgsMS43MTg2NTg0LDEuMjYyNDk2OUwxNzQuMjgwNjM5NiwxODUuODczNjExNXoiLz4KCTwvZz4KPC9nPgo8L3N2Zz4K",
    "mediatype": "image/svg+xml"
  }
}
{
  "schema": "olm.channel",
  "name": "stable",
  "package": "costmanagement-metrics-operator",
  "entries": [
    {
      "name": "costmanagement-metrics-operator.1.0.0"
    },
    {
      "name": "costmanagement-metrics-operator.1.1.0",
      "replaces": "costmanagement-metrics-operator.1.0.0"
    },
    {
      "name": "costmanagement-metrics-operator.1.1.3",
      "replaces": "costmanagement-metrics-operator.1.1.0"
    },
    {
      "name": "costmanagement-metrics-operator.1.1.4",
      "replaces": "costmanagement-metrics-operator.1.1.3"
    },
    {
      "name": "costmanagement-metrics-operator.1.1.5",
      "replaces": "costmanagement-metrics-operator.1.1.4"
    },
    {
      "name": "costmanagement-metrics-operator.1.1.6",
      "replaces": "costmanagement-metrics-operator.1.1.5"
    },
    {
      "name": "costmanagement-metrics-operator.1.1.7",
      "replaces": "costmanagement-metrics-operator.1.1.6"
    },
    {
      "name": "costmanagement-metrics-operator.1.1.8",
      "replaces": "costmanagement-metrics-operator.1.1.7"
    },
    {
      "name": "costmanagement-metrics-operator.1.1.9",
      "replaces": "costmanagement-metrics-operator.1.1.8"
    },
    {
      "name": "costmanagement-metrics-operator.1.2.0",
      "replaces": "costmanagement-metrics-operator.1.1.9"
    },
    {
      "name": "costmanagement-metrics-operator.2.0.0",
      "replaces": "costmanagement-metrics-operator.1.2.0"
    },
    {
      "name": "costmanagement-metrics-operator.3.0.0",
      "replaces": "costmanagement-metrics-operator.2.0.0"
    },
    {
      "name": "costmanagement-metrics-operator.3.0.1",
      "replaces": "costmanagement-metrics-operator.3.0.0"
    },
    {
      "name": "costmanagement-metrics-operator.3.1.0",
      "replaces": "costmanagement-metrics-operator.3.0.1"
    },
    {
      "name": "costmanagement-metrics-operator.3.1.1",
      "replaces": "costmanagement-metrics-operator.3.1.0"
    },
    {
      "name": "costmanagement-metrics-operator.3.2.0",
      "replaces": "costmanagement-metrics-operator.3.1.1"
    },
    {
      "name": "costmanagement-metrics-operator.3.2.1",
      "replaces": "costmanagement-metrics-operator.3.2.0"
    },
    {
      "name": "costmanagement-metrics-operator.3.3.0",
      "replaces": "costmanagement-metrics-operator.3.2.1"
    },
    {
      "name": "costmanagement-metrics-operator.3.3.1",
      "replaces": "costmanagement-metrics-operator.3.3.0"
    }
  ]
}
{
  "schema": "olm.bundle",
  "name": "costmanagement-metrics-operator.1.0.0",
  "package": "costmanagement-metrics-operator",
  "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:70fa64452d13ec5e1ed1abb9b87029cc8e9fec9a5288640326a43d854d01f087",
  "properties": [
    {
      "type": "olm.gvk",
      "value": {
        "group": "costmanagement-metrics-cfg.openshift.io",
        "kind": "CostManagementMetricsConfig",
        "version": "v1beta1"
      }
    },
    {
      "type": "olm.package",
      "value": {
        "packageName": "costmanagement-metrics-operator",
        "version": "1.0.0"
      }
    },
    {
      "type": "olm.csv.metadata",
      "value": {
        "annotations": {
          "alm-examples": "[\n  {\n    \"apiVersion\": \"costmanagement-metrics-cfg.openshift.io/v1beta1\",\n    \"kind\": \"CostManagementMetricsConfig\",\n    \"metadata\": {\n      \"name\": \"costmanagementmetricscfg-sample-v1beta1\"\n    },\n    \"spec\": {\n      \"authentication\": {\n        \"type\": \"token\"\n      },\n      \"packaging\": {\n        \"max_reports_to_store\": 30,\n        \"max_size_MB\": 100\n      },\n      \"prometheus_config\": {},\n      \"source\": {\n        \"check_cycle\": 1440,\n        \"create_source\": false,\n        \"name\": \"INSERT-SOURCE-NAME\"\n      },\n      \"upload\": {\n        \"upload_cycle\": 360,\n        \"upload_toggle\": true\n      }\n    }\n  }\n]",
          "capabilities": "Seamless Upgrades",
          "categories": "Monitoring",
          "certified": "false",
          "containerImage": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:806ddc53720ba0a6b0e6b9ab7b1c4da5502c66dae3008bfdfce36edeb23eb8d8",
          "createdAt": "2021-02-16T16:03:12Z",
          "description": "A Golang-based OpenShift Operator that generates and uploads OpenShift usage metrics to cost management.",
          "operatorframework.io/suggested-namespace": "costmanagement-metrics-operator",
          "operators.openshift.io/infrastructure-features": "[\"Disconnected\"]",
          "operators.operatorframework.io/builder": "operator-sdk-v0.19.4",
          "operators.operatorframework.io/project_layout": "go.kubebuilder.io/v2",
          "repository": "https://github.com/project-koku/koku-metrics-operator",
          "support": "Red Hat"
        },
        "apiServiceDefinitions": {},
        "crdDescriptions": {
          "owned": [
            {
              "name": "costmanagementmetricsconfigs.costmanagement-metrics-cfg.openshift.io",
              "version": "v1beta1",
              "kind": "CostManagementMetricsConfig",
              "description": "CostManagementMetricsConfig is the Schema for the costmanagementmetricsconfig API"
            }
          ]
        },
        "description": "# 1.0.0 Cost Management Metrics Operator\n## Introduction\nThe `costmanagement-metrics-operator` is a component of the [cost managment](https://access.redhat.com/documentation/en-us/openshift_container_platform/4.5/html/getting_started_with_cost_management/assembly_introduction_cost_management) service for Openshift, used to gather the required information from the cluster. It is recommended to be installed in OpenShift 4.6+. This operator obtains OpenShift usage data by querying Prometheus and uploads it to cost management to be processed. The Operator queries Prometheus every hour to create metric reports, which are then packaged and uploaded to cost management at [cloud.redhat.com](https://cloud.redhat.com). For more information, reach out to <costmanagement@redhat.com>.\n\nThis operator is capable of functioning within a disconnected/restricted network (aka air-gapped mode). In this mode, the operator will store the packaged reports for manual retrieval instead of being uploaded to cost management. Documentation for installing an operator within a restricted network can be found [here](https://docs.openshift.com/container-platform/4.5/operators/admin/olm-restricted-networks.html).\n\nFor more information, reach out to <costmanagement@redhat.com>.\n## Features and Capabilities\n#### Metrics collection:\nThe Cost Management Metrics Operator (`costmanagement-metrics-operator`) collects the metrics required for cost management by:\n* Querying Prometheus to gather the necessary metrics for cost management.\n* Writing Prometheus queries to CSV report files.\n* Packaging the CSV report files into tarballs.\n\n#### Additional Capabilities:\n* The operator can be configured to automatically upload the packaged reports to cost management through Red Hat Insights Ingress service.\n* The operator can create a source in cloud.redhat.com. A source is required for cost management to process the uploaded packages.\n* PersistentVolumeClaim (PVC) configuration: The CostManagementMetricsConfig CR can accept a PVC definition and the operator will create and mount the PVC. If one is not provided, a default PVC will be created.\n* Restricted network installation: this operator can function on a restricted network. In this mode, the operator stores the packaged reports for manual retrieval.\n\n## Limitations and Pre-Requisites\n#### Limitations (Potential for metrics data loss)\n* A source **must** exist in cloud.redhat.com for an uploaded payload to be processed by cost management. The operator sends the payload to the Red Hat Insights Ingress service which usually returns successfully, but the operator does not currently confirm with cost management that the payload was processed. After Ingress accepts the uploaded payload, the payload is removed from the operator and is gone forever. If the data within the payload is not processed, a gap will be introduced in the usage metrics.\n\n**Note** The following limitations are specific to operators configured to run in a restricted network:\n* The `costmanagement-metrics-operator` will not be able to generate new reports if the PVC storage is filled. If this occurs, the reports must be manually deleted from the PVC so that the operator can function as normal.\n* The default report retention is 30 reports (about one week's worth of data). The reports must be manually downloaded and uploaded to cloud.redhat.com every week, or they will be deleted and the data will be lost.\n\n#### Storage configuration prerequisite\nThe operator will attempt to create and use the following PVC when installed:\n\n      volume_claim_template:\n        apiVersion: v1\n        kind: PersistentVolumeClaim\n        metadata:\n          name: costmanagement-metrics-operator-data\n        spec:\n          accessModes:\n            - ReadWriteOnce\n          resources:\n            requests:\n              storage: 10Gi\n\nIf a different PVC should be utilized, a valid PVC should be specified in the CostManagementMetricsConfig CR as described in the appropriate section below. The PVC to be used may exist already, or the operator will attempt to create it.\n\nTo use the default specification, the follow assumptions must be met:\n1. A default StorageClass is defined.\n2. Dynamic provisioning for that default StorageClass is enabled.\n\nIf these assumptions are not met, the operator will not deploy correctly. In these cases, storage must be manually configured. After configuring storage, a valid PVC template should be supplied in the `volume_claim_template` spec of the CostManagementMetricsConfig CR.\n\n## Configure the costmanagement-metrics-operator\n**Note** There are separate instructions for configuring the `costmanagement-metrics-operator` to run in a restricted network.\n##### Configure authentication\nThe default authentication for the operator is `token`. No further steps are required to configure token authentication. If `basic` is the preferred authentication method, a Secret must be created which holds username and password credentials:\n1. On the left navigation pane, select `Workloads` -> `Secrets` -> select Project: `costmanagement-metrics-operator` -> `Create` -> `Key/Value Secret`\n2. Give the Secret a name and add 2 keys: `username` and `password` (all lowercase). The values for these keys correspond to cloud.redhat.com credentials.\n3. Select `Create`.\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. For `basic` authentication, edit the following values in the spec:\n    * Replace `authentication: type:` with `basic`.\n    * Add the `secret_name` field under `authentication`, and set it equal to the name of the authentication Secret that was created above. The spec should look similar to the following:\n\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: basic\n        ```\n\n3. To configure the costmanagement-metrics-operator to create a cost management source, edit the following values in the `source` field:\n    * Replace `INSERT-SOURCE-NAME` with the preferred name of the source to be created.\n    * Replace the `create_source` field value with `true`.\n\n    **Note:** if the source already exists, replace `INSERT-SOURCE-NAME` with the existing name, and leave `create_source` as false. This will allow the operator to confirm the source exists.\n4. If not specified, the operator will create a default PersistentVolumeClaim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n5. Select `Create`.\n\n# Restricted Network Usage (disconnected/air-gapped mode)\n## Installation\nTo install the `costmanagement-metrics-operator` in a restricted network, follow the [olm documentation](https://docs.openshift.com/container-platform/4.5/operators/admin/olm-restricted-networks.html). The operator is found in the `community-operators` Catalog in the `registry.redhat.io/redhat/community-operator-index:latest` Index. If pruning the index before pushing to the mirrored registry, keep the `costmanagement-metrics-operator` package.\n\nWithin a restricted network, the operator queries prometheus to gather the necessary usage metrics, writes the query results to CSV files, and packages the reports for storage in the PVC. These reports then need to be manually downloaded from the cluster and uploaded to [cloud.redhat.com](https://cloud.redhat.com).\n\nFor more information, reach out to <costmanagement@redhat.com>.\n## Configure the costmanagement-metrics-operator for a restricted network\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. Specify the desired storage. If not specified, the operator will create a default Persistent Volume Claim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            storageClassName: <insert-class-name>\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n3. (Optional) Specify the desired report retention. The operator will retain 30 reports by default. This corresponds to approximately one week's worth of data if using the default packaging cycle. To modify the number of retained reports:\n    * Change the `packaging` spec field `max_reports_to_store` to the desired number of reports to retain. Once this max number is reached, the operator will start removing the oldest packages remaining on the PVC:\n\n      ```\n        packaging:\n          max_size_MB: 100\n          max_reports_to_store: 30\n      ```\n\n    **Note:** The number of retained reports directly affects the frequency that reports must be manually downloaded from the PVC. Take caution in setting this to a higher number of reports, as the operator cannot write data to the PVC if the storage is full.\n4. To configure the operator to perform in a restricted network, set the `upload_toggle` to `false`:\n\n  ```\n    upload:\n      upload_cycle: 360,\n      upload_toggle: false\n  ```\n\n5. Select `Create`.\n\n## Download reports from the Operator & clean up the PVC\nIf the `costmanagement-metrics-operator` is configured to run in a restricted network, the metric reports will not automatically upload to cost managment. Instead, they need to be manually copied from the PVC for upload to [cloud.redhat.com](https://cloud.redhat.com). The default configuration saves one week of reports which means the process of downloading and uploading reports should be repeated weekly to prevent loss of metrics data. To download the reports, complete the following steps:\n1. Create the following Pod, ensuring the `claimName` matches the PVC containing the report data:\n\n  ```\n  kind: Pod\n  apiVersion: v1\n  metadata:\n    name: volume-shell\n    namespace: costmanagement-metrics-operator\n  spec:\n    volumes:\n    - name: costmanagement-metrics-operator-reports\n      persistentVolumeClaim:\n        claimName: costmanagement-metrics-operator-data\n    containers:\n    - name: volume-shell\n      image: busybox\n      command: ['sleep', '3600']\n      volumeMounts:\n      - name: costmanagement-metrics-operator-reports\n        mountPath: /tmp/costmanagement-metrics-operator-reports\n  ```\n\n2. Use rsync to copy all of the files ready for upload from the PVC to a local folder:\n\n  ```\n  $ oc rsync volume-shell:/tmp/costmanagement-metrics-operator-reports/upload local/path/to/save/folder\n  ```\n\n3. Once confirming that the files have been successfully copied, use rsh to connect to the pod and delete the contents of the upload folder so that they are no longer in storage:\n\n  ```\n  $ oc rsh volume-shell\n  $ rm /tmp/costmanagement-metrics-operator-reports/upload/*\n  ```\n\n4. (Optional) Delete the pod that was used to connect to the PVC:\n\n  ```\n  $ oc delete -f volume-shell.yaml\n  ```\n\n## Create a source\nIn a restricted network, the `costmanagement-metrics-operator` cannot automatically create a source. This process must be done manually. In the cloud.redhat.com platform, open the [Sources menu](https://cloud.redhat.com/settings/sources/) to begin adding an OpenShift source to cost management:\n\nPrerequisites:\n* The cluster identifier which can be found in the CostManagementMetricsConfig CR, the cluster Overview page, or the cluster Help > About.\n\nCreate source:\n1. Navigate to the Sources menu\n2. Select the `Red Hat sources` tab\n3. Create a new `Red Hat Openshift Container Platform` source:\n    * give the source a unique name\n    * add the Cost Management application\n    * add the cluster identifier\n4. In the Sources wizard, review the details and click `Finish` to create the Source.\n\n## Upload the reports to cost managment\nUploading reports to cost managment is done through curl:\n\n    $ curl -vvvv -F \"file=@FILE_NAME.tar.gz;type=application/vnd.redhat.hccm.tar+tgz\"  https://cloud.redhat.com/api/ingress/v1/upload -u USERNAME:PASS\n\nwhere `USERNAME` and `PASS` correspond to the user credentials for [cloud.redhat.com](https://cloud.redhat.com), and `FILE_NAME` is the name of the report to upload.",
        "displayName": "Cost Management Metrics Operator",
        "installModes": [
          {
            "type": "OwnNamespace",
            "supported": true
          },
          {
            "type": "SingleNamespace",
            "supported": true
          },
          {
            "type": "MultiNamespace",
            "supported": false
          },
          {
            "type": "AllNamespaces",
            "supported": false
          }
        ],
        "keywords": [
          "cost",
          "management",
          "usage",
          "monitor"
        ],
        "maintainers": [
          {
            "name": "costmanagement",
            "email": "costmanagement@redhat.com"
          }
        ],
        "maturity": "alpha",
        "provider": {
          "name": "Red Hat"
        }
      }
    }
  ],
  "relatedImages": [
    {
      "name": "",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:70fa64452d13ec5e1ed1abb9b87029cc8e9fec9a5288640326a43d854d01f087"
    },
    {
      "name": "costmanagement-metrics-rhel8-operator-806ddc53720ba0a6b0e6b9ab7b1c4da5502c66dae3008bfdfce36edeb23eb8d8-annotation",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:806ddc53720ba0a6b0e6b9ab7b1c4da5502c66dae3008bfdfce36edeb23eb8d8"
    },
    {
      "name": "manager",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:806ddc53720ba0a6b0e6b9ab7b1c4da5502c66dae3008bfdfce36edeb23eb8d8"
    }
  ]
}
{
  "schema": "olm.bundle",
  "name": "costmanagement-metrics-operator.1.1.0",
  "package": "costmanagement-metrics-operator",
  "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:f2455392ddf7fe8506a2485835cbbd9c633476344a0cd9353e46c6fa44e4667c",
  "properties": [
    {
      "type": "olm.gvk",
      "value": {
        "group": "costmanagement-metrics-cfg.openshift.io",
        "kind": "CostManagementMetricsConfig",
        "version": "v1beta1"
      }
    },
    {
      "type": "olm.package",
      "value": {
        "packageName": "costmanagement-metrics-operator",
        "version": "1.1.0"
      }
    },
    {
      "type": "olm.csv.metadata",
      "value": {
        "annotations": {
          "alm-examples": "[\n  {\n    \"apiVersion\": \"costmanagement-metrics-cfg.openshift.io/v1beta1\",\n    \"kind\": \"CostManagementMetricsConfig\",\n    \"metadata\": {\n      \"name\": \"costmanagementmetricscfg-sample-v1beta1\"\n    },\n    \"spec\": {\n      \"authentication\": {\n        \"type\": \"token\"\n      },\n      \"packaging\": {\n        \"max_reports_to_store\": 30,\n        \"max_size_MB\": 100\n      },\n      \"prometheus_config\": {},\n      \"source\": {\n        \"check_cycle\": 1440,\n        \"create_source\": false,\n        \"name\": \"INSERT-SOURCE-NAME\"\n      },\n      \"upload\": {\n        \"upload_cycle\": 360,\n        \"upload_toggle\": true\n      }\n    }\n  }\n]",
          "capabilities": "Seamless Upgrades",
          "categories": "Monitoring",
          "certified": "false",
          "containerImage": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:36f3f6385d872f86f498fe221fd4e114b26d7b31f90969e57cd9637db9ea004c",
          "createdAt": "2021-02-16T16:03:12Z",
          "description": "A Golang-based OpenShift Operator that generates and uploads OpenShift usage metrics to cost management.",
          "operatorframework.io/suggested-namespace": "costmanagement-metrics-operator",
          "operators.openshift.io/infrastructure-features": "[\"Disconnected\"]",
          "operators.operatorframework.io/builder": "operator-sdk-v0.19.4",
          "operators.operatorframework.io/project_layout": "go.kubebuilder.io/v2",
          "repository": "https://github.com/project-koku/koku-metrics-operator",
          "support": "Red Hat"
        },
        "apiServiceDefinitions": {},
        "crdDescriptions": {
          "owned": [
            {
              "name": "costmanagementmetricsconfigs.costmanagement-metrics-cfg.openshift.io",
              "version": "v1beta1",
              "kind": "CostManagementMetricsConfig",
              "description": "CostManagementMetricsConfig is the Schema for the costmanagementmetricsconfig API"
            }
          ]
        },
        "description": "# 1.1.0 Cost Management Metrics Operator\n## Introduction\nThe `costmanagement-metrics-operator` is a component of the [cost managment](https://access.redhat.com/documentation/en-us/openshift_container_platform/4.5/html/getting_started_with_cost_management/assembly_introduction_cost_management) service for Openshift, used to gather the required information from the cluster. It is recommended to be installed in OpenShift 4.6+. This operator obtains OpenShift usage data by querying Prometheus and uploads it to cost management to be processed. The Operator queries Prometheus every hour to create metric reports, which are then packaged and uploaded to cost management at [cloud.redhat.com](https://cloud.redhat.com). For more information, reach out to <costmanagement@redhat.com>.\n\nThis operator is capable of functioning within a disconnected/restricted network (aka air-gapped mode). In this mode, the operator will store the packaged reports for manual retrieval instead of being uploaded to cost management. Documentation for installing an operator within a restricted network can be found [here](https://docs.openshift.com/container-platform/4.5/operators/admin/olm-restricted-networks.html).\n\nFor more information, reach out to <costmanagement@redhat.com>.\n## Features and Capabilities\n#### Metrics collection:\nThe Cost Management Metrics Operator (`costmanagement-metrics-operator`) collects the metrics required for cost management by:\n* Querying Prometheus to gather the necessary metrics for cost management.\n* Writing Prometheus queries to CSV report files.\n* Packaging the CSV report files into tarballs.\n\n#### Additional Capabilities:\n* The operator can be configured to automatically upload the packaged reports to cost management through Red Hat Insights Ingress service.\n* The operator can create a source in cloud.redhat.com. A source is required for cost management to process the uploaded packages.\n* PersistentVolumeClaim (PVC) configuration: The CostManagementMetricsConfig CR can accept a PVC definition and the operator will create and mount the PVC. If one is not provided, a default PVC will be created.\n* Restricted network installation: this operator can function on a restricted network. In this mode, the operator stores the packaged reports for manual retrieval.\n\n## Limitations and Pre-Requisites\n#### Limitations (Potential for metrics data loss)\n* A source **must** exist in cloud.redhat.com for an uploaded payload to be processed by cost management. The operator sends the payload to the Red Hat Insights Ingress service which usually returns successfully, but the operator does not currently confirm with cost management that the payload was processed. After Ingress accepts the uploaded payload, the payload is removed from the operator and is gone forever. If the data within the payload is not processed, a gap will be introduced in the usage metrics.\n\n**Note** The following limitations are specific to operators configured to run in a restricted network:\n* The `costmanagement-metrics-operator` will not be able to generate new reports if the PVC storage is filled. If this occurs, the reports must be manually deleted from the PVC so that the operator can function as normal.\n* The default report retention is 30 reports (about one week's worth of data). The reports must be manually downloaded and uploaded to cloud.redhat.com every week, or they will be deleted and the data will be lost.\n\n#### Storage configuration prerequisite\nThe operator will attempt to create and use the following PVC when installed:\n\n      volume_claim_template:\n        apiVersion: v1\n        kind: PersistentVolumeClaim\n        metadata:\n          name: costmanagement-metrics-operator-data\n        spec:\n          accessModes:\n            - ReadWriteOnce\n          resources:\n            requests:\n              storage: 10Gi\n\nIf a different PVC should be utilized, a valid PVC should be specified in the CostManagementMetricsConfig CR as described in the appropriate section below. The PVC to be used may exist already, or the operator will attempt to create it.\n\nTo use the default specification, the follow assumptions must be met:\n1. A default StorageClass is defined.\n2. Dynamic provisioning for that default StorageClass is enabled.\n\nIf these assumptions are not met, the operator will not deploy correctly. In these cases, storage must be manually configured. After configuring storage, a valid PVC template should be supplied in the `volume_claim_template` spec of the CostManagementMetricsConfig CR.\n\n## Configure the costmanagement-metrics-operator\n**Note** There are separate instructions for configuring the `costmanagement-metrics-operator` to run in a restricted network.\n##### Configure authentication\nThe default authentication for the operator is `token`. No further steps are required to configure token authentication. If `basic` is the preferred authentication method, a Secret must be created which holds username and password credentials:\n1. On the left navigation pane, select `Workloads` -> `Secrets` -> select Project: `costmanagement-metrics-operator` -> `Create` -> `Key/Value Secret`\n2. Give the Secret a name and add 2 keys: `username` and `password` (all lowercase). The values for these keys correspond to cloud.redhat.com credentials.\n3. Select `Create`.\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. For `basic` authentication, edit the following values in the spec:\n    * Replace `authentication: type:` with `basic`.\n    * Add the `secret_name` field under `authentication`, and set it equal to the name of the authentication Secret that was created above. The spec should look similar to the following:\n\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: basic\n        ```\n\n3. To configure the costmanagement-metrics-operator to create a cost management source, edit the following values in the `source` field:\n    * Replace `INSERT-SOURCE-NAME` with the preferred name of the source to be created.\n    * Replace the `create_source` field value with `true`.\n\n    **Note:** if the source already exists, replace `INSERT-SOURCE-NAME` with the existing name, and leave `create_source` as false. This will allow the operator to confirm the source exists.\n4. If not specified, the operator will create a default PersistentVolumeClaim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n5. Select `Create`.\n\n# Restricted Network Usage (disconnected/air-gapped mode)\n## Installation\nTo install the `costmanagement-metrics-operator` in a restricted network, follow the [olm documentation](https://docs.openshift.com/container-platform/4.5/operators/admin/olm-restricted-networks.html). The operator is found in the `community-operators` Catalog in the `registry.redhat.io/redhat/community-operator-index:latest` Index. If pruning the index before pushing to the mirrored registry, keep the `costmanagement-metrics-operator` package.\n\nWithin a restricted network, the operator queries prometheus to gather the necessary usage metrics, writes the query results to CSV files, and packages the reports for storage in the PVC. These reports then need to be manually downloaded from the cluster and uploaded to [cloud.redhat.com](https://cloud.redhat.com).\n\nFor more information, reach out to <costmanagement@redhat.com>.\n## Configure the costmanagement-metrics-operator for a restricted network\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. Specify the desired storage. If not specified, the operator will create a default Persistent Volume Claim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            storageClassName: <insert-class-name>\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n3. (Optional) Specify the desired report retention. The operator will retain 30 reports by default. This corresponds to approximately one week's worth of data if using the default packaging cycle. To modify the number of retained reports:\n    * Change the `packaging` spec field `max_reports_to_store` to the desired number of reports to retain. Once this max number is reached, the operator will start removing the oldest packages remaining on the PVC:\n\n      ```\n        packaging:\n          max_size_MB: 100\n          max_reports_to_store: 30\n      ```\n\n    **Note:** The number of retained reports directly affects the frequency that reports must be manually downloaded from the PVC. Take caution in setting this to a higher number of reports, as the operator cannot write data to the PVC if the storage is full.\n4. To configure the operator to perform in a restricted network, set the `upload_toggle` to `false`:\n\n  ```\n    upload:\n      upload_cycle: 360,\n      upload_toggle: false\n  ```\n\n5. Select `Create`.\n\n## Download reports from the Operator & clean up the PVC\nIf the `costmanagement-metrics-operator` is configured to run in a restricted network, the metric reports will not automatically upload to cost managment. Instead, they need to be manually copied from the PVC for upload to [cloud.redhat.com](https://cloud.redhat.com). The default configuration saves one week of reports which means the process of downloading and uploading reports should be repeated weekly to prevent loss of metrics data. To download the reports, complete the following steps:\n1. Create the following Pod, ensuring the `claimName` matches the PVC containing the report data:\n\n  ```\n  kind: Pod\n  apiVersion: v1\n  metadata:\n    name: volume-shell\n    namespace: costmanagement-metrics-operator\n  spec:\n    volumes:\n    - name: costmanagement-metrics-operator-reports\n      persistentVolumeClaim:\n        claimName: costmanagement-metrics-operator-data\n    containers:\n    - name: volume-shell\n      image: busybox\n      command: ['sleep', '3600']\n      volumeMounts:\n      - name: costmanagement-metrics-operator-reports\n        mountPath: /tmp/costmanagement-metrics-operator-reports\n  ```\n\n2. Use rsync to copy all of the files ready for upload from the PVC to a local folder:\n\n  ```\n  $ oc rsync volume-shell:/tmp/costmanagement-metrics-operator-reports/upload local/path/to/save/folder\n  ```\n\n3. Once confirming that the files have been successfully copied, use rsh to connect to the pod and delete the contents of the upload folder so that they are no longer in storage:\n\n  ```\n  $ oc rsh volume-shell\n  $ rm /tmp/costmanagement-metrics-operator-reports/upload/*\n  ```\n\n4. (Optional) Delete the pod that was used to connect to the PVC:\n\n  ```\n  $ oc delete -f volume-shell.yaml\n  ```\n\n## Create a source\nIn a restricted network, the `costmanagement-metrics-operator` cannot automatically create a source. This process must be done manually. In the cloud.redhat.com platform, open the [Sources menu](https://cloud.redhat.com/settings/sources/) to begin adding an OpenShift source to cost management:\n\nPrerequisites:\n* The cluster identifier which can be found in the CostManagementMetricsConfig CR, the cluster Overview page, or the cluster Help > About.\n\nCreate source:\n1. Navigate to the Sources menu\n2. Select the `Red Hat sources` tab\n3. Create a new `Red Hat Openshift Container Platform` source:\n    * give the source a unique name\n    * add the Cost Management application\n    * add the cluster identifier\n4. In the Sources wizard, review the details and click `Finish` to create the Source.\n\n## Upload the reports to cost managment\nUploading reports to cost managment is done through curl:\n\n    $ curl -vvvv -F \"file=@FILE_NAME.tar.gz;type=application/vnd.redhat.hccm.tar+tgz\"  https://cloud.redhat.com/api/ingress/v1/upload -u USERNAME:PASS\n\nwhere `USERNAME` and `PASS` correspond to the user credentials for [cloud.redhat.com](https://cloud.redhat.com), and `FILE_NAME` is the name of the report to upload.",
        "displayName": "Cost Management Metrics Operator",
        "installModes": [
          {
            "type": "OwnNamespace",
            "supported": true
          },
          {
            "type": "SingleNamespace",
            "supported": true
          },
          {
            "type": "MultiNamespace",
            "supported": false
          },
          {
            "type": "AllNamespaces",
            "supported": false
          }
        ],
        "keywords": [
          "cost",
          "management",
          "usage",
          "monitor"
        ],
        "maintainers": [
          {
            "name": "costmanagement",
            "email": "costmanagement@redhat.com"
          }
        ],
        "maturity": "alpha",
        "provider": {
          "name": "Red Hat"
        }
      }
    }
  ],
  "relatedImages": [
    {
      "name": "",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:f2455392ddf7fe8506a2485835cbbd9c633476344a0cd9353e46c6fa44e4667c"
    },
    {
      "name": "costmanagement-metrics-rhel8-operator-36f3f6385d872f86f498fe221fd4e114b26d7b31f90969e57cd9637db9ea004c-annotation",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:36f3f6385d872f86f498fe221fd4e114b26d7b31f90969e57cd9637db9ea004c"
    },
    {
      "name": "manager",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:36f3f6385d872f86f498fe221fd4e114b26d7b31f90969e57cd9637db9ea004c"
    }
  ]
}
{
  "schema": "olm.bundle",
  "name": "costmanagement-metrics-operator.1.1.3",
  "package": "costmanagement-metrics-operator",
  "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:6393be8e83443f0039d5cefd2f4df992986b6b3ec16f7ed38b1a902aa7051091",
  "properties": [
    {
      "type": "olm.gvk",
      "value": {
        "group": "costmanagement-metrics-cfg.openshift.io",
        "kind": "CostManagementMetricsConfig",
        "version": "v1beta1"
      }
    },
    {
      "type": "olm.package",
      "value": {
        "packageName": "costmanagement-metrics-operator",
        "version": "1.1.3"
      }
    },
    {
      "type": "olm.csv.metadata",
      "value": {
        "annotations": {
          "alm-examples": "[\n  {\n    \"apiVersion\": \"costmanagement-metrics-cfg.openshift.io/v1beta1\",\n    \"kind\": \"CostManagementMetricsConfig\",\n    \"metadata\": {\n      \"name\": \"costmanagementmetricscfg-sample-v1beta1\"\n    },\n    \"spec\": {\n      \"authentication\": {\n        \"type\": \"token\"\n      },\n      \"packaging\": {\n        \"max_reports_to_store\": 30,\n        \"max_size_MB\": 100\n      },\n      \"prometheus_config\": {},\n      \"source\": {\n        \"check_cycle\": 1440,\n        \"create_source\": false,\n        \"name\": \"INSERT-SOURCE-NAME\"\n      },\n      \"upload\": {\n        \"upload_cycle\": 360,\n        \"upload_toggle\": true\n      }\n    }\n  }\n]",
          "capabilities": "Seamless Upgrades",
          "categories": "Monitoring",
          "certified": "false",
          "containerImage": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:76c5b8f887c88d79b0225259afeddf41be0bdde316b4dbf85bbc610462127e1b",
          "createdAt": "2021-02-16T16:03:12Z",
          "description": "A Golang-based OpenShift Operator that generates and uploads OpenShift usage metrics to cost management.",
          "operatorframework.io/suggested-namespace": "costmanagement-metrics-operator",
          "operators.openshift.io/infrastructure-features": "[\"Disconnected\"]",
          "operators.operatorframework.io/builder": "operator-sdk-v0.19.4",
          "operators.operatorframework.io/project_layout": "go.kubebuilder.io/v2",
          "repository": "https://github.com/project-koku/koku-metrics-operator",
          "support": "Red Hat"
        },
        "apiServiceDefinitions": {},
        "crdDescriptions": {
          "owned": [
            {
              "name": "costmanagementmetricsconfigs.costmanagement-metrics-cfg.openshift.io",
              "version": "v1beta1",
              "kind": "CostManagementMetricsConfig",
              "description": "CostManagementMetricsConfig is the Schema for the costmanagementmetricsconfig API"
            }
          ]
        },
        "description": "# 1.1.3 Cost Management Metrics Operator\n## Introduction\nThe `costmanagement-metrics-operator` is a component of the [cost managment](https://access.redhat.com/documentation/en-us/cost_management_service) service for Openshift, used to gather the required information from the cluster. It is recommended to be installed in OpenShift 4.6+. This operator obtains OpenShift usage data by querying Prometheus and uploads it to cost management to be processed. The Operator queries Prometheus every hour to create metric reports, which are then packaged and uploaded to cost management at [console.redhat.com](https://console.redhat.com). For more information, reach out to <costmanagement@redhat.com>.\n\nThis operator is capable of functioning within a disconnected/restricted network (aka air-gapped mode). In this mode, the operator will store the packaged reports for manual retrieval instead of being uploaded to cost management. Documentation for installing an operator within a restricted network can be found [here](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html).\n\nFor more information, reach out to <costmanagement@redhat.com>.\n## Features and Capabilities\n#### Metrics collection:\nThe Cost Management Metrics Operator (`costmanagement-metrics-operator`) collects the metrics required for cost management by:\n* Querying Prometheus to gather the necessary metrics for cost management.\n* Writing Prometheus queries to CSV report files.\n* Packaging the CSV report files into tarballs.\n\n#### Additional Capabilities:\n* The operator can be configured to automatically upload the packaged reports to cost management through Red Hat Insights Ingress service.\n* The operator can create a source in console.redhat.com. A source is required for cost management to process the uploaded packages.\n* PersistentVolumeClaim (PVC) configuration: The CostManagementMetricsConfig CR can accept a PVC definition and the operator will create and mount the PVC. If one is not provided, a default PVC will be created.\n* Restricted network installation: this operator can function on a restricted network. In this mode, the operator stores the packaged reports for manual retrieval.\n\n## Limitations and Pre-Requisites\n#### Limitations (Potential for metrics data loss)\n* A source **must** exist in console.redhat.com for an uploaded payload to be processed by cost management. The operator sends the payload to the Red Hat Insights Ingress service which usually returns successfully, but the operator does not currently confirm with cost management that the payload was processed. After Ingress accepts the uploaded payload, the payload is removed from the operator and is gone forever. If the data within the payload is not processed, a gap will be introduced in the usage metrics.\n\n**Note** The following limitations are specific to operators configured to run in a restricted network:\n* The `costmanagement-metrics-operator` will not be able to generate new reports if the PVC storage is filled. If this occurs, the reports must be manually deleted from the PVC so that the operator can function as normal.\n* The default report retention is 30 reports (about one week's worth of data). The reports must be manually downloaded and uploaded to console.redhat.com every week, or they will be deleted and the data will be lost.\n\n#### Storage configuration prerequisite\nThe operator will attempt to create and use the following PVC when installed:\n\n      volume_claim_template:\n        apiVersion: v1\n        kind: PersistentVolumeClaim\n        metadata:\n          name: costmanagement-metrics-operator-data\n        spec:\n          accessModes:\n            - ReadWriteOnce\n          resources:\n            requests:\n              storage: 10Gi\n\nIf a different PVC should be utilized, a valid PVC should be specified in the CostManagementMetricsConfig CR as described in the appropriate section below. The PVC to be used may exist already, or the operator will attempt to create it.\n\nTo use the default specification, the follow assumptions must be met:\n1. A default StorageClass is defined.\n2. Dynamic provisioning for that default StorageClass is enabled.\n\nIf these assumptions are not met, the operator will not deploy correctly. In these cases, storage must be manually configured. After configuring storage, a valid PVC template should be supplied in the `volume_claim_template` spec of the CostManagementMetricsConfig CR.\n\n## Configure the costmanagement-metrics-operator\n**Note** There are separate instructions for configuring the `costmanagement-metrics-operator` to run in a restricted network.\n##### Configure authentication\nThe default authentication for the operator is `token`. No further steps are required to configure token authentication. If `basic` is the preferred authentication method, a Secret must be created which holds username and password credentials:\n1. On the left navigation pane, select `Workloads` -> `Secrets` -> select Project: `costmanagement-metrics-operator` -> `Create` -> `Key/Value Secret`\n2. Give the Secret a name and add 2 keys: `username` and `password` (all lowercase). The values for these keys correspond to console.redhat.com credentials.\n3. Select `Create`.\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. For `basic` authentication, edit the following values in the spec:\n    * Replace `authentication: type:` with `basic`.\n    * Add the `secret_name` field under `authentication`, and set it equal to the name of the authentication Secret that was created above. The spec should look similar to the following:\n\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: basic\n        ```\n\n3. To configure the costmanagement-metrics-operator to create a cost management source, edit the following values in the `source` field:\n    * Replace `INSERT-SOURCE-NAME` with the preferred name of the source to be created.\n    * Replace the `create_source` field value with `true`.\n\n    **Note:** if the source already exists, replace `INSERT-SOURCE-NAME` with the existing name, and leave `create_source` as false. This will allow the operator to confirm the source exists.\n4. If not specified, the operator will create a default PersistentVolumeClaim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n5. Select `Create`.\n\n# Restricted Network Usage (disconnected/air-gapped mode)\n## Installation\nTo install the `costmanagement-metrics-operator` in a restricted network, follow the [olm documentation](https://docs.openshift.com/container-platform/4.5/operators/admin/olm-restricted-networks.html). The operator is found in the `community-operators` Catalog in the `registry.redhat.io/redhat/community-operator-index:latest` Index. If pruning the index before pushing to the mirrored registry, keep the `costmanagement-metrics-operator` package.\n\nWithin a restricted network, the operator queries prometheus to gather the necessary usage metrics, writes the query results to CSV files, and packages the reports for storage in the PVC. These reports then need to be manually downloaded from the cluster and uploaded to [console.redhat.com](https://console.redhat.com).\n\nFor more information, reach out to <costmanagement@redhat.com>.\n## Configure the costmanagement-metrics-operator for a restricted network\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. Specify the desired storage. If not specified, the operator will create a default Persistent Volume Claim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            storageClassName: <insert-class-name>\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n3. (Optional) Specify the desired report retention. The operator will retain 30 reports by default. This corresponds to approximately one week's worth of data if using the default packaging cycle. To modify the number of retained reports:\n    * Change the `packaging` spec field `max_reports_to_store` to the desired number of reports to retain. Once this max number is reached, the operator will start removing the oldest packages remaining on the PVC:\n\n      ```\n        packaging:\n          max_size_MB: 100\n          max_reports_to_store: 30\n      ```\n\n    **Note:** The number of retained reports directly affects the frequency that reports must be manually downloaded from the PVC. Take caution in setting this to a higher number of reports, as the operator cannot write data to the PVC if the storage is full.\n4. To configure the operator to perform in a restricted network, set the `upload_toggle` to `false`:\n\n  ```\n    upload:\n      upload_cycle: 360,\n      upload_toggle: false\n  ```\n\n5. Select `Create`.\n\n## Download reports from the Operator & clean up the PVC\nIf the `costmanagement-metrics-operator` is configured to run in a restricted network, the metric reports will not automatically upload to cost managment. Instead, they need to be manually copied from the PVC for upload to [console.redhat.com](https://console.redhat.com). The default configuration saves one week of reports which means the process of downloading and uploading reports should be repeated weekly to prevent loss of metrics data. To download the reports, complete the following steps:\n1. Create the following Pod, ensuring the `claimName` matches the PVC containing the report data:\n\n  ```\n    kind: Pod\n    apiVersion: v1\n    metadata:\n      name: volume-shell\n      namespace: costmanagement-metrics-operator\n    spec:\n      volumes:\n      - name: costmanagement-metrics-operator-reports\n        persistentVolumeClaim:\n          claimName: costmanagement-metrics-operator-data\n      containers:\n      - name: volume-shell\n        image: busybox\n        command: ['sleep', 'infinity']\n        volumeMounts:\n        - name: costmanagement-metrics-operator-reports\n          mountPath: /tmp/costmanagement-metrics-operator-reports\n  ```\n\n2. Use rsync to copy all of the files ready for upload from the PVC to a local folder:\n\n  ```\n  $ oc rsync volume-shell:/tmp/costmanagement-metrics-operator-reports/upload local/path/to/save/folder\n  ```\n\n3. Once confirming that the files have been successfully copied, use rsh to connect to the pod and delete the contents of the upload folder so that they are no longer in storage:\n\n  ```\n  $ oc rsh volume-shell\n  $ rm /tmp/costmanagement-metrics-operator-reports/upload/*\n  ```\n\n4. (Optional) Delete the pod that was used to connect to the PVC:\n\n  ```\n  $ oc delete -f volume-shell.yaml\n  ```\n\n## Create a source\nIn a restricted network, the `costmanagement-metrics-operator` cannot automatically create a source. This process must be done manually. In the console.redhat.com platform, open the [Sources menu](https://console.redhat.com/settings/sources/) to begin adding an OpenShift source to cost management:\n\nPrerequisites:\n* The cluster identifier which can be found in the CostManagementMetricsConfig CR, the cluster Overview page, or the cluster Help > About.\n\nCreate source:\n1. Navigate to the Sources menu\n2. Select the `Red Hat sources` tab\n3. Create a new `Red Hat Openshift Container Platform` source:\n    * give the source a unique name\n    * add the Cost Management application\n    * add the cluster identifier\n4. In the Sources wizard, review the details and click `Finish` to create the Source.\n\n## Upload the reports to cost managment\nUploading reports to cost managment is done through curl:\n\n    $ curl -vvvv -F \"file=@FILE_NAME.tar.gz;type=application/vnd.redhat.hccm.tar+tgz\"  https://cloud.redhat.com/api/ingress/v1/upload -u USERNAME:PASS\n\nwhere `USERNAME` and `PASS` correspond to the user credentials for [console.redhat.com](https://console.redhat.com), and `FILE_NAME` is the name of the report to upload.",
        "displayName": "Cost Management Metrics Operator",
        "installModes": [
          {
            "type": "OwnNamespace",
            "supported": true
          },
          {
            "type": "SingleNamespace",
            "supported": true
          },
          {
            "type": "MultiNamespace",
            "supported": false
          },
          {
            "type": "AllNamespaces",
            "supported": false
          }
        ],
        "keywords": [
          "cost",
          "management",
          "usage",
          "monitor"
        ],
        "maintainers": [
          {
            "name": "costmanagement",
            "email": "costmanagement@redhat.com"
          }
        ],
        "maturity": "alpha",
        "provider": {
          "name": "Red Hat"
        }
      }
    }
  ],
  "relatedImages": [
    {
      "name": "",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:6393be8e83443f0039d5cefd2f4df992986b6b3ec16f7ed38b1a902aa7051091"
    },
    {
      "name": "costmanagement-metrics-rhel8-operator-76c5b8f887c88d79b0225259afeddf41be0bdde316b4dbf85bbc610462127e1b-annotation",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:76c5b8f887c88d79b0225259afeddf41be0bdde316b4dbf85bbc610462127e1b"
    },
    {
      "name": "manager",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:76c5b8f887c88d79b0225259afeddf41be0bdde316b4dbf85bbc610462127e1b"
    }
  ]
}
{
  "schema": "olm.bundle",
  "name": "costmanagement-metrics-operator.1.1.4",
  "package": "costmanagement-metrics-operator",
  "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:e14493e3b02509690c65016297cf95fc2e4a11a7c97e0f8ca5812e66acbc6c26",
  "properties": [
    {
      "type": "olm.gvk",
      "value": {
        "group": "costmanagement-metrics-cfg.openshift.io",
        "kind": "CostManagementMetricsConfig",
        "version": "v1beta1"
      }
    },
    {
      "type": "olm.package",
      "value": {
        "packageName": "costmanagement-metrics-operator",
        "version": "1.1.4"
      }
    },
    {
      "type": "olm.csv.metadata",
      "value": {
        "annotations": {
          "alm-examples": "[\n  {\n    \"apiVersion\": \"costmanagement-metrics-cfg.openshift.io/v1beta1\",\n    \"kind\": \"CostManagementMetricsConfig\",\n    \"metadata\": {\n      \"name\": \"costmanagementmetricscfg-sample-v1beta1\"\n    },\n    \"spec\": {\n      \"authentication\": {\n        \"type\": \"token\"\n      },\n      \"packaging\": {\n        \"max_reports_to_store\": 30,\n        \"max_size_MB\": 100\n      },\n      \"prometheus_config\": {},\n      \"source\": {\n        \"check_cycle\": 1440,\n        \"create_source\": false,\n        \"name\": \"INSERT-SOURCE-NAME\"\n      },\n      \"upload\": {\n        \"upload_cycle\": 360,\n        \"upload_toggle\": true\n      }\n    }\n  }\n]",
          "capabilities": "Seamless Upgrades",
          "categories": "Monitoring",
          "certified": "false",
          "containerImage": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:2ce0ccd1c76080d4f97683eb3a11bac6848dfa13d231a8ad3f40c2463d977691",
          "createdAt": "2021-02-16T16:03:12Z",
          "description": "A Golang-based OpenShift Operator that generates and uploads OpenShift usage metrics to cost management.",
          "operatorframework.io/suggested-namespace": "costmanagement-metrics-operator",
          "operators.openshift.io/infrastructure-features": "[\"Disconnected\"]",
          "operators.operatorframework.io/builder": "operator-sdk-v0.19.4",
          "operators.operatorframework.io/project_layout": "go.kubebuilder.io/v2",
          "repository": "https://github.com/project-koku/koku-metrics-operator",
          "support": "Red Hat"
        },
        "apiServiceDefinitions": {},
        "crdDescriptions": {
          "owned": [
            {
              "name": "costmanagementmetricsconfigs.costmanagement-metrics-cfg.openshift.io",
              "version": "v1beta1",
              "kind": "CostManagementMetricsConfig",
              "description": "CostManagementMetricsConfig is the Schema for the costmanagementmetricsconfig API"
            }
          ]
        },
        "description": "# 1.1.4 Cost Management Metrics Operator\n## Introduction\nThe `costmanagement-metrics-operator` is a component of the [cost managment](https://access.redhat.com/documentation/en-us/cost_management_service) service for Openshift, used to gather the required information from the cluster. It is recommended to be installed in OpenShift 4.6+. This operator obtains OpenShift usage data by querying Prometheus and uploads it to cost management to be processed. The Operator queries Prometheus every hour to create metric reports, which are then packaged and uploaded to cost management at [console.redhat.com](https://console.redhat.com). For more information, reach out to <costmanagement@redhat.com>.\n\nThis operator is capable of functioning within a disconnected/restricted network (aka air-gapped mode). In this mode, the operator will store the packaged reports for manual retrieval instead of being uploaded to cost management. Documentation for installing an operator within a restricted network can be found [here](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html).\n\nFor more information, reach out to <costmanagement@redhat.com>.\n## Features and Capabilities\n#### Metrics collection:\nThe Cost Management Metrics Operator (`costmanagement-metrics-operator`) collects the metrics required for cost management by:\n* Querying Prometheus to gather the necessary metrics for cost management.\n* Writing Prometheus queries to CSV report files.\n* Packaging the CSV report files into tarballs.\n\n#### Additional Capabilities:\n* The operator can be configured to automatically upload the packaged reports to cost management through Red Hat Insights Ingress service.\n* The operator can create a source in console.redhat.com. A source is required for cost management to process the uploaded packages.\n* PersistentVolumeClaim (PVC) configuration: The CostManagementMetricsConfig CR can accept a PVC definition and the operator will create and mount the PVC. If one is not provided, a default PVC will be created.\n* Restricted network installation: this operator can function on a restricted network. In this mode, the operator stores the packaged reports for manual retrieval.\n\n## Limitations and Pre-Requisites\n#### Limitations (Potential for metrics data loss)\n* A source **must** exist in console.redhat.com for an uploaded payload to be processed by cost management. The operator sends the payload to the Red Hat Insights Ingress service which usually returns successfully, but the operator does not currently confirm with cost management that the payload was processed. After Ingress accepts the uploaded payload, the payload is removed from the operator and is gone forever. If the data within the payload is not processed, a gap will be introduced in the usage metrics.\n\n**Note** The following limitations are specific to operators configured to run in a restricted network:\n* The `costmanagement-metrics-operator` will not be able to generate new reports if the PVC storage is filled. If this occurs, the reports must be manually deleted from the PVC so that the operator can function as normal.\n* The default report retention is 30 reports (about one week's worth of data). The reports must be manually downloaded and uploaded to console.redhat.com every week, or they will be deleted and the data will be lost.\n\n#### Storage configuration prerequisite\nThe operator will attempt to create and use the following PVC when installed:\n\n      volume_claim_template:\n        apiVersion: v1\n        kind: PersistentVolumeClaim\n        metadata:\n          name: costmanagement-metrics-operator-data\n        spec:\n          accessModes:\n            - ReadWriteOnce\n          resources:\n            requests:\n              storage: 10Gi\n\nIf a different PVC should be utilized, a valid PVC should be specified in the CostManagementMetricsConfig CR as described in the appropriate section below. The PVC to be used may exist already, or the operator will attempt to create it.\n\nTo use the default specification, the follow assumptions must be met:\n1. A default StorageClass is defined.\n2. Dynamic provisioning for that default StorageClass is enabled.\n\nIf these assumptions are not met, the operator will not deploy correctly. In these cases, storage must be manually configured. After configuring storage, a valid PVC template should be supplied in the `volume_claim_template` spec of the CostManagementMetricsConfig CR.\n\n## Configure the costmanagement-metrics-operator\n**Note** There are separate instructions for configuring the `costmanagement-metrics-operator` to run in a restricted network.\n##### Configure authentication\nThe default authentication for the operator is `token`. No further steps are required to configure token authentication. If `basic` is the preferred authentication method, a Secret must be created which holds username and password credentials:\n1. On the left navigation pane, select `Workloads` -> `Secrets` -> select Project: `costmanagement-metrics-operator` -> `Create` -> `Key/Value Secret`\n2. Give the Secret a name and add 2 keys: `username` and `password` (all lowercase). The values for these keys correspond to console.redhat.com credentials.\n3. Select `Create`.\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. For `basic` authentication, edit the following values in the spec:\n    * Replace `authentication: type:` with `basic`.\n    * Add the `secret_name` field under `authentication`, and set it equal to the name of the authentication Secret that was created above. The spec should look similar to the following:\n\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: basic\n        ```\n\n3. To configure the costmanagement-metrics-operator to create a cost management source, edit the following values in the `source` field:\n    * Replace `INSERT-SOURCE-NAME` with the preferred name of the source to be created.\n    * Replace the `create_source` field value with `true`.\n\n    **Note:** if the source already exists, replace `INSERT-SOURCE-NAME` with the existing name, and leave `create_source` as false. This will allow the operator to confirm the source exists.\n4. If not specified, the operator will create a default PersistentVolumeClaim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n5. Select `Create`.\n\n# Restricted Network Usage (disconnected/air-gapped mode)\n## Installation\nTo install the `costmanagement-metrics-operator` in a restricted network, follow the [olm documentation](https://docs.openshift.com/container-platform/4.5/operators/admin/olm-restricted-networks.html). The operator is found in the `community-operators` Catalog in the `registry.redhat.io/redhat/community-operator-index:latest` Index. If pruning the index before pushing to the mirrored registry, keep the `costmanagement-metrics-operator` package.\n\nWithin a restricted network, the operator queries prometheus to gather the necessary usage metrics, writes the query results to CSV files, and packages the reports for storage in the PVC. These reports then need to be manually downloaded from the cluster and uploaded to [console.redhat.com](https://console.redhat.com).\n\nFor more information, reach out to <costmanagement@redhat.com>.\n## Configure the costmanagement-metrics-operator for a restricted network\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. Specify the desired storage. If not specified, the operator will create a default Persistent Volume Claim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            storageClassName: <insert-class-name>\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n3. (Optional) Specify the desired report retention. The operator will retain 30 reports by default. This corresponds to approximately one week's worth of data if using the default packaging cycle. To modify the number of retained reports:\n    * Change the `packaging` spec field `max_reports_to_store` to the desired number of reports to retain. Once this max number is reached, the operator will start removing the oldest packages remaining on the PVC:\n\n      ```\n        packaging:\n          max_size_MB: 100\n          max_reports_to_store: 30\n      ```\n\n    **Note:** The number of retained reports directly affects the frequency that reports must be manually downloaded from the PVC. Take caution in setting this to a higher number of reports, as the operator cannot write data to the PVC if the storage is full.\n4. To configure the operator to perform in a restricted network, set the `upload_toggle` to `false`:\n\n  ```\n    upload:\n      upload_cycle: 360,\n      upload_toggle: false\n  ```\n\n5. Select `Create`.\n\n## Download reports from the Operator & clean up the PVC\nIf the `costmanagement-metrics-operator` is configured to run in a restricted network, the metric reports will not automatically upload to cost managment. Instead, they need to be manually copied from the PVC for upload to [console.redhat.com](https://console.redhat.com). The default configuration saves one week of reports which means the process of downloading and uploading reports should be repeated weekly to prevent loss of metrics data. To download the reports, complete the following steps:\n1. Create the following Pod, ensuring the `claimName` matches the PVC containing the report data:\n\n  ```\n    kind: Pod\n    apiVersion: v1\n    metadata:\n      name: volume-shell\n      namespace: costmanagement-metrics-operator\n    spec:\n      volumes:\n      - name: costmanagement-metrics-operator-reports\n        persistentVolumeClaim:\n          claimName: costmanagement-metrics-operator-data\n      containers:\n      - name: volume-shell\n        image: busybox\n        command: ['sleep', 'infinity']\n        volumeMounts:\n        - name: costmanagement-metrics-operator-reports\n          mountPath: /tmp/costmanagement-metrics-operator-reports\n  ```\n\n2. Use rsync to copy all of the files ready for upload from the PVC to a local folder:\n\n  ```\n  $ oc rsync volume-shell:/tmp/costmanagement-metrics-operator-reports/upload local/path/to/save/folder\n  ```\n\n3. Once confirming that the files have been successfully copied, use rsh to connect to the pod and delete the contents of the upload folder so that they are no longer in storage:\n\n  ```\n  $ oc rsh volume-shell\n  $ rm /tmp/costmanagement-metrics-operator-reports/upload/*\n  ```\n\n4. (Optional) Delete the pod that was used to connect to the PVC:\n\n  ```\n  $ oc delete -f volume-shell.yaml\n  ```\n\n## Create a source\nIn a restricted network, the `costmanagement-metrics-operator` cannot automatically create a source. This process must be done manually. In the console.redhat.com platform, open the [Sources menu](https://console.redhat.com/settings/sources/) to begin adding an OpenShift source to cost management:\n\nPrerequisites:\n* The cluster identifier which can be found in the CostManagementMetricsConfig CR, the cluster Overview page, or the cluster Help > About.\n\nCreate source:\n1. Navigate to the Sources menu\n2. Select the `Red Hat sources` tab\n3. Create a new `Red Hat Openshift Container Platform` source:\n    * give the source a unique name\n    * add the Cost Management application\n    * add the cluster identifier\n4. In the Sources wizard, review the details and click `Finish` to create the Source.\n\n## Upload the reports to cost managment\nUploading reports to cost managment is done through curl:\n\n    $ curl -vvvv -F \"file=@FILE_NAME.tar.gz;type=application/vnd.redhat.hccm.tar+tgz\"  https://cloud.redhat.com/api/ingress/v1/upload -u USERNAME:PASS\n\nwhere `USERNAME` and `PASS` correspond to the user credentials for [console.redhat.com](https://console.redhat.com), and `FILE_NAME` is the name of the report to upload.",
        "displayName": "Cost Management Metrics Operator",
        "installModes": [
          {
            "type": "OwnNamespace",
            "supported": true
          },
          {
            "type": "SingleNamespace",
            "supported": true
          },
          {
            "type": "MultiNamespace",
            "supported": false
          },
          {
            "type": "AllNamespaces",
            "supported": false
          }
        ],
        "keywords": [
          "cost",
          "management",
          "usage",
          "monitor"
        ],
        "maintainers": [
          {
            "name": "costmanagement",
            "email": "costmanagement@redhat.com"
          }
        ],
        "maturity": "alpha",
        "provider": {
          "name": "Red Hat"
        }
      }
    }
  ],
  "relatedImages": [
    {
      "name": "",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:e14493e3b02509690c65016297cf95fc2e4a11a7c97e0f8ca5812e66acbc6c26"
    },
    {
      "name": "costmanagement-metrics-rhel8-operator-2ce0ccd1c76080d4f97683eb3a11bac6848dfa13d231a8ad3f40c2463d977691-annotation",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:2ce0ccd1c76080d4f97683eb3a11bac6848dfa13d231a8ad3f40c2463d977691"
    },
    {
      "name": "manager",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:2ce0ccd1c76080d4f97683eb3a11bac6848dfa13d231a8ad3f40c2463d977691"
    }
  ]
}
{
  "schema": "olm.bundle",
  "name": "costmanagement-metrics-operator.1.1.5",
  "package": "costmanagement-metrics-operator",
  "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:ce775e3dac0fc6a04698c6a53fc38d73593cbd3100dacafb41d7b1bd9505c4e4",
  "properties": [
    {
      "type": "olm.gvk",
      "value": {
        "group": "costmanagement-metrics-cfg.openshift.io",
        "kind": "CostManagementMetricsConfig",
        "version": "v1beta1"
      }
    },
    {
      "type": "olm.package",
      "value": {
        "packageName": "costmanagement-metrics-operator",
        "version": "1.1.5"
      }
    },
    {
      "type": "olm.csv.metadata",
      "value": {
        "annotations": {
          "alm-examples": "[\n  {\n    \"apiVersion\": \"costmanagement-metrics-cfg.openshift.io/v1beta1\",\n    \"kind\": \"CostManagementMetricsConfig\",\n    \"metadata\": {\n      \"name\": \"costmanagementmetricscfg-sample-v1beta1\"\n    },\n    \"spec\": {\n      \"authentication\": {\n        \"type\": \"token\"\n      },\n      \"packaging\": {\n        \"max_reports_to_store\": 30,\n        \"max_size_MB\": 100\n      },\n      \"prometheus_config\": {},\n      \"source\": {\n        \"check_cycle\": 1440,\n        \"create_source\": false,\n        \"name\": \"INSERT-SOURCE-NAME\"\n      },\n      \"upload\": {\n        \"upload_cycle\": 360,\n        \"upload_toggle\": true\n      }\n    }\n  }\n]",
          "capabilities": "Seamless Upgrades",
          "categories": "Monitoring",
          "certified": "false",
          "containerImage": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:fe14a37527faed6262630c6f76cd862598244a318d40ea7d6ebaea14661b8e9b",
          "createdAt": "2021-02-16T16:03:12Z",
          "description": "A Golang-based OpenShift Operator that generates and uploads OpenShift usage metrics to cost management.",
          "operatorframework.io/suggested-namespace": "costmanagement-metrics-operator",
          "operators.openshift.io/infrastructure-features": "[\"Disconnected\"]",
          "operators.operatorframework.io/builder": "operator-sdk-v0.19.4",
          "operators.operatorframework.io/project_layout": "go.kubebuilder.io/v2",
          "repository": "https://github.com/project-koku/koku-metrics-operator",
          "support": "Red Hat"
        },
        "apiServiceDefinitions": {},
        "crdDescriptions": {
          "owned": [
            {
              "name": "costmanagementmetricsconfigs.costmanagement-metrics-cfg.openshift.io",
              "version": "v1beta1",
              "kind": "CostManagementMetricsConfig",
              "description": "CostManagementMetricsConfig is the Schema for the costmanagementmetricsconfig API"
            }
          ]
        },
        "description": "# 1.1.5 Cost Management Metrics Operator\n## Introduction\nThe `costmanagement-metrics-operator` is a component of the [cost managment](https://access.redhat.com/documentation/en-us/cost_management_service) service for Openshift, used to gather the required information from the cluster. It is recommended to be installed in OpenShift 4.6+. This operator obtains OpenShift usage data by querying Prometheus and uploads it to cost management to be processed. The Operator queries Prometheus every hour to create metric reports, which are then packaged and uploaded to cost management at [console.redhat.com](https://console.redhat.com). For more information, reach out to <costmanagement@redhat.com>.\n\nThis operator is capable of functioning within a disconnected/restricted network (aka air-gapped mode). In this mode, the operator will store the packaged reports for manual retrieval instead of being uploaded to cost management. Documentation for installing an operator within a restricted network can be found [here](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html).\n\nFor more information, reach out to <costmanagement@redhat.com>.\n## Features and Capabilities\n#### Metrics collection:\nThe Cost Management Metrics Operator (`costmanagement-metrics-operator`) collects the metrics required for cost management by:\n* Querying Prometheus to gather the necessary metrics for cost management.\n* Writing Prometheus queries to CSV report files.\n* Packaging the CSV report files into tarballs.\n\n#### Additional Capabilities:\n* The operator can be configured to automatically upload the packaged reports to cost management through Red Hat Insights Ingress service.\n* The operator can create a source in console.redhat.com. A source is required for cost management to process the uploaded packages.\n* PersistentVolumeClaim (PVC) configuration: The CostManagementMetricsConfig CR can accept a PVC definition and the operator will create and mount the PVC. If one is not provided, a default PVC will be created.\n* Restricted network installation: this operator can function on a restricted network. In this mode, the operator stores the packaged reports for manual retrieval.\n\n## Limitations and Pre-Requisites\n#### Limitations (Potential for metrics data loss)\n* A source **must** exist in console.redhat.com for an uploaded payload to be processed by cost management. The operator sends the payload to the Red Hat Insights Ingress service which usually returns successfully, but the operator does not currently confirm with cost management that the payload was processed. After Ingress accepts the uploaded payload, the payload is removed from the operator and is gone forever. If the data within the payload is not processed, a gap will be introduced in the usage metrics.\n\n**Note** The following limitations are specific to operators configured to run in a restricted network:\n* The `costmanagement-metrics-operator` will not be able to generate new reports if the PVC storage is filled. If this occurs, the reports must be manually deleted from the PVC so that the operator can function as normal.\n* The default report retention is 30 reports (about one week's worth of data). The reports must be manually downloaded and uploaded to console.redhat.com every week, or they will be deleted and the data will be lost.\n\n#### Storage configuration prerequisite\nThe operator will attempt to create and use the following PVC when installed:\n\n      volume_claim_template:\n        apiVersion: v1\n        kind: PersistentVolumeClaim\n        metadata:\n          name: costmanagement-metrics-operator-data\n        spec:\n          accessModes:\n            - ReadWriteOnce\n          resources:\n            requests:\n              storage: 10Gi\n\nIf a different PVC should be utilized, a valid PVC should be specified in the CostManagementMetricsConfig CR as described in the appropriate section below. The PVC to be used may exist already, or the operator will attempt to create it.\n\nTo use the default specification, the follow assumptions must be met:\n1. A default StorageClass is defined.\n2. Dynamic provisioning for that default StorageClass is enabled.\n\nIf these assumptions are not met, the operator will not deploy correctly. In these cases, storage must be manually configured. After configuring storage, a valid PVC template should be supplied in the `volume_claim_template` spec of the CostManagementMetricsConfig CR.\n\n## Configure the costmanagement-metrics-operator\n**Note** There are separate instructions for configuring the `costmanagement-metrics-operator` to run in a restricted network.\n##### Configure authentication\nThe default authentication for the operator is `token`. No further steps are required to configure token authentication. If `basic` is the preferred authentication method, a Secret must be created which holds username and password credentials:\n1. On the left navigation pane, select `Workloads` -> `Secrets` -> select Project: `costmanagement-metrics-operator` -> `Create` -> `Key/Value Secret`\n2. Give the Secret a name and add 2 keys: `username` and `password` (all lowercase). The values for these keys correspond to console.redhat.com credentials.\n3. Select `Create`.\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. For `basic` authentication, edit the following values in the spec:\n    * Replace `authentication: type:` with `basic`.\n    * Add the `secret_name` field under `authentication`, and set it equal to the name of the authentication Secret that was created above. The spec should look similar to the following:\n\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: basic\n        ```\n\n3. To configure the costmanagement-metrics-operator to create a cost management source, edit the following values in the `source` field:\n    * Replace `INSERT-SOURCE-NAME` with the preferred name of the source to be created.\n    * Replace the `create_source` field value with `true`.\n\n    **Note:** if the source already exists, replace `INSERT-SOURCE-NAME` with the existing name, and leave `create_source` as false. This will allow the operator to confirm the source exists.\n4. If not specified, the operator will create a default PersistentVolumeClaim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n5. Select `Create`.\n\n# Restricted Network Usage (disconnected/air-gapped mode)\n## Installation\nTo install the `costmanagement-metrics-operator` in a restricted network, follow the [olm documentation](https://docs.openshift.com/container-platform/4.5/operators/admin/olm-restricted-networks.html). The operator is found in the `community-operators` Catalog in the `registry.redhat.io/redhat/community-operator-index:latest` Index. If pruning the index before pushing to the mirrored registry, keep the `costmanagement-metrics-operator` package.\n\nWithin a restricted network, the operator queries prometheus to gather the necessary usage metrics, writes the query results to CSV files, and packages the reports for storage in the PVC. These reports then need to be manually downloaded from the cluster and uploaded to [console.redhat.com](https://console.redhat.com).\n\nFor more information, reach out to <costmanagement@redhat.com>.\n## Configure the costmanagement-metrics-operator for a restricted network\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. Specify the desired storage. If not specified, the operator will create a default Persistent Volume Claim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            storageClassName: <insert-class-name>\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n3. (Optional) Specify the desired report retention. The operator will retain 30 reports by default. This corresponds to approximately one week's worth of data if using the default packaging cycle. To modify the number of retained reports:\n    * Change the `packaging` spec field `max_reports_to_store` to the desired number of reports to retain. Once this max number is reached, the operator will start removing the oldest packages remaining on the PVC:\n\n      ```\n        packaging:\n          max_size_MB: 100\n          max_reports_to_store: 30\n      ```\n\n    **Note:** The number of retained reports directly affects the frequency that reports must be manually downloaded from the PVC. Take caution in setting this to a higher number of reports, as the operator cannot write data to the PVC if the storage is full.\n4. To configure the operator to perform in a restricted network, set the `upload_toggle` to `false`:\n\n  ```\n    upload:\n      upload_cycle: 360,\n      upload_toggle: false\n  ```\n\n5. Select `Create`.\n\n## Download reports from the Operator & clean up the PVC\nIf the `costmanagement-metrics-operator` is configured to run in a restricted network, the metric reports will not automatically upload to cost managment. Instead, they need to be manually copied from the PVC for upload to [console.redhat.com](https://console.redhat.com). The default configuration saves one week of reports which means the process of downloading and uploading reports should be repeated weekly to prevent loss of metrics data. To download the reports, complete the following steps:\n1. Create the following Pod, ensuring the `claimName` matches the PVC containing the report data:\n\n  ```\n    kind: Pod\n    apiVersion: v1\n    metadata:\n      name: volume-shell\n      namespace: costmanagement-metrics-operator\n    spec:\n      volumes:\n      - name: costmanagement-metrics-operator-reports\n        persistentVolumeClaim:\n          claimName: costmanagement-metrics-operator-data\n      containers:\n      - name: volume-shell\n        image: busybox\n        command: ['sleep', 'infinity']\n        volumeMounts:\n        - name: costmanagement-metrics-operator-reports\n          mountPath: /tmp/costmanagement-metrics-operator-reports\n  ```\n\n2. Use rsync to copy all of the files ready for upload from the PVC to a local folder:\n\n  ```\n  $ oc rsync volume-shell:/tmp/costmanagement-metrics-operator-reports/upload local/path/to/save/folder\n  ```\n\n3. Once confirming that the files have been successfully copied, use rsh to connect to the pod and delete the contents of the upload folder so that they are no longer in storage:\n\n  ```\n  $ oc rsh volume-shell\n  $ rm /tmp/costmanagement-metrics-operator-reports/upload/*\n  ```\n\n4. (Optional) Delete the pod that was used to connect to the PVC:\n\n  ```\n  $ oc delete -f volume-shell.yaml\n  ```\n\n## Create a source\nIn a restricted network, the `costmanagement-metrics-operator` cannot automatically create a source. This process must be done manually. In the console.redhat.com platform, open the [Sources menu](https://console.redhat.com/settings/sources/) to begin adding an OpenShift source to cost management:\n\nPrerequisites:\n* The cluster identifier which can be found in the CostManagementMetricsConfig CR, the cluster Overview page, or the cluster Help > About.\n\nCreate source:\n1. Navigate to the Sources menu\n2. Select the `Red Hat sources` tab\n3. Create a new `Red Hat Openshift Container Platform` source:\n    * give the source a unique name\n    * add the Cost Management application\n    * add the cluster identifier\n4. In the Sources wizard, review the details and click `Finish` to create the Source.\n\n## Upload the reports to cost managment\nUploading reports to cost managment is done through curl:\n\n    $ curl -vvvv -F \"file=@FILE_NAME.tar.gz;type=application/vnd.redhat.hccm.tar+tgz\"  https://cloud.redhat.com/api/ingress/v1/upload -u USERNAME:PASS\n\nwhere `USERNAME` and `PASS` correspond to the user credentials for [console.redhat.com](https://console.redhat.com), and `FILE_NAME` is the name of the report to upload.",
        "displayName": "Cost Management Metrics Operator",
        "installModes": [
          {
            "type": "OwnNamespace",
            "supported": true
          },
          {
            "type": "SingleNamespace",
            "supported": true
          },
          {
            "type": "MultiNamespace",
            "supported": false
          },
          {
            "type": "AllNamespaces",
            "supported": false
          }
        ],
        "keywords": [
          "cost",
          "management",
          "usage",
          "monitor"
        ],
        "maintainers": [
          {
            "name": "costmanagement",
            "email": "costmanagement@redhat.com"
          }
        ],
        "maturity": "alpha",
        "provider": {
          "name": "Red Hat"
        }
      }
    }
  ],
  "relatedImages": [
    {
      "name": "",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:ce775e3dac0fc6a04698c6a53fc38d73593cbd3100dacafb41d7b1bd9505c4e4"
    },
    {
      "name": "costmanagement-metrics-rhel8-operator-fe14a37527faed6262630c6f76cd862598244a318d40ea7d6ebaea14661b8e9b-annotation",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:fe14a37527faed6262630c6f76cd862598244a318d40ea7d6ebaea14661b8e9b"
    },
    {
      "name": "manager",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:fe14a37527faed6262630c6f76cd862598244a318d40ea7d6ebaea14661b8e9b"
    }
  ]
}
{
  "schema": "olm.bundle",
  "name": "costmanagement-metrics-operator.1.1.6",
  "package": "costmanagement-metrics-operator",
  "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:020d5d1777d0dec2ae432a1cd93f7a306c7860ad05cabe19c59f9359b5d4e44e",
  "properties": [
    {
      "type": "olm.gvk",
      "value": {
        "group": "costmanagement-metrics-cfg.openshift.io",
        "kind": "CostManagementMetricsConfig",
        "version": "v1beta1"
      }
    },
    {
      "type": "olm.package",
      "value": {
        "packageName": "costmanagement-metrics-operator",
        "version": "1.1.6"
      }
    },
    {
      "type": "olm.csv.metadata",
      "value": {
        "annotations": {
          "alm-examples": "[\n  {\n    \"apiVersion\": \"costmanagement-metrics-cfg.openshift.io/v1beta1\",\n    \"kind\": \"CostManagementMetricsConfig\",\n    \"metadata\": {\n      \"name\": \"costmanagementmetricscfg-sample-v1beta1\"\n    },\n    \"spec\": {\n      \"authentication\": {\n        \"type\": \"token\"\n      },\n      \"packaging\": {\n        \"max_reports_to_store\": 30,\n        \"max_size_MB\": 100\n      },\n      \"prometheus_config\": {},\n      \"source\": {\n        \"check_cycle\": 1440,\n        \"create_source\": false,\n        \"name\": \"INSERT-SOURCE-NAME\"\n      },\n      \"upload\": {\n        \"upload_cycle\": 360,\n        \"upload_toggle\": true\n      }\n    }\n  }\n]",
          "capabilities": "Seamless Upgrades",
          "categories": "Monitoring",
          "certified": "false",
          "containerImage": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:523b662fb05098ec9410cc0665556495f6409b44b8c8030c1c456eeee864da66",
          "createdAt": "2021-02-16T16:03:12Z",
          "description": "A Golang-based OpenShift Operator that generates and uploads OpenShift usage metrics to cost management.",
          "operatorframework.io/suggested-namespace": "costmanagement-metrics-operator",
          "operators.openshift.io/infrastructure-features": "[\"Disconnected\"]",
          "operators.operatorframework.io/builder": "operator-sdk-v0.19.4",
          "operators.operatorframework.io/project_layout": "go.kubebuilder.io/v2",
          "repository": "https://github.com/project-koku/koku-metrics-operator",
          "support": "Red Hat"
        },
        "apiServiceDefinitions": {},
        "crdDescriptions": {
          "owned": [
            {
              "name": "costmanagementmetricsconfigs.costmanagement-metrics-cfg.openshift.io",
              "version": "v1beta1",
              "kind": "CostManagementMetricsConfig",
              "description": "CostManagementMetricsConfig is the Schema for the costmanagementmetricsconfig API"
            }
          ]
        },
        "description": "# 1.1.6 Cost Management Metrics Operator\n## Introduction\nThe `costmanagement-metrics-operator` is a component of the [cost managment](https://access.redhat.com/documentation/en-us/cost_management_service) service for Openshift, used to gather the required information from the cluster. It is recommended to be installed in OpenShift 4.6+. This operator obtains OpenShift usage data by querying Prometheus and uploads it to cost management to be processed. The Operator queries Prometheus every hour to create metric reports, which are then packaged and uploaded to cost management at [console.redhat.com](https://console.redhat.com). For more information, reach out to <costmanagement@redhat.com>.\n\nThis operator is capable of functioning within a disconnected/restricted network (aka air-gapped mode). In this mode, the operator will store the packaged reports for manual retrieval instead of being uploaded to cost management. Documentation for installing an operator within a restricted network can be found [here](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html).\n\n## Features and Capabilities\n#### Metrics collection:\nThe Cost Management Metrics Operator (`costmanagement-metrics-operator`) collects the metrics required for cost management by:\n* Querying Prometheus to gather the necessary metrics for cost management.\n* Writing Prometheus queries to CSV report files.\n* Packaging the CSV report files into tarballs.\n\n#### Additional Capabilities:\n* The operator can be configured to automatically upload the packaged reports to cost management through Red Hat Insights Ingress service.\n* The operator can create a source in console.redhat.com. A source is required for cost management to process the uploaded packages.\n* PersistentVolumeClaim (PVC) configuration: The CostManagementMetricsConfig CR can accept a PVC definition and the operator will create and mount the PVC. If one is not provided, a default PVC will be created.\n* Restricted network installation: this operator can function on a restricted network. In this mode, the operator stores the packaged reports for manual retrieval.\n\n## Limitations and Pre-Requisites\n#### Limitations (Potential for metrics data loss)\n* A source **must** exist in console.redhat.com for an uploaded payload to be processed by cost management. The operator sends the payload to the Red Hat Insights Ingress service which usually returns successfully, but the operator does not currently confirm with cost management that the payload was processed. After Ingress accepts the uploaded payload, the payload is removed from the operator and is gone forever. If the data within the payload is not processed, a gap will be introduced in the usage metrics.\n\n**Note** The following limitations are specific to operators configured to run in a restricted network:\n* The `costmanagement-metrics-operator` will not be able to generate new reports if the PVC storage is filled. If this occurs, the reports must be manually deleted from the PVC so that the operator can function as normal.\n* The default report retention is 30 reports (about one week's worth of data). The reports must be manually downloaded and uploaded to console.redhat.com every week, or they will be deleted and the data will be lost.\n\n#### Storage configuration prerequisite\nThe operator will attempt to create and use the following PVC when installed:\n\n      volume_claim_template:\n        apiVersion: v1\n        kind: PersistentVolumeClaim\n        metadata:\n          name: costmanagement-metrics-operator-data\n        spec:\n          accessModes:\n            - ReadWriteOnce\n          resources:\n            requests:\n              storage: 10Gi\n\nIf a different PVC should be utilized, a valid PVC should be specified in the CostManagementMetricsConfig CR as described in the appropriate section below. The PVC to be used may exist already, or the operator will attempt to create it.\n\nTo use the default specification, the follow assumptions must be met:\n1. A default StorageClass is defined.\n2. Dynamic provisioning for that default StorageClass is enabled.\n\nIf these assumptions are not met, the operator will not deploy correctly. In these cases, storage must be manually configured. After configuring storage, a valid PVC template should be supplied in the `volume_claim_template` spec of the CostManagementMetricsConfig CR.\n\n## Configure the costmanagement-metrics-operator\n**Note** There are separate instructions for configuring the `costmanagement-metrics-operator` to run in a restricted network.\n##### Configure authentication\nThe default authentication for the operator is `token`. No further steps are required to configure token authentication. If `basic` is the preferred authentication method, a Secret must be created which holds username and password credentials:\n1. On the left navigation pane, select `Workloads` -> `Secrets` -> select Project: `costmanagement-metrics-operator` -> `Create` -> `Key/Value Secret`\n2. Give the Secret a name and add 2 keys: `username` and `password` (all lowercase). The values for these keys correspond to console.redhat.com credentials.\n3. Select `Create`.\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. For `basic` authentication, edit the following values in the spec:\n    * Replace `authentication: type:` with `basic`.\n    * Add the `secret_name` field under `authentication`, and set it equal to the name of the authentication Secret that was created above. The spec should look similar to the following:\n\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: basic\n        ```\n\n3. To configure the costmanagement-metrics-operator to create a cost management source, edit the following values in the `source` field:\n    * Replace `INSERT-SOURCE-NAME` with the preferred name of the source to be created.\n    * Replace the `create_source` field value with `true`.\n\n    **Note:** if the source already exists, replace `INSERT-SOURCE-NAME` with the existing name, and leave `create_source` as false. This will allow the operator to confirm the source exists.\n4. If not specified, the operator will create a default PersistentVolumeClaim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n5. Select `Create`.\n\n# Restricted Network Usage (disconnected/air-gapped mode)\n## Installation\nTo install the `costmanagement-metrics-operator` in a restricted network, follow the [olm documentation](https://docs.openshift.com/container-platform/4.5/operators/admin/olm-restricted-networks.html). The operator is found in the `community-operators` Catalog in the `registry.redhat.io/redhat/community-operator-index:latest` Index. If pruning the index before pushing to the mirrored registry, keep the `costmanagement-metrics-operator` package.\n\nWithin a restricted network, the operator queries prometheus to gather the necessary usage metrics, writes the query results to CSV files, and packages the reports for storage in the PVC. These reports then need to be manually downloaded from the cluster and uploaded to [console.redhat.com](https://console.redhat.com).\n\n## Configure the costmanagement-metrics-operator for a restricted network\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. Specify the desired storage. If not specified, the operator will create a default Persistent Volume Claim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            storageClassName: <insert-class-name>\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n3. (Optional) Specify the desired report retention. The operator will retain 30 reports by default. This corresponds to approximately one week's worth of data if using the default packaging cycle. To modify the number of retained reports:\n    * Change the `packaging` spec field `max_reports_to_store` to the desired number of reports to retain. Once this max number is reached, the operator will start removing the oldest packages remaining on the PVC:\n\n      ```\n        packaging:\n          max_size_MB: 100\n          max_reports_to_store: 30\n      ```\n\n    **Note:** The number of retained reports directly affects the frequency that reports must be manually downloaded from the PVC. Take caution in setting this to a higher number of reports, as the operator cannot write data to the PVC if the storage is full.\n4. To configure the operator to perform in a restricted network, set the `upload_toggle` to `false`:\n\n  ```\n    upload:\n      upload_cycle: 360,\n      upload_toggle: false\n  ```\n\n5. Select `Create`.\n\n## Download reports from the Operator & clean up the PVC\nIf the `costmanagement-metrics-operator` is configured to run in a restricted network, the metric reports will not automatically upload to cost managment. Instead, they need to be manually copied from the PVC for upload to [console.redhat.com](https://console.redhat.com). The default configuration saves one week of reports which means the process of downloading and uploading reports should be repeated weekly to prevent loss of metrics data. To download the reports, complete the following steps:\n1. Create the following Pod, ensuring the `claimName` matches the PVC containing the report data:\n\n  ```\n    kind: Pod\n    apiVersion: v1\n    metadata:\n      name: volume-shell\n      namespace: costmanagement-metrics-operator\n      labels:\n        app: costmanagement-metrics-operator\n    spec:\n     affinity:\n       podAffinity:\n         requiredDuringSchedulingIgnoredDuringExecution:\n         - labelSelector:\n             matchExpressions:\n             - key: app\n               operator: In\n               values:\n               - costmanagement-metrics-operator\n           topologyKey: kubernetes.io/hostname\n      volumes:\n      - name: costmanagement-metrics-operator-reports\n        persistentVolumeClaim:\n          claimName: costmanagement-metrics-operator-data\n      containers:\n      - name: volume-shell\n        image: busybox\n        command: ['sleep', 'infinity']\n        volumeMounts:\n        - name: costmanagement-metrics-operator-reports\n          mountPath: /tmp/costmanagement-metrics-operator-reports\n  ```\n\n2. Use rsync to copy all of the files ready for upload from the PVC to a local folder:\n\n  ```\n  $ oc rsync volume-shell:/tmp/costmanagement-metrics-operator-reports/upload local/path/to/save/folder\n  ```\n\n3. Once confirming that the files have been successfully copied, use rsh to connect to the pod and delete the contents of the upload folder so that they are no longer in storage:\n\n  ```\n  $ oc rsh volume-shell\n  $ rm /tmp/costmanagement-metrics-operator-reports/upload/*\n  ```\n\n4. (Optional) Delete the pod that was used to connect to the PVC:\n\n  ```\n  $ oc delete -f volume-shell.yaml\n  ```\n\n## Create a source\nIn a restricted network, the `costmanagement-metrics-operator` cannot automatically create a source. This process must be done manually. In the console.redhat.com platform, open the [Sources menu](https://console.redhat.com/settings/sources/) to begin adding an OpenShift source to cost management:\n\nPrerequisites:\n* The cluster identifier which can be found in the CostManagementMetricsConfig CR, the cluster Overview page, or the cluster Help > About.\n\nCreate source:\n1. Navigate to the Sources menu\n2. Select the `Red Hat sources` tab\n3. Create a new `Red Hat Openshift Container Platform` source:\n    * give the source a unique name\n    * add the Cost Management application\n    * add the cluster identifier\n4. In the Sources wizard, review the details and click `Finish` to create the Source.\n\n## Upload the reports to cost managment\nUploading reports to cost managment is done through curl:\n\n    $ curl -vvvv -F \"file=@FILE_NAME.tar.gz;type=application/vnd.redhat.hccm.tar+tgz\"  https://cloud.redhat.com/api/ingress/v1/upload -u USERNAME:PASS\n\nwhere `USERNAME` and `PASS` correspond to the user credentials for [console.redhat.com](https://console.redhat.com), and `FILE_NAME` is the name of the report to upload.",
        "displayName": "Cost Management Metrics Operator",
        "installModes": [
          {
            "type": "OwnNamespace",
            "supported": true
          },
          {
            "type": "SingleNamespace",
            "supported": true
          },
          {
            "type": "MultiNamespace",
            "supported": false
          },
          {
            "type": "AllNamespaces",
            "supported": false
          }
        ],
        "keywords": [
          "cost",
          "management",
          "usage",
          "monitor"
        ],
        "maintainers": [
          {
            "name": "costmanagement",
            "email": "costmanagement@redhat.com"
          }
        ],
        "maturity": "alpha",
        "provider": {
          "name": "Red Hat"
        }
      }
    }
  ],
  "relatedImages": [
    {
      "name": "",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:020d5d1777d0dec2ae432a1cd93f7a306c7860ad05cabe19c59f9359b5d4e44e"
    },
    {
      "name": "costmanagement-metrics-rhel8-operator-523b662fb05098ec9410cc0665556495f6409b44b8c8030c1c456eeee864da66-annotation",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:523b662fb05098ec9410cc0665556495f6409b44b8c8030c1c456eeee864da66"
    },
    {
      "name": "manager",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:523b662fb05098ec9410cc0665556495f6409b44b8c8030c1c456eeee864da66"
    }
  ]
}
{
  "schema": "olm.bundle",
  "name": "costmanagement-metrics-operator.1.1.7",
  "package": "costmanagement-metrics-operator",
  "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:0abc9b30a48080d2a4a413f7818770ea4dd7b78c715a816fe5818ec75326bb69",
  "properties": [
    {
      "type": "olm.gvk",
      "value": {
        "group": "costmanagement-metrics-cfg.openshift.io",
        "kind": "CostManagementMetricsConfig",
        "version": "v1beta1"
      }
    },
    {
      "type": "olm.package",
      "value": {
        "packageName": "costmanagement-metrics-operator",
        "version": "1.1.7"
      }
    },
    {
      "type": "olm.csv.metadata",
      "value": {
        "annotations": {
          "alm-examples": "[\n  {\n    \"apiVersion\": \"costmanagement-metrics-cfg.openshift.io/v1beta1\",\n    \"kind\": \"CostManagementMetricsConfig\",\n    \"metadata\": {\n      \"name\": \"costmanagementmetricscfg-sample-v1beta1\"\n    },\n    \"spec\": {\n      \"authentication\": {\n        \"type\": \"token\"\n      },\n      \"packaging\": {\n        \"max_reports_to_store\": 30,\n        \"max_size_MB\": 100\n      },\n      \"prometheus_config\": {},\n      \"source\": {\n        \"check_cycle\": 1440,\n        \"create_source\": false,\n        \"name\": \"INSERT-SOURCE-NAME\"\n      },\n      \"upload\": {\n        \"upload_cycle\": 360,\n        \"upload_toggle\": true\n      }\n    }\n  }\n]",
          "capabilities": "Seamless Upgrades",
          "categories": "Monitoring",
          "certified": "false",
          "containerImage": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:4c9153b33cc942134e2bd857a8cae47ded38eb789874fde089d67b00d0c2e6f6",
          "createdAt": "2021-02-16T16:03:12Z",
          "description": "A Golang-based OpenShift Operator that generates and uploads OpenShift usage metrics to cost management.",
          "operatorframework.io/suggested-namespace": "costmanagement-metrics-operator",
          "operators.openshift.io/infrastructure-features": "[\"Disconnected\"]",
          "operators.operatorframework.io/builder": "operator-sdk-v0.19.4",
          "operators.operatorframework.io/project_layout": "go.kubebuilder.io/v2",
          "repository": "https://github.com/project-koku/koku-metrics-operator",
          "support": "Red Hat"
        },
        "apiServiceDefinitions": {},
        "crdDescriptions": {
          "owned": [
            {
              "name": "costmanagementmetricsconfigs.costmanagement-metrics-cfg.openshift.io",
              "version": "v1beta1",
              "kind": "CostManagementMetricsConfig",
              "description": "CostManagementMetricsConfig is the Schema for the costmanagementmetricsconfig API"
            }
          ]
        },
        "description": "# 1.1.7 Cost Management Metrics Operator\n## Introduction\nThe `costmanagement-metrics-operator` is a component of the [cost managment](https://access.redhat.com/documentation/en-us/cost_management_service) service for Openshift, used to gather the required information from the cluster. It is recommended to be installed in OpenShift 4.6+. This operator obtains OpenShift usage data by querying Prometheus and uploads it to cost management to be processed. The Operator queries Prometheus every hour to create metric reports, which are then packaged and uploaded to cost management at [console.redhat.com](https://console.redhat.com). For more information, reach out to <costmanagement@redhat.com>.\n\nThis operator is capable of functioning within a disconnected/restricted network (aka air-gapped mode). In this mode, the operator will store the packaged reports for manual retrieval instead of being uploaded to cost management. Documentation for installing an operator within a restricted network can be found [here](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html).\n\n## Features and Capabilities\n#### Metrics collection:\nThe Cost Management Metrics Operator (`costmanagement-metrics-operator`) collects the metrics required for cost management by:\n* Querying Prometheus to gather the necessary metrics for cost management.\n* Writing Prometheus queries to CSV report files.\n* Packaging the CSV report files into tarballs.\n\n#### Additional Capabilities:\n* The operator can be configured to automatically upload the packaged reports to cost management through Red Hat Insights Ingress service.\n* The operator can create a source in console.redhat.com. A source is required for cost management to process the uploaded packages.\n* PersistentVolumeClaim (PVC) configuration: The CostManagementMetricsConfig CR can accept a PVC definition and the operator will create and mount the PVC. If one is not provided, a default PVC will be created.\n* Restricted network installation: this operator can function on a restricted network. In this mode, the operator stores the packaged reports for manual retrieval.\n\n## Limitations and Pre-Requisites\n#### Limitations (Potential for metrics data loss)\n* A source **must** exist in console.redhat.com for an uploaded payload to be processed by cost management. The operator sends the payload to the Red Hat Insights Ingress service which usually returns successfully, but the operator does not currently confirm with cost management that the payload was processed. After Ingress accepts the uploaded payload, the payload is removed from the operator and is gone forever. If the data within the payload is not processed, a gap will be introduced in the usage metrics.\n\n**Note** The following limitations are specific to operators configured to run in a restricted network:\n* The `costmanagement-metrics-operator` will not be able to generate new reports if the PVC storage is filled. If this occurs, the reports must be manually deleted from the PVC so that the operator can function as normal.\n* The default report retention is 30 reports (about one week's worth of data). The reports must be manually downloaded and uploaded to console.redhat.com every week, or they will be deleted and the data will be lost.\n\n#### Storage configuration prerequisite\nThe operator will attempt to create and use the following PVC when installed:\n\n      volume_claim_template:\n        apiVersion: v1\n        kind: PersistentVolumeClaim\n        metadata:\n          name: costmanagement-metrics-operator-data\n        spec:\n          accessModes:\n            - ReadWriteOnce\n          resources:\n            requests:\n              storage: 10Gi\n\nIf a different PVC should be utilized, a valid PVC should be specified in the CostManagementMetricsConfig CR as described in the appropriate section below. The PVC to be used may exist already, or the operator will attempt to create it.\n\nTo use the default specification, the follow assumptions must be met:\n1. A default StorageClass is defined.\n2. Dynamic provisioning for that default StorageClass is enabled.\n\nIf these assumptions are not met, the operator will not deploy correctly. In these cases, storage must be manually configured. After configuring storage, a valid PVC template should be supplied in the `volume_claim_template` spec of the CostManagementMetricsConfig CR.\n\n## Configure the costmanagement-metrics-operator\n**Note** There are separate instructions for configuring the `costmanagement-metrics-operator` to run in a restricted network.\n##### Configure authentication\nThe default authentication for the operator is `token`. No further steps are required to configure token authentication. If `basic` is the preferred authentication method, a Secret must be created which holds username and password credentials:\n1. On the left navigation pane, select `Workloads` -> `Secrets` -> select Project: `costmanagement-metrics-operator` -> `Create` -> `Key/Value Secret`\n2. Give the Secret a name and add 2 keys: `username` and `password` (all lowercase). The values for these keys correspond to console.redhat.com credentials.\n3. Select `Create`.\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. For `basic` authentication, edit the following values in the spec:\n    * Replace `authentication: type:` with `basic`.\n    * Add the `secret_name` field under `authentication`, and set it equal to the name of the authentication Secret that was created above. The spec should look similar to the following:\n\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: basic\n        ```\n\n3. To configure the costmanagement-metrics-operator to create a cost management source, edit the following values in the `source` field:\n    * Replace `INSERT-SOURCE-NAME` with the preferred name of the source to be created.\n    * Replace the `create_source` field value with `true`.\n\n    **Note:** if the source already exists, replace `INSERT-SOURCE-NAME` with the existing name, and leave `create_source` as false. This will allow the operator to confirm the source exists.\n4. If not specified, the operator will create a default PersistentVolumeClaim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n5. Select `Create`.\n\n# Restricted Network Usage (disconnected/air-gapped mode)\n## Installation\nTo install the `costmanagement-metrics-operator` in a restricted network, follow the [olm documentation](https://docs.openshift.com/container-platform/4.5/operators/admin/olm-restricted-networks.html). The operator is found in the `community-operators` Catalog in the `registry.redhat.io/redhat/community-operator-index:latest` Index. If pruning the index before pushing to the mirrored registry, keep the `costmanagement-metrics-operator` package.\n\nWithin a restricted network, the operator queries prometheus to gather the necessary usage metrics, writes the query results to CSV files, and packages the reports for storage in the PVC. These reports then need to be manually downloaded from the cluster and uploaded to [console.redhat.com](https://console.redhat.com).\n\n## Configure the costmanagement-metrics-operator for a restricted network\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. Specify the desired storage. If not specified, the operator will create a default Persistent Volume Claim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            storageClassName: <insert-class-name>\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n3. (Optional) Specify the desired report retention. The operator will retain 30 reports by default. This corresponds to approximately one week's worth of data if using the default packaging cycle. To modify the number of retained reports:\n    * Change the `packaging` spec field `max_reports_to_store` to the desired number of reports to retain. Once this max number is reached, the operator will start removing the oldest packages remaining on the PVC:\n\n      ```\n        packaging:\n          max_size_MB: 100\n          max_reports_to_store: 30\n      ```\n\n    **Note:** The number of retained reports directly affects the frequency that reports must be manually downloaded from the PVC. Take caution in setting this to a higher number of reports, as the operator cannot write data to the PVC if the storage is full.\n4. To configure the operator to perform in a restricted network, set the `upload_toggle` to `false`:\n\n  ```\n    upload:\n      upload_cycle: 360,\n      upload_toggle: false\n  ```\n\n5. Select `Create`.\n\n## Download reports from the Operator & clean up the PVC\nIf the `costmanagement-metrics-operator` is configured to run in a restricted network, the metric reports will not automatically upload to cost managment. Instead, they need to be manually copied from the PVC for upload to [console.redhat.com](https://console.redhat.com). The default configuration saves one week of reports which means the process of downloading and uploading reports should be repeated weekly to prevent loss of metrics data. To download the reports, complete the following steps:\n1. Create the following Pod, ensuring the `claimName` matches the PVC containing the report data:\n\n  ```\n    kind: Pod\n    apiVersion: v1\n    metadata:\n      name: volume-shell\n      namespace: costmanagement-metrics-operator\n      labels:\n        app: costmanagement-metrics-operator\n    spec:\n      volumes:\n      - name: costmanagement-metrics-operator-reports\n        persistentVolumeClaim:\n          claimName: costmanagement-metrics-operator-data\n      containers:\n      - name: volume-shell\n        image: busybox\n        command: ['sleep', 'infinity']\n        volumeMounts:\n        - name: costmanagement-metrics-operator-reports\n          mountPath: /tmp/costmanagement-metrics-operator-reports\n  ```\n\n2. Use rsync to copy all of the files ready for upload from the PVC to a local folder:\n\n  ```\n  $ oc rsync volume-shell:/tmp/costmanagement-metrics-operator-reports/upload local/path/to/save/folder\n  ```\n\n3. Once confirming that the files have been successfully copied, use rsh to connect to the pod and delete the contents of the upload folder so that they are no longer in storage:\n\n  ```\n  $ oc rsh volume-shell\n  $ rm /tmp/costmanagement-metrics-operator-reports/upload/*\n  ```\n\n4. (Optional) Delete the pod that was used to connect to the PVC:\n\n  ```\n  $ oc delete -f volume-shell.yaml\n  ```\n\n## Create a source\nIn a restricted network, the `costmanagement-metrics-operator` cannot automatically create a source. This process must be done manually. In the console.redhat.com platform, open the [Sources menu](https://console.redhat.com/settings/sources/) to begin adding an OpenShift source to cost management:\n\nPrerequisites:\n* The cluster identifier which can be found in the CostManagementMetricsConfig CR, the cluster Overview page, or the cluster Help > About.\n\nCreate source:\n1. Navigate to the Sources menu\n2. Select the `Red Hat sources` tab\n3. Create a new `Red Hat Openshift Container Platform` source:\n    * give the source a unique name\n    * add the Cost Management application\n    * add the cluster identifier\n4. In the Sources wizard, review the details and click `Finish` to create the Source.\n\n## Upload the reports to cost managment\nUploading reports to cost managment is done through curl:\n\n    $ curl -vvvv -F \"file=@FILE_NAME.tar.gz;type=application/vnd.redhat.hccm.tar+tgz\"  https://cloud.redhat.com/api/ingress/v1/upload -u USERNAME:PASS\n\nwhere `USERNAME` and `PASS` correspond to the user credentials for [console.redhat.com](https://console.redhat.com), and `FILE_NAME` is the name of the report to upload.",
        "displayName": "Cost Management Metrics Operator",
        "installModes": [
          {
            "type": "OwnNamespace",
            "supported": true
          },
          {
            "type": "SingleNamespace",
            "supported": true
          },
          {
            "type": "MultiNamespace",
            "supported": false
          },
          {
            "type": "AllNamespaces",
            "supported": false
          }
        ],
        "keywords": [
          "cost",
          "management",
          "usage",
          "monitor"
        ],
        "maintainers": [
          {
            "name": "costmanagement",
            "email": "costmanagement@redhat.com"
          }
        ],
        "maturity": "alpha",
        "provider": {
          "name": "Red Hat"
        }
      }
    }
  ],
  "relatedImages": [
    {
      "name": "",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:0abc9b30a48080d2a4a413f7818770ea4dd7b78c715a816fe5818ec75326bb69"
    },
    {
      "name": "costmanagement-metrics-rhel8-operator-4c9153b33cc942134e2bd857a8cae47ded38eb789874fde089d67b00d0c2e6f6-annotation",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:4c9153b33cc942134e2bd857a8cae47ded38eb789874fde089d67b00d0c2e6f6"
    },
    {
      "name": "manager",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:4c9153b33cc942134e2bd857a8cae47ded38eb789874fde089d67b00d0c2e6f6"
    }
  ]
}
{
  "schema": "olm.bundle",
  "name": "costmanagement-metrics-operator.1.1.8",
  "package": "costmanagement-metrics-operator",
  "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:2c326d847a0d15677171c69c451a8fd34da9e652169a8c9da7a20d0b7defda28",
  "properties": [
    {
      "type": "olm.gvk",
      "value": {
        "group": "costmanagement-metrics-cfg.openshift.io",
        "kind": "CostManagementMetricsConfig",
        "version": "v1beta1"
      }
    },
    {
      "type": "olm.package",
      "value": {
        "packageName": "costmanagement-metrics-operator",
        "version": "1.1.8"
      }
    },
    {
      "type": "olm.csv.metadata",
      "value": {
        "annotations": {
          "alm-examples": "[\n  {\n    \"apiVersion\": \"costmanagement-metrics-cfg.openshift.io/v1beta1\",\n    \"kind\": \"CostManagementMetricsConfig\",\n    \"metadata\": {\n      \"name\": \"costmanagementmetricscfg-sample-v1beta1\"\n    },\n    \"spec\": {\n      \"authentication\": {\n        \"type\": \"token\"\n      },\n      \"packaging\": {\n        \"max_reports_to_store\": 30,\n        \"max_size_MB\": 100\n      },\n      \"prometheus_config\": {},\n      \"source\": {\n        \"check_cycle\": 1440,\n        \"create_source\": false,\n        \"name\": \"INSERT-SOURCE-NAME\"\n      },\n      \"upload\": {\n        \"upload_cycle\": 360,\n        \"upload_toggle\": true\n      }\n    }\n  }\n]",
          "capabilities": "Seamless Upgrades",
          "categories": "Monitoring",
          "certified": "false",
          "containerImage": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:d1aa318a720495fdc6b05274416be9135a16c27a57a89e6f692de43a3c5c1d09",
          "createdAt": "2022-10-11T19:10:01Z",
          "description": "A Golang-based OpenShift Operator that generates and uploads OpenShift usage metrics to cost management.",
          "operatorframework.io/suggested-namespace": "costmanagement-metrics-operator",
          "operators.openshift.io/infrastructure-features": "[\"Disconnected\"]",
          "operators.operatorframework.io/builder": "operator-sdk-v0.19.4",
          "operators.operatorframework.io/project_layout": "go.kubebuilder.io/v2",
          "repository": "https://github.com/project-koku/koku-metrics-operator",
          "support": "Red Hat"
        },
        "apiServiceDefinitions": {},
        "crdDescriptions": {
          "owned": [
            {
              "name": "costmanagementmetricsconfigs.costmanagement-metrics-cfg.openshift.io",
              "version": "v1beta1",
              "kind": "CostManagementMetricsConfig",
              "description": "CostManagementMetricsConfig is the Schema for the costmanagementmetricsconfig API"
            }
          ]
        },
        "description": "# 1.1.8 Cost Management Metrics Operator\n## Introduction\nThe `costmanagement-metrics-operator` is a component of the [cost managment](https://access.redhat.com/documentation/en-us/cost_management_service) service for Openshift, used to gather the required information from the cluster. It is recommended to be installed in OpenShift 4.6+. This operator obtains OpenShift usage data by querying Prometheus and uploads it to cost management to be processed. The Operator queries Prometheus every hour to create metric reports, which are then packaged and uploaded to cost management at [console.redhat.com](https://console.redhat.com). For more information, reach out to <costmanagement@redhat.com>.\n\nThis operator is capable of functioning within a disconnected/restricted network (aka air-gapped mode). In this mode, the operator will store the packaged reports for manual retrieval instead of being uploaded to cost management. Documentation for installing an operator within a restricted network can be found [here](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html).\n\n## Features and Capabilities\n#### Metrics collection:\nThe Cost Management Metrics Operator (`costmanagement-metrics-operator`) collects the metrics required for cost management by:\n* Querying Prometheus to gather the necessary metrics for cost management.\n* Writing Prometheus queries to CSV report files.\n* Packaging the CSV report files into tarballs.\n\n#### Additional Capabilities:\n* The operator can be configured to automatically upload the packaged reports to cost management through Red Hat Insights Ingress service.\n* The operator can create a source in console.redhat.com. A source is required for cost management to process the uploaded packages.\n* PersistentVolumeClaim (PVC) configuration: The CostManagementMetricsConfig CR can accept a PVC definition and the operator will create and mount the PVC. If one is not provided, a default PVC will be created.\n* Restricted network installation: this operator can function on a restricted network. In this mode, the operator stores the packaged reports for manual retrieval.\n\n## Limitations and Pre-Requisites\n#### Limitations (Potential for metrics data loss)\n* A source **must** exist in console.redhat.com for an uploaded payload to be processed by cost management. The operator sends the payload to the Red Hat Insights Ingress service which usually returns successfully, but the operator does not currently confirm with cost management that the payload was processed. After Ingress accepts the uploaded payload, the payload is removed from the operator and is gone forever. If the data within the payload is not processed, a gap will be introduced in the usage metrics.\n\n**Note** The following limitations are specific to operators configured to run in a restricted network:\n* The `costmanagement-metrics-operator` will not be able to generate new reports if the PVC storage is filled. If this occurs, the reports must be manually deleted from the PVC so that the operator can function as normal.\n* The default report retention is 30 reports (about one week's worth of data). The reports must be manually downloaded and uploaded to console.redhat.com every week, or they will be deleted and the data will be lost.\n\n#### Storage configuration prerequisite\nThe operator will attempt to create and use the following PVC when installed:\n\n      volume_claim_template:\n        apiVersion: v1\n        kind: PersistentVolumeClaim\n        metadata:\n          name: costmanagement-metrics-operator-data\n        spec:\n          accessModes:\n            - ReadWriteOnce\n          resources:\n            requests:\n              storage: 10Gi\n\nIf a different PVC should be utilized, a valid PVC should be specified in the CostManagementMetricsConfig CR as described in the appropriate section below. The PVC to be used may exist already, or the operator will attempt to create it.\n\nTo use the default specification, the follow assumptions must be met:\n1. A default StorageClass is defined.\n2. Dynamic provisioning for that default StorageClass is enabled.\n\nIf these assumptions are not met, the operator will not deploy correctly. In these cases, storage must be manually configured. After configuring storage, a valid PVC template should be supplied in the `volume_claim_template` spec of the CostManagementMetricsConfig CR.\n\n## Configure the costmanagement-metrics-operator\n**Note** There are separate instructions for configuring the `costmanagement-metrics-operator` to run in a restricted network.\n##### Configure authentication\nThe default authentication for the operator is `token`. No further steps are required to configure token authentication. If `basic` is the preferred authentication method, a Secret must be created which holds username and password credentials:\n1. On the left navigation pane, select `Workloads` -> `Secrets` -> select Project: `costmanagement-metrics-operator` -> `Create` -> `Key/Value Secret`\n2. Give the Secret a name and add 2 keys: `username` and `password` (all lowercase). The values for these keys correspond to console.redhat.com credentials.\n3. Select `Create`.\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. For `basic` authentication, edit the following values in the spec:\n    * Replace `authentication: type:` with `basic`.\n    * Add the `secret_name` field under `authentication`, and set it equal to the name of the authentication Secret that was created above. The spec should look similar to the following:\n\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: basic\n        ```\n\n3. To configure the costmanagement-metrics-operator to create a cost management source, edit the following values in the `source` field:\n    * Replace `INSERT-SOURCE-NAME` with the preferred name of the source to be created.\n    * Replace the `create_source` field value with `true`.\n\n    **Note:** if the source already exists, replace `INSERT-SOURCE-NAME` with the existing name, and leave `create_source` as false. This will allow the operator to confirm the source exists.\n4. If not specified, the operator will create a default PersistentVolumeClaim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n5. Select `Create`.\n\n# Restricted Network Usage (disconnected/air-gapped mode)\n## Installation\nTo install the `costmanagement-metrics-operator` in a restricted network, follow the [olm documentation](https://docs.openshift.com/container-platform/4.5/operators/admin/olm-restricted-networks.html). The operator is found in the `community-operators` Catalog in the `registry.redhat.io/redhat/community-operator-index:latest` Index. If pruning the index before pushing to the mirrored registry, keep the `costmanagement-metrics-operator` package.\n\nWithin a restricted network, the operator queries prometheus to gather the necessary usage metrics, writes the query results to CSV files, and packages the reports for storage in the PVC. These reports then need to be manually downloaded from the cluster and uploaded to [console.redhat.com](https://console.redhat.com).\n\n## Configure the costmanagement-metrics-operator for a restricted network\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. Specify the desired storage. If not specified, the operator will create a default Persistent Volume Claim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            storageClassName: <insert-class-name>\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n3. (Optional) Specify the desired report retention. The operator will retain 30 reports by default. This corresponds to approximately one week's worth of data if using the default packaging cycle. To modify the number of retained reports:\n    * Change the `packaging` spec field `max_reports_to_store` to the desired number of reports to retain. Once this max number is reached, the operator will start removing the oldest packages remaining on the PVC:\n\n      ```\n        packaging:\n          max_size_MB: 100\n          max_reports_to_store: 30\n      ```\n\n    **Note:** The number of retained reports directly affects the frequency that reports must be manually downloaded from the PVC. Take caution in setting this to a higher number of reports, as the operator cannot write data to the PVC if the storage is full.\n4. To configure the operator to perform in a restricted network, set the `upload_toggle` to `false`:\n\n  ```\n    upload:\n      upload_cycle: 360,\n      upload_toggle: false\n  ```\n\n5. Select `Create`.\n\n## Download reports from the Operator & clean up the PVC\nIf the `costmanagement-metrics-operator` is configured to run in a restricted network, the metric reports will not automatically upload to cost managment. Instead, they need to be manually copied from the PVC for upload to [console.redhat.com](https://console.redhat.com). The default configuration saves one week of reports which means the process of downloading and uploading reports should be repeated weekly to prevent loss of metrics data. To download the reports, complete the following steps:\n1. Create the following Pod, ensuring the `claimName` matches the PVC containing the report data:\n\n  ```\n    kind: Pod\n    apiVersion: v1\n    metadata:\n      name: volume-shell\n      namespace: costmanagement-metrics-operator\n      labels:\n        app: costmanagement-metrics-operator\n    spec:\n     affinity:\n       podAffinity:\n         requiredDuringSchedulingIgnoredDuringExecution:\n         - labelSelector:\n             matchExpressions:\n             - key: app\n               operator: In\n               values:\n               - costmanagement-metrics-operator\n           topologyKey: kubernetes.io/hostname\n      volumes:\n      - name: costmanagement-metrics-operator-reports\n        persistentVolumeClaim:\n          claimName: costmanagement-metrics-operator-data\n      containers:\n      - name: volume-shell\n        image: busybox\n        command: ['sleep', 'infinity']\n        volumeMounts:\n        - name: costmanagement-metrics-operator-reports\n          mountPath: /tmp/costmanagement-metrics-operator-reports\n  ```\n\n2. Use rsync to copy all of the files ready for upload from the PVC to a local folder:\n\n  ```\n  $ oc rsync volume-shell:/tmp/costmanagement-metrics-operator-reports/upload local/path/to/save/folder\n  ```\n\n3. Once confirming that the files have been successfully copied, use rsh to connect to the pod and delete the contents of the upload folder so that they are no longer in storage:\n\n  ```\n  $ oc rsh volume-shell\n  $ rm /tmp/costmanagement-metrics-operator-reports/upload/*\n  ```\n\n4. (Optional) Delete the pod that was used to connect to the PVC:\n\n  ```\n  $ oc delete -f volume-shell.yaml\n  ```\n\n## Create a source\nIn a restricted network, the `costmanagement-metrics-operator` cannot automatically create a source. This process must be done manually. In the console.redhat.com platform, open the [Sources menu](https://console.redhat.com/settings/sources/) to begin adding an OpenShift source to cost management:\n\nPrerequisites:\n* The cluster identifier which can be found in the CostManagementMetricsConfig CR, the cluster Overview page, or the cluster Help > About.\n\nCreate source:\n1. Navigate to the Sources menu\n2. Select the `Red Hat sources` tab\n3. Create a new `Red Hat Openshift Container Platform` source:\n    * give the source a unique name\n    * add the Cost Management application\n    * add the cluster identifier\n4. In the Sources wizard, review the details and click `Finish` to create the Source.\n\n## Upload the reports to cost managment\nUploading reports to cost managment is done through curl:\n\n    $ curl -vvvv -F \"file=@FILE_NAME.tar.gz;type=application/vnd.redhat.hccm.tar+tgz\"  https://cloud.redhat.com/api/ingress/v1/upload -u USERNAME:PASS\n\nwhere `USERNAME` and `PASS` correspond to the user credentials for [console.redhat.com](https://console.redhat.com), and `FILE_NAME` is the name of the report to upload.",
        "displayName": "Cost Management Metrics Operator",
        "installModes": [
          {
            "type": "OwnNamespace",
            "supported": true
          },
          {
            "type": "SingleNamespace",
            "supported": true
          },
          {
            "type": "MultiNamespace",
            "supported": false
          },
          {
            "type": "AllNamespaces",
            "supported": false
          }
        ],
        "keywords": [
          "cost",
          "management",
          "usage",
          "monitor"
        ],
        "maintainers": [
          {
            "name": "costmanagement",
            "email": "costmanagement@redhat.com"
          }
        ],
        "maturity": "alpha",
        "provider": {
          "name": "Red Hat"
        }
      }
    }
  ],
  "relatedImages": [
    {
      "name": "",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:2c326d847a0d15677171c69c451a8fd34da9e652169a8c9da7a20d0b7defda28"
    },
    {
      "name": "costmanagement-metrics-rhel8-operator-d1aa318a720495fdc6b05274416be9135a16c27a57a89e6f692de43a3c5c1d09-annotation",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:d1aa318a720495fdc6b05274416be9135a16c27a57a89e6f692de43a3c5c1d09"
    },
    {
      "name": "manager",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:d1aa318a720495fdc6b05274416be9135a16c27a57a89e6f692de43a3c5c1d09"
    }
  ]
}
{
  "schema": "olm.bundle",
  "name": "costmanagement-metrics-operator.1.1.9",
  "package": "costmanagement-metrics-operator",
  "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:e2a0375e814938a2e2e4bdf5d7ffa767d19bb80c7bb491c79c4d80254c5fb65e",
  "properties": [
    {
      "type": "olm.gvk",
      "value": {
        "group": "costmanagement-metrics-cfg.openshift.io",
        "kind": "CostManagementMetricsConfig",
        "version": "v1beta1"
      }
    },
    {
      "type": "olm.package",
      "value": {
        "packageName": "costmanagement-metrics-operator",
        "version": "1.1.9"
      }
    },
    {
      "type": "olm.csv.metadata",
      "value": {
        "annotations": {
          "alm-examples": "[\n  {\n    \"apiVersion\": \"costmanagement-metrics-cfg.openshift.io/v1beta1\",\n    \"kind\": \"CostManagementMetricsConfig\",\n    \"metadata\": {\n      \"name\": \"costmanagementmetricscfg-sample-v1beta1\"\n    },\n    \"spec\": {\n      \"authentication\": {\n        \"type\": \"token\"\n      },\n      \"packaging\": {\n        \"max_reports_to_store\": 30,\n        \"max_size_MB\": 100\n      },\n      \"prometheus_config\": {},\n      \"source\": {\n        \"check_cycle\": 1440,\n        \"create_source\": false,\n        \"name\": \"INSERT-SOURCE-NAME\"\n      },\n      \"upload\": {\n        \"upload_cycle\": 360,\n        \"upload_toggle\": true\n      }\n    }\n  }\n]",
          "capabilities": "Seamless Upgrades",
          "categories": "Monitoring",
          "certified": "false",
          "containerImage": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:6bc22b6627b067c91f55a234a5cd0233ab4d7adfc4f023b29ad65ce6ddb4fba2",
          "createdAt": "2022-12-01T18:12:48Z",
          "description": "A Golang-based OpenShift Operator that generates and uploads OpenShift usage metrics to cost management.",
          "operatorframework.io/suggested-namespace": "costmanagement-metrics-operator",
          "operators.openshift.io/infrastructure-features": "[\"Disconnected\"]",
          "operators.openshift.io/valid-subscription": "[\"OpenShift Kubernetes Engine\", \"OpenShift Container Platform\", \"OpenShift Platform Plus\"]",
          "operators.operatorframework.io/builder": "operator-sdk-v0.19.4",
          "operators.operatorframework.io/project_layout": "go.kubebuilder.io/v2",
          "repository": "https://github.com/project-koku/koku-metrics-operator",
          "support": "Red Hat"
        },
        "apiServiceDefinitions": {},
        "crdDescriptions": {
          "owned": [
            {
              "name": "costmanagementmetricsconfigs.costmanagement-metrics-cfg.openshift.io",
              "version": "v1beta1",
              "kind": "CostManagementMetricsConfig",
              "description": "CostManagementMetricsConfig is the Schema for the costmanagementmetricsconfig API"
            }
          ]
        },
        "description": "# 1.1.9 Cost Management Metrics Operator\n## Introduction\nThe `costmanagement-metrics-operator` is a component of the [cost managment](https://access.redhat.com/documentation/en-us/cost_management_service) service for Openshift, used to gather the required information from the cluster. It is recommended to be installed in OpenShift 4.6+. This operator obtains OpenShift usage data by querying Prometheus and uploads it to cost management to be processed. The Operator queries Prometheus every hour to create metric reports, which are then packaged and uploaded to cost management at [console.redhat.com](https://console.redhat.com). For more information, reach out to <costmanagement@redhat.com>.\n\nThis operator is capable of functioning within a disconnected/restricted network (aka air-gapped mode). In this mode, the operator will store the packaged reports for manual retrieval instead of being uploaded to cost management. Documentation for installing an operator within a restricted network can be found [here](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html).\n\n## Features and Capabilities\n#### Metrics collection:\nThe Cost Management Metrics Operator (`costmanagement-metrics-operator`) collects the metrics required for cost management by:\n* Querying Prometheus to gather the necessary metrics for cost management.\n* Writing Prometheus queries to CSV report files.\n* Packaging the CSV report files into tarballs.\n\n#### Additional Capabilities:\n* The operator can be configured to automatically upload the packaged reports to cost management through Red Hat Insights Ingress service.\n* The operator can create a source in console.redhat.com. A source is required for cost management to process the uploaded packages.\n* PersistentVolumeClaim (PVC) configuration: The CostManagementMetricsConfig CR can accept a PVC definition and the operator will create and mount the PVC. If one is not provided, a default PVC will be created.\n* Restricted network installation: this operator can function on a restricted network. In this mode, the operator stores the packaged reports for manual retrieval.\n\n## Limitations and Pre-Requisites\n#### Limitations (Potential for metrics data loss)\n* A source **must** exist in console.redhat.com for an uploaded payload to be processed by cost management. The operator sends the payload to the Red Hat Insights Ingress service which usually returns successfully, but the operator does not currently confirm with cost management that the payload was processed. After Ingress accepts the uploaded payload, the payload is removed from the operator and is gone forever. If the data within the payload is not processed, a gap will be introduced in the usage metrics.\n\n**Note** The following limitations are specific to operators configured to run in a restricted network:\n* The `costmanagement-metrics-operator` will not be able to generate new reports if the PVC storage is filled. If this occurs, the reports must be manually deleted from the PVC so that the operator can function as normal.\n* The default report retention is 30 reports (about one week's worth of data). The reports must be manually downloaded and uploaded to console.redhat.com every week, or they will be deleted and the data will be lost.\n\n#### Storage configuration prerequisite\nThe operator will attempt to create and use the following PVC when installed:\n\n      volume_claim_template:\n        apiVersion: v1\n        kind: PersistentVolumeClaim\n        metadata:\n          name: costmanagement-metrics-operator-data\n        spec:\n          accessModes:\n            - ReadWriteOnce\n          resources:\n            requests:\n              storage: 10Gi\n\nIf a different PVC should be utilized, a valid PVC should be specified in the CostManagementMetricsConfig CR as described in the appropriate section below. The PVC to be used may exist already, or the operator will attempt to create it.\n\nTo use the default specification, the follow assumptions must be met:\n1. A default StorageClass is defined.\n2. Dynamic provisioning for that default StorageClass is enabled.\n\nIf these assumptions are not met, the operator will not deploy correctly. In these cases, storage must be manually configured. After configuring storage, a valid PVC template should be supplied in the `volume_claim_template` spec of the CostManagementMetricsConfig CR.\n\n## Configure the costmanagement-metrics-operator\n**Note** There are separate instructions for configuring the `costmanagement-metrics-operator` to run in a restricted network.\n##### Configure authentication\nThe default authentication for the operator is `token`. No further steps are required to configure token authentication. If `basic` is the preferred authentication method, a Secret must be created which holds username and password credentials:\n1. On the left navigation pane, select `Workloads` -> `Secrets` -> select Project: `costmanagement-metrics-operator` -> `Create` -> `Key/Value Secret`\n2. Give the Secret a name and add 2 keys: `username` and `password` (all lowercase). The values for these keys correspond to console.redhat.com credentials.\n3. Select `Create`.\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. For `basic` authentication, edit the following values in the spec:\n    * Replace `authentication: type:` with `basic`.\n    * Add the `secret_name` field under `authentication`, and set it equal to the name of the authentication Secret that was created above. The spec should look similar to the following:\n\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: basic\n        ```\n\n3. To configure the costmanagement-metrics-operator to create a cost management source, edit the following values in the `source` field:\n    * Replace `INSERT-SOURCE-NAME` with the preferred name of the source to be created.\n    * Replace the `create_source` field value with `true`.\n\n    **Note:** if the source already exists, replace `INSERT-SOURCE-NAME` with the existing name, and leave `create_source` as false. This will allow the operator to confirm the source exists.\n4. If not specified, the operator will create a default PersistentVolumeClaim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n5. Select `Create`.\n\n# Restricted Network Usage (disconnected/air-gapped mode)\n## Installation\nTo install the `costmanagement-metrics-operator` in a restricted network, follow the [olm documentation](https://docs.openshift.com/container-platform/4.5/operators/admin/olm-restricted-networks.html). The operator is found in the `community-operators` Catalog in the `registry.redhat.io/redhat/community-operator-index:latest` Index. If pruning the index before pushing to the mirrored registry, keep the `costmanagement-metrics-operator` package.\n\nWithin a restricted network, the operator queries prometheus to gather the necessary usage metrics, writes the query results to CSV files, and packages the reports for storage in the PVC. These reports then need to be manually downloaded from the cluster and uploaded to [console.redhat.com](https://console.redhat.com).\n\n## Configure the costmanagement-metrics-operator for a restricted network\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. Specify the desired storage. If not specified, the operator will create a default Persistent Volume Claim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            storageClassName: <insert-class-name>\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n3. (Optional) Specify the desired report retention. The operator will retain 30 reports by default. This corresponds to approximately one week's worth of data if using the default packaging cycle. To modify the number of retained reports:\n    * Change the `packaging` spec field `max_reports_to_store` to the desired number of reports to retain. Once this max number is reached, the operator will start removing the oldest packages remaining on the PVC:\n\n      ```\n        packaging:\n          max_size_MB: 100\n          max_reports_to_store: 30\n      ```\n\n    **Note:** The number of retained reports directly affects the frequency that reports must be manually downloaded from the PVC. Take caution in setting this to a higher number of reports, as the operator cannot write data to the PVC if the storage is full.\n4. To configure the operator to perform in a restricted network, set the `upload_toggle` to `false`:\n\n  ```\n    upload:\n      upload_cycle: 360,\n      upload_toggle: false\n  ```\n\n5. Select `Create`.\n\n## Download reports from the Operator & clean up the PVC\nIf the `costmanagement-metrics-operator` is configured to run in a restricted network, the metric reports will not automatically upload to cost managment. Instead, they need to be manually copied from the PVC for upload to [console.redhat.com](https://console.redhat.com). The default configuration saves one week of reports which means the process of downloading and uploading reports should be repeated weekly to prevent loss of metrics data. To download the reports, complete the following steps:\n1. Create the following Pod, ensuring the `claimName` matches the PVC containing the report data:\n\n  ```\n    kind: Pod\n    apiVersion: v1\n    metadata:\n      name: volume-shell\n      namespace: costmanagement-metrics-operator\n      labels:\n        app: costmanagement-metrics-operator\n    spec:\n     affinity:\n       podAffinity:\n         requiredDuringSchedulingIgnoredDuringExecution:\n         - labelSelector:\n             matchExpressions:\n             - key: app\n               operator: In\n               values:\n               - costmanagement-metrics-operator\n           topologyKey: kubernetes.io/hostname\n      volumes:\n      - name: costmanagement-metrics-operator-reports\n        persistentVolumeClaim:\n          claimName: costmanagement-metrics-operator-data\n      containers:\n      - name: volume-shell\n        image: busybox\n        command: ['sleep', 'infinity']\n        volumeMounts:\n        - name: costmanagement-metrics-operator-reports\n          mountPath: /tmp/costmanagement-metrics-operator-reports\n  ```\n\n2. Use rsync to copy all of the files ready for upload from the PVC to a local folder:\n\n  ```\n  $ oc rsync volume-shell:/tmp/costmanagement-metrics-operator-reports/upload local/path/to/save/folder\n  ```\n\n3. Once confirming that the files have been successfully copied, use rsh to connect to the pod and delete the contents of the upload folder so that they are no longer in storage:\n\n  ```\n  $ oc rsh volume-shell\n  $ rm /tmp/costmanagement-metrics-operator-reports/upload/*\n  ```\n\n4. (Optional) Delete the pod that was used to connect to the PVC:\n\n  ```\n  $ oc delete -f volume-shell.yaml\n  ```\n\n## Create a source\nIn a restricted network, the `costmanagement-metrics-operator` cannot automatically create a source. This process must be done manually. In the console.redhat.com platform, open the [Sources menu](https://console.redhat.com/settings/sources/) to begin adding an OpenShift source to cost management:\n\nPrerequisites:\n* The cluster identifier which can be found in the CostManagementMetricsConfig CR, the cluster Overview page, or the cluster Help > About.\n\nCreate source:\n1. Navigate to the Sources menu\n2. Select the `Red Hat sources` tab\n3. Create a new `Red Hat Openshift Container Platform` source:\n    * give the source a unique name\n    * add the Cost Management application\n    * add the cluster identifier\n4. In the Sources wizard, review the details and click `Finish` to create the Source.\n\n## Upload the reports to cost managment\nUploading reports to cost managment is done through curl:\n\n    $ curl -vvvv -F \"file=@FILE_NAME.tar.gz;type=application/vnd.redhat.hccm.tar+tgz\"  https://cloud.redhat.com/api/ingress/v1/upload -u USERNAME:PASS\n\nwhere `USERNAME` and `PASS` correspond to the user credentials for [console.redhat.com](https://console.redhat.com), and `FILE_NAME` is the name of the report to upload.",
        "displayName": "Cost Management Metrics Operator",
        "installModes": [
          {
            "type": "OwnNamespace",
            "supported": true
          },
          {
            "type": "SingleNamespace",
            "supported": true
          },
          {
            "type": "MultiNamespace",
            "supported": false
          },
          {
            "type": "AllNamespaces",
            "supported": false
          }
        ],
        "keywords": [
          "cost",
          "management",
          "usage",
          "monitor"
        ],
        "maintainers": [
          {
            "name": "costmanagement",
            "email": "costmanagement@redhat.com"
          }
        ],
        "maturity": "alpha",
        "provider": {
          "name": "Red Hat"
        }
      }
    }
  ],
  "relatedImages": [
    {
      "name": "",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:e2a0375e814938a2e2e4bdf5d7ffa767d19bb80c7bb491c79c4d80254c5fb65e"
    },
    {
      "name": "costmanagement-metrics-rhel8-operator-6bc22b6627b067c91f55a234a5cd0233ab4d7adfc4f023b29ad65ce6ddb4fba2-annotation",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:6bc22b6627b067c91f55a234a5cd0233ab4d7adfc4f023b29ad65ce6ddb4fba2"
    },
    {
      "name": "manager",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:6bc22b6627b067c91f55a234a5cd0233ab4d7adfc4f023b29ad65ce6ddb4fba2"
    }
  ]
}
{
  "schema": "olm.bundle",
  "name": "costmanagement-metrics-operator.1.2.0",
  "package": "costmanagement-metrics-operator",
  "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:1fc8b1b5496df4a2f9ef9d9307b85ad14a89a4e567933d67fea50cddf662cd1c",
  "properties": [
    {
      "type": "olm.gvk",
      "value": {
        "group": "costmanagement-metrics-cfg.openshift.io",
        "kind": "CostManagementMetricsConfig",
        "version": "v1beta1"
      }
    },
    {
      "type": "olm.package",
      "value": {
        "packageName": "costmanagement-metrics-operator",
        "version": "1.2.0"
      }
    },
    {
      "type": "olm.csv.metadata",
      "value": {
        "annotations": {
          "alm-examples": "[\n  {\n    \"apiVersion\": \"costmanagement-metrics-cfg.openshift.io/v1beta1\",\n    \"kind\": \"CostManagementMetricsConfig\",\n    \"metadata\": {\n      \"name\": \"costmanagementmetricscfg-sample-v1beta1\"\n    },\n    \"spec\": {\n      \"authentication\": {\n        \"type\": \"token\"\n      },\n      \"packaging\": {\n        \"max_reports_to_store\": 30,\n        \"max_size_MB\": 100\n      },\n      \"prometheus_config\": {},\n      \"source\": {\n        \"check_cycle\": 1440,\n        \"create_source\": false,\n        \"name\": \"INSERT-SOURCE-NAME\"\n      },\n      \"upload\": {\n        \"upload_cycle\": 360,\n        \"upload_toggle\": true\n      }\n    }\n  }\n]",
          "capabilities": "Seamless Upgrades",
          "categories": "Monitoring",
          "certified": "false",
          "containerImage": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:2ba8cbaa8232a3506c6f7d79360102a678091275a0138882df14c7da820ebb1b",
          "createdAt": "2023-01-18T17:01:13Z",
          "description": "A Golang-based OpenShift Operator that generates and uploads OpenShift usage metrics to cost management.",
          "operatorframework.io/suggested-namespace": "costmanagement-metrics-operator",
          "operators.openshift.io/infrastructure-features": "[\"Disconnected\"]",
          "operators.openshift.io/valid-subscription": "[\"OpenShift Kubernetes Engine\", \"OpenShift Container Platform\", \"OpenShift Platform Plus\"]",
          "operators.operatorframework.io/builder": "operator-sdk-v0.19.4",
          "operators.operatorframework.io/project_layout": "go.kubebuilder.io/v2",
          "repository": "https://github.com/project-koku/koku-metrics-operator",
          "support": "Red Hat"
        },
        "apiServiceDefinitions": {},
        "crdDescriptions": {
          "owned": [
            {
              "name": "costmanagementmetricsconfigs.costmanagement-metrics-cfg.openshift.io",
              "version": "v1beta1",
              "kind": "CostManagementMetricsConfig",
              "description": "CostManagementMetricsConfig is the Schema for the costmanagementmetricsconfig API"
            }
          ]
        },
        "description": "# 1.2.0 Cost Management Metrics Operator\n## Introduction\nThe `costmanagement-metrics-operator` is a component of the [cost managment](https://access.redhat.com/documentation/en-us/cost_management_service) service for Openshift, used to gather the required information from the cluster. It is recommended to be installed in OpenShift 4.6+. This operator obtains OpenShift usage data by querying Prometheus and uploads it to cost management to be processed. The Operator queries Prometheus every hour to create metric reports, which are then packaged and uploaded to cost management at [console.redhat.com](https://console.redhat.com). For more information, reach out to <costmanagement@redhat.com>.\n\nThis operator is capable of functioning within a disconnected/restricted network (aka air-gapped mode). In this mode, the operator will store the packaged reports for manual retrieval instead of being uploaded to cost management. Documentation for installing an operator within a restricted network can be found [here](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html).\n\n## Features and Capabilities\n#### Metrics collection:\nThe Cost Management Metrics Operator (`costmanagement-metrics-operator`) collects the metrics required for cost management by:\n* Querying Prometheus to gather the necessary metrics for cost management.\n* Writing Prometheus queries to CSV report files.\n* Packaging the CSV report files into tarballs.\n\n#### Additional Capabilities:\n* The operator can be configured to automatically upload the packaged reports to cost management through Red Hat Insights Ingress service.\n* The operator can create a source in console.redhat.com. A source is required for cost management to process the uploaded packages.\n* PersistentVolumeClaim (PVC) configuration: The CostManagementMetricsConfig CR can accept a PVC definition and the operator will create and mount the PVC. If one is not provided, a default PVC will be created.\n* Restricted network installation: this operator can function on a restricted network. In this mode, the operator stores the packaged reports for manual retrieval.\n\n## Limitations and Pre-Requisites\n#### Limitations (Potential for metrics data loss)\n* A source **must** exist in console.redhat.com for an uploaded payload to be processed by cost management. The operator sends the payload to the Red Hat Insights Ingress service which usually returns successfully, but the operator does not currently confirm with cost management that the payload was processed. After Ingress accepts the uploaded payload, the payload is removed from the operator and is gone forever. If the data within the payload is not processed, a gap will be introduced in the usage metrics.\n\n**Note** The following limitations are specific to operators configured to run in a restricted network:\n* The `costmanagement-metrics-operator` will not be able to generate new reports if the PVC storage is filled. If this occurs, the reports must be manually deleted from the PVC so that the operator can function as normal.\n* The default report retention is 30 reports (about one week's worth of data). The reports must be manually downloaded and uploaded to console.redhat.com every week, or they will be deleted and the data will be lost.\n\n#### Storage configuration prerequisite\nThe operator will attempt to create and use the following PVC when installed:\n\n      volume_claim_template:\n        apiVersion: v1\n        kind: PersistentVolumeClaim\n        metadata:\n          name: costmanagement-metrics-operator-data\n        spec:\n          accessModes:\n            - ReadWriteOnce\n          resources:\n            requests:\n              storage: 10Gi\n\nIf a different PVC should be utilized, a valid PVC should be specified in the CostManagementMetricsConfig CR as described in the appropriate section below. The PVC to be used may exist already, or the operator will attempt to create it.\n\nTo use the default specification, the follow assumptions must be met:\n1. A default StorageClass is defined.\n2. Dynamic provisioning for that default StorageClass is enabled.\n\nIf these assumptions are not met, the operator will not deploy correctly. In these cases, storage must be manually configured. After configuring storage, a valid PVC template should be supplied in the `volume_claim_template` spec of the CostManagementMetricsConfig CR.\n\n## Configure the costmanagement-metrics-operator\n**Note** There are separate instructions for configuring the `costmanagement-metrics-operator` to run in a restricted network.\n##### Configure authentication\nThe default authentication for the operator is `token`. No further steps are required to configure token authentication. If `basic` is the preferred authentication method, a Secret must be created which holds username and password credentials:\n1. On the left navigation pane, select `Workloads` -> `Secrets` -> select Project: `costmanagement-metrics-operator` -> `Create` -> `Key/Value Secret`\n2. Give the Secret a name and add 2 keys: `username` and `password` (all lowercase). The values for these keys correspond to console.redhat.com credentials.\n3. Select `Create`.\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. For `basic` authentication, edit the following values in the spec:\n    * Replace `authentication: type:` with `basic`.\n    * Add the `secret_name` field under `authentication`, and set it equal to the name of the authentication Secret that was created above. The spec should look similar to the following:\n\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: basic\n        ```\n\n3. To configure the costmanagement-metrics-operator to create a cost management source, edit the following values in the `source` field:\n    * Replace `INSERT-SOURCE-NAME` with the preferred name of the source to be created.\n    * Replace the `create_source` field value with `true`.\n\n    **Note:** if the source already exists, replace `INSERT-SOURCE-NAME` with the existing name, and leave `create_source` as false. This will allow the operator to confirm the source exists.\n4. If not specified, the operator will create a default PersistentVolumeClaim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n5. Select `Create`.\n\n# Restricted Network Usage (disconnected/air-gapped mode)\n## Installation\nTo install the `costmanagement-metrics-operator` in a restricted network, follow the [olm documentation](https://docs.openshift.com/container-platform/4.5/operators/admin/olm-restricted-networks.html). The operator is found in the `community-operators` Catalog in the `registry.redhat.io/redhat/community-operator-index:latest` Index. If pruning the index before pushing to the mirrored registry, keep the `costmanagement-metrics-operator` package.\n\nWithin a restricted network, the operator queries prometheus to gather the necessary usage metrics, writes the query results to CSV files, and packages the reports for storage in the PVC. These reports then need to be manually downloaded from the cluster and uploaded to [console.redhat.com](https://console.redhat.com).\n\n## Configure the costmanagement-metrics-operator for a restricted network\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. Specify the desired storage. If not specified, the operator will create a default Persistent Volume Claim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            storageClassName: <insert-class-name>\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n3. (Optional) Specify the desired report retention. The operator will retain 30 reports by default. This corresponds to approximately one week's worth of data if using the default packaging cycle. To modify the number of retained reports:\n    * Change the `packaging` spec field `max_reports_to_store` to the desired number of reports to retain. Once this max number is reached, the operator will start removing the oldest packages remaining on the PVC:\n\n      ```\n        packaging:\n          max_size_MB: 100\n          max_reports_to_store: 30\n      ```\n\n    **Note:** The number of retained reports directly affects the frequency that reports must be manually downloaded from the PVC. Take caution in setting this to a higher number of reports, as the operator cannot write data to the PVC if the storage is full.\n4. To configure the operator to perform in a restricted network, set the `upload_toggle` to `false`:\n\n  ```\n    upload:\n      upload_cycle: 360,\n      upload_toggle: false\n  ```\n\n5. Select `Create`.\n\n## Download reports from the Operator & clean up the PVC\nIf the `costmanagement-metrics-operator` is configured to run in a restricted network, the metric reports will not automatically upload to cost managment. Instead, they need to be manually copied from the PVC for upload to [console.redhat.com](https://console.redhat.com). The default configuration saves one week of reports which means the process of downloading and uploading reports should be repeated weekly to prevent loss of metrics data. To download the reports, complete the following steps:\n1. Create the following Pod, ensuring the `claimName` matches the PVC containing the report data:\n\n  ```\n    kind: Pod\n    apiVersion: v1\n    metadata:\n      name: volume-shell\n      namespace: costmanagement-metrics-operator\n      labels:\n        app: costmanagement-metrics-operator\n    spec:\n      volumes:\n      - name: costmanagement-metrics-operator-reports\n        persistentVolumeClaim:\n          claimName: costmanagement-metrics-operator-data\n      containers:\n      - name: volume-shell\n        image: busybox\n        command: ['sleep', 'infinity']\n        volumeMounts:\n        - name: costmanagement-metrics-operator-reports\n          mountPath: /tmp/costmanagement-metrics-operator-reports\n  ```\n\n2. Use rsync to copy all of the files ready for upload from the PVC to a local folder:\n\n  ```\n  $ oc rsync volume-shell:/tmp/costmanagement-metrics-operator-reports/upload local/path/to/save/folder\n  ```\n\n3. Once confirming that the files have been successfully copied, use rsh to connect to the pod and delete the contents of the upload folder so that they are no longer in storage:\n\n  ```\n  $ oc rsh volume-shell\n  $ rm /tmp/costmanagement-metrics-operator-reports/upload/*\n  ```\n\n4. (Optional) Delete the pod that was used to connect to the PVC:\n\n  ```\n  $ oc delete -f volume-shell.yaml\n  ```\n\n## Create a source\nIn a restricted network, the `costmanagement-metrics-operator` cannot automatically create a source. This process must be done manually. In the console.redhat.com platform, open the [Sources menu](https://console.redhat.com/settings/sources/) to begin adding an OpenShift source to cost management:\n\nPrerequisites:\n* The cluster identifier which can be found in the CostManagementMetricsConfig CR, the cluster Overview page, or the cluster Help > About.\n\nCreate source:\n1. Navigate to the Sources menu\n2. Select the `Red Hat sources` tab\n3. Create a new `Red Hat Openshift Container Platform` source:\n    * give the source a unique name\n    * add the Cost Management application\n    * add the cluster identifier\n4. In the Sources wizard, review the details and click `Finish` to create the Source.\n\n## Upload the reports to cost managment\nUploading reports to cost managment is done through curl:\n\n    $ curl -vvvv -F \"file=@FILE_NAME.tar.gz;type=application/vnd.redhat.hccm.tar+tgz\"  https://cloud.redhat.com/api/ingress/v1/upload -u USERNAME:PASS\n\nwhere `USERNAME` and `PASS` correspond to the user credentials for [console.redhat.com](https://console.redhat.com), and `FILE_NAME` is the name of the report to upload.",
        "displayName": "Cost Management Metrics Operator",
        "installModes": [
          {
            "type": "OwnNamespace",
            "supported": true
          },
          {
            "type": "SingleNamespace",
            "supported": true
          },
          {
            "type": "MultiNamespace",
            "supported": false
          },
          {
            "type": "AllNamespaces",
            "supported": false
          }
        ],
        "keywords": [
          "cost",
          "management",
          "usage",
          "monitor"
        ],
        "maintainers": [
          {
            "name": "costmanagement",
            "email": "costmanagement@redhat.com"
          }
        ],
        "maturity": "alpha",
        "provider": {
          "name": "Red Hat"
        }
      }
    }
  ],
  "relatedImages": [
    {
      "name": "",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:1fc8b1b5496df4a2f9ef9d9307b85ad14a89a4e567933d67fea50cddf662cd1c"
    },
    {
      "name": "costmanagement-metrics-rhel8-operator-2ba8cbaa8232a3506c6f7d79360102a678091275a0138882df14c7da820ebb1b-annotation",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:2ba8cbaa8232a3506c6f7d79360102a678091275a0138882df14c7da820ebb1b"
    },
    {
      "name": "manager",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:2ba8cbaa8232a3506c6f7d79360102a678091275a0138882df14c7da820ebb1b"
    }
  ]
}
{
  "schema": "olm.bundle",
  "name": "costmanagement-metrics-operator.2.0.0",
  "package": "costmanagement-metrics-operator",
  "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:12338c0a58b7a2e8f1f201512a43675e1df1f3eae0feec0ffd8df4295b499a92",
  "properties": [
    {
      "type": "olm.gvk",
      "value": {
        "group": "costmanagement-metrics-cfg.openshift.io",
        "kind": "CostManagementMetricsConfig",
        "version": "v1beta1"
      }
    },
    {
      "type": "olm.package",
      "value": {
        "packageName": "costmanagement-metrics-operator",
        "version": "2.0.0"
      }
    },
    {
      "type": "olm.csv.metadata",
      "value": {
        "annotations": {
          "alm-examples": "[\n  {\n    \"apiVersion\": \"costmanagement-metrics-cfg.openshift.io/v1beta1\",\n    \"kind\": \"CostManagementMetricsConfig\",\n    \"metadata\": {\n      \"name\": \"costmanagementmetricscfg-sample-v1beta1\"\n    },\n    \"spec\": {\n      \"authentication\": {\n        \"type\": \"token\"\n      },\n      \"packaging\": {\n        \"max_reports_to_store\": 30,\n        \"max_size_MB\": 100\n      },\n      \"prometheus_config\": {\n        \"collect_previous_data\": true,\n        \"context_timeout\": 120,\n        \"disable_metrics_collection_cost_management\": false,\n        \"disable_metrics_collection_resource_optimization\": false\n      },\n      \"source\": {\n        \"check_cycle\": 1440,\n        \"create_source\": false,\n        \"name\": \"INSERT-SOURCE-NAME\"\n      },\n      \"upload\": {\n        \"upload_cycle\": 360,\n        \"upload_toggle\": true\n      }\n    }\n  }\n]",
          "capabilities": "Seamless Upgrades",
          "categories": "Monitoring",
          "certified": "true",
          "containerImage": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:6f320a64ab1212509647b8b259445349b31935f3968748ba53886076fc4c8606",
          "createdAt": "2023-04-20T16:04:37Z",
          "description": "A Golang-based OpenShift Operator that generates and uploads OpenShift usage metrics to cost management.",
          "operatorframework.io/suggested-namespace": "costmanagement-metrics-operator",
          "operators.openshift.io/infrastructure-features": "[\"Disconnected\"]",
          "operators.openshift.io/valid-subscription": "[\"OpenShift Kubernetes Engine\", \"OpenShift Container Platform\", \"OpenShift Platform Plus\"]",
          "operators.operatorframework.io/builder": "operator-sdk-v1.25.3",
          "operators.operatorframework.io/project_layout": "go.kubebuilder.io/v2",
          "repository": "https://github.com/project-koku/koku-metrics-operator",
          "support": "Red Hat"
        },
        "apiServiceDefinitions": {},
        "crdDescriptions": {
          "owned": [
            {
              "name": "costmanagementmetricsconfigs.costmanagement-metrics-cfg.openshift.io",
              "version": "v1beta1",
              "kind": "CostManagementMetricsConfig",
              "description": "CostManagementMetricsConfig is the Schema for the costmanagementmetricsconfig API"
            }
          ]
        },
        "description": "# 2.0.0 Cost Management Metrics Operator\n## Introduction\nThe `costmanagement-metrics-operator` is a component of the [cost managment](https://access.redhat.com/documentation/en-us/cost_management_service) service for Openshift, used to gather the required information from the cluster. It is recommended to be installed in OpenShift 4.8+. This operator obtains OpenShift usage data by querying Prometheus and uploads it to cost management to be processed. The Operator queries Prometheus every hour to create metric reports, which are then packaged and uploaded to cost management at [console.redhat.com](https://console.redhat.com). For more information, reach out to <costmanagement@redhat.com>.\n\nThis operator is capable of functioning within a disconnected/restricted network (aka air-gapped mode). In this mode, the operator will store the packaged reports for manual retrieval instead of being uploaded to cost management. Documentation for installing an operator within a restricted network can be found [here](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html).\n\n## Features and Capabilities\n#### Metrics collection:\nThe CostManagement Metrics Operator (`costmanagement-metrics-operator`) collects the metrics required for cost management by:\n* Querying Prometheus to gather the necessary metrics for cost management.\n* Writing Prometheus queries to CSV report files.\n* Packaging the CSV report files into tarballs.\n\n#### Additional Capabilities:\n* Resource Optimization metrics collection.\n* The operator can be configured to gather all previous data within the configured retention period or a maximum of 90 days. The default data collection period is the 14 previous days. This setting is only applicable to newly created CostManagementMetricsConfigs.\n* The operator can be configured to automatically upload the packaged reports to cost management through Red Hat Insights Ingress service.\n* The operator can create a source in console.redhat.com. A source is required for cost management to process the uploaded packages.\n* PersistentVolumeClaim (PVC) configuration: The CostManagementMetricsConfig CR can accept a PVC definition and the operator will create and mount the PVC. If one is not provided, a default PVC will be created.\n* Restricted network installation: this operator can function on a restricted network. In this mode, the operator stores the packaged reports for manual retrieval.\n\n## New in v2.0.0:\n* Adds metrics and report generation for resource optimization. This feature will collect additional usage metrics and create a new report in the payload. These metrics are enabled by default, but can be disabled by setting `disable_metrics_collection_resource_optimization` to `true`.\n* Collect all available Prometheus data upon CR creation. This feature only applies to newly created CostManagementMetricsConfigs. The operator will check the monitoring stack configuration in the `openshift-monitoring` namespace. The operator will use the `retention` period set in the `cluster-monitoring-config` ConfigMap if defined, up to a maximum of 90 days. Otherwise it will fall back to collecting 14 days of data, if available. This data collection may be disabled by setting `collect_previous_data` to `false`. Turning this feature off results in the operator collecting metrics from the time the CostManagementMetricsConfig is created, forward.\n\n## Limitations and Pre-Requisites\n#### Limitations (Potential for metrics data loss)\n* A source **must** exist in console.redhat.com for an uploaded payload to be processed by cost management. The operator sends the payload to the Red Hat Insights Ingress service which usually returns successfully, but the operator does not currently confirm with cost management that the payload was processed. After Ingress accepts the uploaded payload, the payload is removed from the operator and is gone forever. If the data within the payload is not processed, a gap will be introduced in the usage metrics.\n\n**Note** The following limitations are specific to operators configured to run in a restricted network:\n* The `costmanagement-metrics-operator` will not be able to generate new reports if the PVC storage is filled. If this occurs, the reports must be manually deleted from the PVC so that the operator can function as normal.\n* The default report retention is 30 reports (about one week's worth of data). The reports must be manually downloaded and uploaded to console.redhat.com every week, or they will be deleted and the data will be lost.\n\n#### Storage configuration prerequisite\nThe operator will attempt to create and use the following PVC when installed:\n\n      volume_claim_template:\n        apiVersion: v1\n        kind: PersistentVolumeClaim\n        metadata:\n          name: costmanagement-metrics-operator-data\n        spec:\n          accessModes:\n            - ReadWriteOnce\n          resources:\n            requests:\n              storage: 10Gi\n\nIf a different PVC should be utilized, a valid PVC should be specified in the CostManagementMetricsConfig CR as described in the appropriate section below. The PVC to be used may exist already, or the operator will attempt to create it.\n\nTo use the default specification, the follow assumptions must be met:\n1. A default StorageClass is defined.\n2. Dynamic provisioning for that default StorageClass is enabled.\n\nIf these assumptions are not met, the operator will not deploy correctly. In these cases, storage must be manually configured. After configuring storage, a valid PVC template should be supplied in the `volume_claim_template` spec of the CostManagementMetricsConfig CR.\n\n## Configurable parameters:\n  * `authentication`:\n    * `type: token` -> The authentication method for connecting to `console.redhat.com`. The default and preferred method is `token`. `basic` is used when the openshift-config pull-secret does not contain a token for `cloud.redhat.com`.\n    * `secret_name` -> The Secret used by the operator when the authentication type is `basic`. This parameter is required **only if** the authentication type is `basic`.\n  * `packaging`:\n    * `max_reports_to_store: 30` -> The number of reports to store when configured in air-gapped mode. The default is 30, with a minimum of 1 and no maximum. When the operator is not configured in air-gapped mode, this parameter has no effect. Reports are removed as soon as they are uploaded.\n    * `max_size: 100` -> The maximum size for packaged files in Megabytes prior to compression. The default is 100, with a minimum of 1 and maximum of 100.\n  * `prometheus_config`:\n    * `collect_previous_data: true` -> Toggle for collecting all available data in Prometheus **upon CostManagementMetricsConfig creation** (This parameter will start to appear in CostManagementMetricsConfigs that were created prior to v2.0.0 but will not have any effect unless the CostManagementMetricsConfig is deleted and recreated). The default is `true`. The operator will first look for a `retention` period in the `cluster-monitoring-config` ConfigMap in the `openshift-monitoring` namespace and gather data over this time period up to a maximum of 90 days. If this configuration is not set, the default is 14 days. (New in v2.0.0)\n    * `disable_metrics_collection_cost_management: false` -> Toggle for disabling the collection of metrics for Cost Management. The default is false. (New in v2.0.0)\n    * `disable_metrics_collection_resource_optimization: false` -> Toggle for disabling the collection of metrics for Resource Optimization. The default is false. (New in v2.0.0)\n    * `context_timeout: 120` -> The time in seconds before Prometheus queries timeout due to exceeding context timeout. The default is 120, with a minimum of 10 and maximum of 180.\n  * `source`:\n    * `name: INSERT_SOURCE_NAME` -> The name of the Source the operator will create in `console.redhat.com`. The default is `INSERT_SOURCE_NAME` which is a placeholder.\n    * `create_source: false` -> Toggle for whether or not the operator will create the Source in `console.redhat.com`. The default is False. This parameter should be switched to True when a Source does not already exist in `console.redhat.com` for this cluster.\n    * `check_cycle: 1440` -> The time in minutes to wait between checking if a Source exists for this cluster. The default is 1440 minutes (24 hrs).\n  * `upload`:\n    * `upload_cycle: 360` -> The time in minutes between payload uploads. The default is 360 (6 hours).\n    * `upload_toggle: true` -> Toggle to turn upload on or off -> true means upload, false means do not upload (false == air-gapped mode). The default is `true`.\n    * `upload_wait` -> The amount of time (in seconds) to pause before uploading a payload. The default is a random number between 0 and 35. This is used to decrease service load, but may be set to `0` if desired.\n  * `volume_claim_template` -> see the \"Storage configuration prerequisite\" section above.\n\n## Configure the costmanagement-metrics-operator\n**Note** There are separate instructions for configuring the `costmanagement-metrics-operator` to run in a restricted network.\n##### Configure authentication\nThe default authentication for the operator is `token`. No further steps are required to configure token authentication. If `basic` is the preferred authentication method, a Secret must be created which holds username and password credentials:\n1. On the left navigation pane, select `Workloads` -> `Secrets` -> select Project: `costmanagement-metrics-operator` -> `Create` -> `Key/Value Secret`\n2. Give the Secret a name and add 2 keys: `username` and `password` (all lowercase). The values for these keys correspond to console.redhat.com credentials.\n3. Select `Create`.\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. For `basic` authentication, edit the following values in the spec:\n    * Replace `authentication: type:` with `basic`.\n    * Add the `secret_name` field under `authentication`, and set it equal to the name of the authentication Secret that was created above. The spec should look similar to the following:\n\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: basic\n        ```\n\n3. To configure the costmanagement-metrics-operator to create a cost management source, edit the following values in the `source` field:\n    * Replace `INSERT-SOURCE-NAME` with the preferred name of the source to be created.\n    * Replace the `create_source` field value with `true`.\n\n    **Note:** if the source already exists, replace `INSERT-SOURCE-NAME` with the existing name, and leave `create_source` as false. This will allow the operator to confirm the source exists.\n4. If not specified, the operator will create a default PersistentVolumeClaim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n5. Select `Create`.\n\n# Restricted Network Usage (disconnected/air-gapped mode)\n## Installation\nTo install the `costmanagement-metrics-operator` in a restricted network, follow the [olm documentation](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html). The operator is found in the `community-operators` Catalog in the `registry.redhat.io/redhat/community-operator-index:latest` Index. If pruning the index before pushing to the mirrored registry, keep the `costmanagement-metrics-operator` package.\n\nWithin a restricted network, the operator queries prometheus to gather the necessary usage metrics, writes the query results to CSV files, and packages the reports for storage in the PVC. These reports then need to be manually downloaded from the cluster and uploaded to [console.redhat.com](https://console.redhat.com).\n\n## Configure the costmanagement-metrics-operator for a restricted network\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. Specify the desired storage. If not specified, the operator will create a default Persistent Volume Claim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            storageClassName: <insert-class-name>\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n3. (Optional) Specify the desired report retention. The operator will retain 30 reports by default. This corresponds to approximately one week's worth of data if using the default packaging cycle. To modify the number of retained reports:\n    * Change the `packaging` spec field `max_reports_to_store` to the desired number of reports to retain. Once this max number is reached, the operator will start removing the oldest packages remaining on the PVC:\n\n      ```\n        packaging:\n          max_size_MB: 100\n          max_reports_to_store: 30\n      ```\n\n    **Note:** The number of retained reports directly affects the frequency that reports must be manually downloaded from the PVC. Take caution in setting this to a higher number of reports, as the operator cannot write data to the PVC if the storage is full.\n4. To configure the operator to perform in a restricted network, set the `upload_toggle` to `false`:\n\n  ```\n    upload:\n      upload_cycle: 360\n      upload_toggle: false\n  ```\n\n5. Select `Create`.\n\n## Download reports from the Operator & clean up the PVC\nIf the `costmanagement-metrics-operator` is configured to run in a restricted network, the metric reports will not automatically upload to cost managment. Instead, they need to be manually copied from the PVC for upload to [console.redhat.com](https://console.redhat.com). The default configuration saves one week of reports which means the process of downloading and uploading reports should be repeated weekly to prevent loss of metrics data. To download the reports, complete the following steps:\n1. Create the following Pod, ensuring the `claimName` matches the PVC containing the report data:\n\n  ```\n    kind: Pod\n    apiVersion: v1\n    metadata:\n      name: volume-shell\n      namespace: costmanagement-metrics-operator\n      labels:\n        app: costmanagement-metrics-operator\n    spec:\n      volumes:\n      - name: costmanagement-metrics-operator-reports\n        persistentVolumeClaim:\n          claimName: costmanagement-metrics-operator-data\n      containers:\n      - name: volume-shell\n        image: busybox\n        command: ['sleep', 'infinity']\n        volumeMounts:\n        - name: costmanagement-metrics-operator-reports\n          mountPath: /tmp/costmanagement-metrics-operator-reports\n  ```\n\n2. Use rsync to copy all of the files ready for upload from the PVC to a local folder:\n\n  ```\n  $ oc rsync volume-shell:/tmp/costmanagement-metrics-operator-reports/upload local/path/to/save/folder\n  ```\n\n3. Once confirming that the files have been successfully copied, use rsh to connect to the pod and delete the contents of the upload folder so that they are no longer in storage:\n\n  ```\n  $ oc rsh volume-shell\n  $ rm /tmp/costmanagement-metrics-operator-reports/upload/*\n  ```\n\n4. (Optional) Delete the pod that was used to connect to the PVC:\n\n  ```\n  $ oc delete -f volume-shell.yaml\n  ```\n\n## Create a source\nIn a restricted network, the `costmanagement-metrics-operator` cannot automatically create a source. This process must be done manually. In the console.redhat.com platform, open the [Sources menu](https://console.redhat.com/settings/sources/) to begin adding an OpenShift source to cost management:\n\nPrerequisites:\n* The cluster identifier which can be found in the CostManagementMetricsConfig CR, the cluster Overview page, or the cluster Help > About.\n\nCreate source:\n1. Navigate to the Sources menu\n2. Select the `Red Hat sources` tab\n3. Create a new `Red Hat Openshift Container Platform` source:\n    * give the source a unique name\n    * add the Cost Management application\n    * add the cluster identifier\n4. In the Sources wizard, review the details and click `Finish` to create the Source.\n\n## Upload the reports to cost managment\nUploading reports to cost managment is done through curl:\n\n    $ curl -vvvv -F \"file=@FILE_NAME.tar.gz;type=application/vnd.redhat.hccm.tar+tgz\"  https://console.redhat.com/api/ingress/v1/upload -u USERNAME:PASS\n\nwhere `USERNAME` and `PASS` correspond to the user credentials for [console.redhat.com](https://console.redhat.com), and `FILE_NAME` is the name of the report to upload.",
        "displayName": "Cost Management Metrics Operator",
        "installModes": [
          {
            "type": "OwnNamespace",
            "supported": true
          },
          {
            "type": "SingleNamespace",
            "supported": true
          },
          {
            "type": "MultiNamespace",
            "supported": false
          },
          {
            "type": "AllNamespaces",
            "supported": false
          }
        ],
        "keywords": [
          "cost",
          "management",
          "usage",
          "monitor"
        ],
        "maintainers": [
          {
            "name": "costmanagement",
            "email": "costmanagement@redhat.com"
          }
        ],
        "maturity": "alpha",
        "provider": {
          "name": "Red Hat"
        }
      }
    }
  ],
  "relatedImages": [
    {
      "name": "",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:12338c0a58b7a2e8f1f201512a43675e1df1f3eae0feec0ffd8df4295b499a92"
    },
    {
      "name": "costmanagement-metrics-rhel8-operator-6f320a64ab1212509647b8b259445349b31935f3968748ba53886076fc4c8606-annotation",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:6f320a64ab1212509647b8b259445349b31935f3968748ba53886076fc4c8606"
    },
    {
      "name": "manager",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:6f320a64ab1212509647b8b259445349b31935f3968748ba53886076fc4c8606"
    }
  ]
}
{
  "schema": "olm.bundle",
  "name": "costmanagement-metrics-operator.3.0.0",
  "package": "costmanagement-metrics-operator",
  "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:e43e49bc3c6b361f8ece42f438748dbe1e8af0c32c1ec4786fccc0e9ff1b63f1",
  "properties": [
    {
      "type": "olm.gvk",
      "value": {
        "group": "costmanagement-metrics-cfg.openshift.io",
        "kind": "CostManagementMetricsConfig",
        "version": "v1beta1"
      }
    },
    {
      "type": "olm.package",
      "value": {
        "packageName": "costmanagement-metrics-operator",
        "version": "3.0.0"
      }
    },
    {
      "type": "olm.csv.metadata",
      "value": {
        "annotations": {
          "alm-examples": "[\n  {\n    \"apiVersion\": \"costmanagement-metrics-cfg.openshift.io/v1beta1\",\n    \"kind\": \"CostManagementMetricsConfig\",\n    \"metadata\": {\n      \"name\": \"costmanagementmetricscfg-sample-v1beta1\"\n    },\n    \"spec\": {\n      \"authentication\": {\n        \"type\": \"token\"\n      },\n      \"packaging\": {\n        \"max_reports_to_store\": 30,\n        \"max_size_MB\": 100\n      },\n      \"prometheus_config\": {\n        \"collect_previous_data\": true,\n        \"context_timeout\": 120,\n        \"disable_metrics_collection_cost_management\": false,\n        \"disable_metrics_collection_resource_optimization\": false\n      },\n      \"source\": {\n        \"check_cycle\": 1440,\n        \"create_source\": false,\n        \"name\": \"\"\n      },\n      \"upload\": {\n        \"upload_cycle\": 360,\n        \"upload_toggle\": true\n      }\n    }\n  }\n]",
          "capabilities": "Seamless Upgrades",
          "categories": "Monitoring",
          "certified": "true",
          "containerImage": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:495c0fd649f1046eb3c3a91628b8a8df699288d6f004ddca41bb3a461dbd0d0b",
          "createdAt": "2023-10-02T16:10:01Z",
          "description": "A Golang-based OpenShift Operator that generates and uploads OpenShift usage metrics to cost management.",
          "operatorframework.io/suggested-namespace": "costmanagement-metrics-operator",
          "operators.openshift.io/infrastructure-features": "[\"Disconnected\"]",
          "operators.openshift.io/valid-subscription": "[\"OpenShift Kubernetes Engine\", \"OpenShift Container Platform\", \"OpenShift Platform Plus\"]",
          "operators.operatorframework.io/builder": "operator-sdk-v1.28.0",
          "operators.operatorframework.io/project_layout": "go.kubebuilder.io/v2",
          "repository": "https://github.com/project-koku/koku-metrics-operator",
          "support": "Red Hat"
        },
        "apiServiceDefinitions": {},
        "crdDescriptions": {
          "owned": [
            {
              "name": "costmanagementmetricsconfigs.costmanagement-metrics-cfg.openshift.io",
              "version": "v1beta1",
              "kind": "CostManagementMetricsConfig",
              "description": "CostManagementMetricsConfig is the Schema for the costmanagementmetricsconfig API"
            }
          ]
        },
        "description": "# 3.0.0 Cost Management Metrics Operator\n## Introduction\nThe `costmanagement-metrics-operator` is a component of the [cost managment](https://access.redhat.com/documentation/en-us/cost_management_service) service for Openshift. The operator runs on the latest supported versions of Openshift. This operator obtains OpenShift usage data by querying Prometheus every hour to create metric reports that it uploads to Cost Management at [console.redhat.com](https://console.redhat.com) to be processed. For more information, reach out to <costmanagement@redhat.com>.\n\nThis operator is capable of functioning within a disconnected/restricted network (aka air-gapped mode). In this mode, the operator will store the packaged reports for manual retrieval instead of being uploaded to Cost Management. Documentation for installing an operator within a restricted network can be found [here](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html).\n\n## Features and Capabilities\n#### Metrics collection:\nThe CostManagement Metrics Operator (`costmanagement-metrics-operator`) collects the metrics required for Cost Management by:\n* Querying Prometheus to gather the necessary metrics for Cost Management.\n* Writing the results of Prometheus queries to CSV report files.\n* Packaging the CSV report files into tarballs.\n\n#### Additional Capabilities:\n* Resource Optimization metrics collection.\n* The operator can be configured to gather all previous data within the configured retention period or a maximum of 90 days. The default data collection period is the 14 previous days. This setting is only applicable to newly created CostManagementMetricsConfigs.\n* The operator can be configured to automatically upload the packaged reports to Cost Management through Red Hat Insights Ingress service.\n* The operator can create a source in console.redhat.com. A source is required for Cost Management to process the uploaded packages.\n* PersistentVolumeClaim (PVC) configuration: The CostManagementMetricsConfig CR can accept a PVC definition and the operator will create and mount the PVC. If one is not provided, a default PVC will be created.\n* Restricted network installation: this operator can function on a restricted network. In this mode, the operator stores the packaged reports for manual retrieval.\n\n## New in v3.0.0:\n* Daily report generation: Operator versions prior to v3.0.0 generated sequential reports. Now, reports are generated starting at 0:00 UTC. Any payloads generated throughout a given day will contain all data starting from 0:00 UTC. Once the next day starts, the previous day's reports are packaged, and the new report again starts at 0:00 UTC for the current day.\n* Failed query retry: In an attempt to prevent missing data, the operator will retry queries from the last successful query time, up to 5 times.\n\n## New in v2.0.0:\n* Adds metrics and report generation for resource optimization. This feature will collect additional usage metrics and create a new report in the payload. These metrics are enabled by default, but can be disabled by setting `disable_metrics_collection_resource_optimization` to `true`.\n* Collect all available Prometheus data upon CR creation. This feature only applies to newly created CostManagementMetricsConfigs. The operator will check the monitoring stack configuration in the `openshift-monitoring` namespace. The operator will use the `retention` period set in the `cluster-monitoring-config` ConfigMap if defined, up to a maximum of 90 days. Otherwise it will fall back to collecting 14 days of data, if available. This data collection may be disabled by setting `collect_previous_data` to `false`. Turning this feature off results in the operator collecting metrics from the time the CostManagementMetricsConfig is created, forward.\n\n## Limitations and Pre-Requisites\n#### Limitations (Potential for metrics data loss)\n* A source **must** exist in console.redhat.com for an uploaded payload to be processed by Cost Management. The operator sends the payload to the Red Hat Insights Ingress service which usually returns successfully, but the operator does not currently confirm with Cost Management that the payload was processed. After Ingress accepts the uploaded payload, it is deleted from the operator. If the data within the payload is not processed, a gap will be introduced in the usage metrics. Data may be recollected by deleting the `CostManagementMetricsConfig`, creating a new `CostManagementMetricsConfig`, and setting `collect_previous_data: true`. This re-collection of data will gather all data stored in Prometheus, up to 90 days.\n\n**Note** The following limitations are specific to operators configured to run in a restricted network:\n* The `costmanagement-metrics-operator` will not be able to generate new reports if the PVC storage is full. If this occurs, the reports must be manually deleted from the PVC so that the operator can function as normal.\n* The default report retention is 30 reports (about one week's worth of data). The reports must be manually downloaded and uploaded to console.redhat.com every week, or they will be deleted and the data will be lost.\n\n#### Storage configuration prerequisite\nThe operator will attempt to create and use the following PVC when installed:\n\n      volume_claim_template:\n        apiVersion: v1\n        kind: PersistentVolumeClaim\n        metadata:\n          name: costmanagement-metrics-operator-data\n        spec:\n          accessModes:\n            - ReadWriteOnce\n          resources:\n            requests:\n              storage: 10Gi\n\nIf a different PVC should be utilized, a valid PVC should be specified in the CostManagementMetricsConfig CR as described in the appropriate section below. The PVC to be used may exist already, or the operator will attempt to create it.\n\nTo use the default specification, the follow assumptions must be met:\n1. A default StorageClass is defined.\n2. Dynamic provisioning for that default StorageClass is enabled.\n\nIf these assumptions are not met, the operator will not deploy correctly. In these cases, storage must be manually configured. After configuring storage, a valid PVC template should be supplied in the `volume_claim_template` spec of the CostManagementMetricsConfig CR.\n\n## Configurable parameters:\n  * `authentication`:\n    * `type: token` -> The authentication method for connecting to `console.redhat.com`. The default and preferred method is `token`. `basic` is used when the openshift-config pull-secret does not contain a token for `console.redhat.com`.\n    * `secret_name` -> The Secret used by the operator when the authentication type is `basic`. This parameter is required **only if** the authentication type is `basic`.\n  * `packaging`:\n    * `max_reports_to_store: 30` -> The number of reports to store when configured in air-gapped mode. The default is 30, with a minimum of 1 and no maximum. When the operator is not configured in air-gapped mode, this parameter has no effect. Reports are removed as soon as they are uploaded.\n    * `max_size: 100` -> The maximum size for packaged files in Megabytes prior to compression. The default is 100, with a minimum of 1 and maximum of 100.\n  * `prometheus_config`:\n    * `collect_previous_data: true` -> Toggle for collecting all available data in Prometheus **upon CostManagementMetricsConfig creation** (This parameter will start to appear in CostManagementMetricsConfigs that were created prior to v2.0.0 but will not have any effect unless the CostManagementMetricsConfig is deleted and recreated). The default is `true`. The operator will first look for a `retention` period in the `cluster-monitoring-config` ConfigMap in the `openshift-monitoring` namespace and gather data over this time period up to a maximum of 90 days. If this configuration is not set, the default is 14 days. (New in v2.0.0)\n    * `disable_metrics_collection_cost_management: false` -> Toggle for disabling the collection of metrics for Cost Management. The default is false. (New in v2.0.0)\n    * `disable_metrics_collection_resource_optimization: false` -> Toggle for disabling the collection of metrics for Resource Optimization. The default is false. (New in v2.0.0)\n    * `context_timeout: 120` -> The time in seconds before Prometheus queries timeout due to exceeding context timeout. The default is 120, with a minimum of 10 and maximum of 180.\n  * `source`:\n    * `name: ''` -> The name of the source the operator will create in `console.redhat.com`. If the name value is empty, the default intergration name is the **cluster id**.\n    * `create_source: false` -> Toggle for whether or not the operator will create the source in `console.redhat.com`. The default is False. This parameter should be switched to True when a source does not already exist in `console.redhat.com` for this cluster.\n    * `check_cycle: 1440` -> The time in minutes to wait between checking if a source exists for this cluster. The default is 1440 minutes (24 hrs).\n  * `upload`:\n    * `upload_cycle: 360` -> The time in minutes between payload uploads. The default is 360 (6 hours).\n    * `upload_toggle: true` -> Toggle to turn upload on or off -> true means upload, false means do not upload (false == air-gapped mode). The default is `true`.\n    * `upload_wait` -> The amount of time (in seconds) to pause before uploading a payload. The default is a random number between 0 and 35. This is used to decrease service load, but may be set to `0` if desired.\n  * `volume_claim_template` -> see the \"Storage configuration prerequisite\" section above.\n\n## Configure the costmanagement-metrics-operator\n**Note** There are separate instructions for configuring the `costmanagement-metrics-operator` to run in a restricted network.\n##### Configure authentication\nThe default authentication for the operator is `token`. No further steps are required to configure token authentication. If `basic` is the preferred authentication method, a Secret must be created which holds username and password credentials:\n1. On the left navigation pane, select `Workloads` -> `Secrets` -> select Project: `costmanagement-metrics-operator` -> `Create` -> `Key/Value Secret`\n2. Give the Secret a name and add 2 keys: `username` and `password` (all lowercase). The values for these keys correspond to console.redhat.com credentials.\n3. Select `Create`.\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. For `basic` authentication, edit the following values in the spec:\n    * Replace `authentication: type:` with `basic`.\n    * Add the `secret_name` field under `authentication`, and set it equal to the name of the authentication Secret that was created above. The spec should look similar to the following:\n\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: basic\n        ```\n\n3. To configure the costmanagement-metrics-operator to create a cost management source, edit the following values in the `source` field:\n    * Replace the `name` field value with the preferred name of the source to be created.\n    * Replace the `create_source` field value with `true`.\n\n    **Note:** if the source already exists, replace the empty string value of the `name` field with the existing name, and leave `create_source` as false. This will allow the operator to confirm that the source exists.\n\n4. If not specified, the operator will create a default PersistentVolumeClaim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n5. Select `Create`.\n\n# Restricted Network Usage (disconnected/air-gapped mode)\n## Installation\nTo install the `costmanagement-metrics-operator` in a restricted network, follow the [olm documentation](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html). The operator is found in the `community-operators` Catalog in the `registry.redhat.io/redhat/community-operator-index:latest` Index. If pruning the index before pushing to the mirrored registry, keep the `costmanagement-metrics-operator` package.\n\nWithin a restricted network, the operator queries prometheus to gather the necessary usage metrics, writes the query results to CSV files, and packages the reports for storage in the PVC. These reports then need to be manually downloaded from the cluster and uploaded to [console.redhat.com](https://console.redhat.com).\n\n## Configure the costmanagement-metrics-operator for a restricted network\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. Specify the desired storage. If not specified, the operator will create a default Persistent Volume Claim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec (below is only a template. Any _valid_ `PersistentVolumeClaim` may be defined here):\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            storageClassName: <insert-class-name>\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n3. (Optional) Specify the desired report retention. The operator will retain 30 reports by default. This corresponds to approximately one week's worth of data if using the default packaging cycle. To modify the number of retained reports:\n    * Change the `packaging` spec field `max_reports_to_store` to the desired number of reports to retain. Once this max number is reached, the operator will start removing the oldest packages remaining on the PVC:\n\n      ```\n        packaging:\n          max_size_MB: 100\n          max_reports_to_store: 30\n      ```\n\n    **Note:** The number of retained reports directly affects the frequency that reports must be manually downloaded from the PVC. Take caution in setting this to a higher number of reports, as the operator cannot write data to the PVC if the storage is full.\n4. To configure the operator to perform in a restricted network, set the `upload_toggle` to `false`:\n\n  ```\n    upload:\n      upload_cycle: 360\n      upload_toggle: false\n  ```\n\n5. Select `Create`.\n\n## Download reports from the Operator & clean up the PVC\nIf the `costmanagement-metrics-operator` is configured to run in a restricted network, the metric reports will not automatically upload to cost managment. Instead, they need to be manually copied from the PVC for upload to [console.redhat.com](https://console.redhat.com). The default configuration saves one week of reports which means the process of downloading and uploading reports should be repeated weekly to prevent loss of metrics data. To download the reports, complete the following steps:\n1. Create the following Pod, ensuring the `claimName` matches the PVC containing the report data:\n\n  ```\n    kind: Pod\n    apiVersion: v1\n    metadata:\n      name: volume-shell\n      namespace: costmanagement-metrics-operator\n      labels:\n        app: costmanagement-metrics-operator\n    spec:\n      volumes:\n      - name: costmanagement-metrics-operator-reports\n        persistentVolumeClaim:\n          claimName: costmanagement-metrics-operator-data\n      containers:\n      - name: volume-shell\n        image: busybox\n        command: ['sleep', 'infinity']\n        volumeMounts:\n        - name: costmanagement-metrics-operator-reports\n          mountPath: /tmp/costmanagement-metrics-operator-reports\n  ```\n\n2. Use rsync to copy all of the files ready for upload from the PVC to a local folder:\n\n  ```\n  $ oc rsync volume-shell:/tmp/costmanagement-metrics-operator-reports/upload local/path/to/save/folder\n  ```\n\n3. Once confirming that the files have been successfully copied, use rsh to connect to the pod and delete the contents of the upload folder so that they are no longer in storage:\n\n  ```\n  $ oc rsh volume-shell\n  $ rm /tmp/costmanagement-metrics-operator-reports/upload/*\n  ```\n\n4. (Optional) Delete the pod that was used to connect to the PVC:\n\n  ```\n  $ oc delete -f volume-shell.yaml\n  ```\n\n## Create a Source\nIn a restricted network, the `costmanagement-metrics-operator` cannot automatically create a source. This process must be done manually. In the console.redhat.com platform, open the [Sources menu](https://console.redhat.com/settings/sources/) to begin adding an OpenShift source to Cost Management:\n\nPrerequisites:\n* The cluster identifier which can be found in the CostManagementMetricsConfig CR, the cluster Overview page, or the cluster Help > About.\n\nCreating a source:\n1. Navigate to the Sources menu\n2. Select the `Red Hat` tab\n3. Create a new `Red Hat Openshift Container Platform` source:\n    * give the source a unique name\n    * add the Cost Management application\n    * add the cluster identifier\n4. In the Source wizard, review the details and click `Finish` to create the source.\n\n## Upload the reports to cost managment\nUploading reports to cost managment is done through curl:\n\n    $ curl -vvvv -F \"file=@FILE_NAME.tar.gz;type=application/vnd.redhat.hccm.tar+tgz\"  https://console.redhat.com/api/ingress/v1/upload -u USERNAME:PASS\n\nwhere `USERNAME` and `PASS` correspond to the user credentials for [console.redhat.com](https://console.redhat.com), and `FILE_NAME` is the name of the report to upload.",
        "displayName": "Cost Management Metrics Operator",
        "installModes": [
          {
            "type": "OwnNamespace",
            "supported": true
          },
          {
            "type": "SingleNamespace",
            "supported": true
          },
          {
            "type": "MultiNamespace",
            "supported": false
          },
          {
            "type": "AllNamespaces",
            "supported": false
          }
        ],
        "keywords": [
          "cost",
          "management",
          "usage",
          "monitor"
        ],
        "maintainers": [
          {
            "name": "costmanagement",
            "email": "costmanagement@redhat.com"
          }
        ],
        "maturity": "alpha",
        "provider": {
          "name": "Red Hat"
        }
      }
    }
  ],
  "relatedImages": [
    {
      "name": "",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:e43e49bc3c6b361f8ece42f438748dbe1e8af0c32c1ec4786fccc0e9ff1b63f1"
    },
    {
      "name": "costmanagement-metrics-rhel8-operator-495c0fd649f1046eb3c3a91628b8a8df699288d6f004ddca41bb3a461dbd0d0b-annotation",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:495c0fd649f1046eb3c3a91628b8a8df699288d6f004ddca41bb3a461dbd0d0b"
    },
    {
      "name": "manager",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:495c0fd649f1046eb3c3a91628b8a8df699288d6f004ddca41bb3a461dbd0d0b"
    }
  ]
}
{
  "schema": "olm.bundle",
  "name": "costmanagement-metrics-operator.3.0.1",
  "package": "costmanagement-metrics-operator",
  "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:afcee273a058fa1ac7643271ee775bdc1ca5d765f0ea36af3b3a6633d9fcbd73",
  "properties": [
    {
      "type": "olm.gvk",
      "value": {
        "group": "costmanagement-metrics-cfg.openshift.io",
        "kind": "CostManagementMetricsConfig",
        "version": "v1beta1"
      }
    },
    {
      "type": "olm.package",
      "value": {
        "packageName": "costmanagement-metrics-operator",
        "version": "3.0.1"
      }
    },
    {
      "type": "olm.csv.metadata",
      "value": {
        "annotations": {
          "alm-examples": "[\n  {\n    \"apiVersion\": \"costmanagement-metrics-cfg.openshift.io/v1beta1\",\n    \"kind\": \"CostManagementMetricsConfig\",\n    \"metadata\": {\n      \"name\": \"costmanagementmetricscfg-sample-v1beta1\"\n    },\n    \"spec\": {\n      \"authentication\": {\n        \"type\": \"token\"\n      },\n      \"packaging\": {\n        \"max_reports_to_store\": 30,\n        \"max_size_MB\": 100\n      },\n      \"prometheus_config\": {\n        \"collect_previous_data\": true,\n        \"context_timeout\": 120,\n        \"disable_metrics_collection_cost_management\": false,\n        \"disable_metrics_collection_resource_optimization\": false\n      },\n      \"source\": {\n        \"check_cycle\": 1440,\n        \"create_source\": false,\n        \"name\": \"\"\n      },\n      \"upload\": {\n        \"upload_cycle\": 360,\n        \"upload_toggle\": true\n      }\n    }\n  }\n]",
          "capabilities": "Seamless Upgrades",
          "categories": "Monitoring",
          "certified": "true",
          "containerImage": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:2975ad772fa79ada598ab5f054e2cbd821dcb734bd7b11d0cbc7b38d7b29be54",
          "createdAt": "2023-10-18T13:10:54Z",
          "description": "A Golang-based OpenShift Operator that generates and uploads OpenShift usage metrics to cost management.",
          "operatorframework.io/suggested-namespace": "costmanagement-metrics-operator",
          "operators.openshift.io/infrastructure-features": "[\"Disconnected\"]",
          "operators.openshift.io/valid-subscription": "[\"OpenShift Kubernetes Engine\", \"OpenShift Container Platform\", \"OpenShift Platform Plus\"]",
          "operators.operatorframework.io/builder": "operator-sdk-v1.32.0",
          "operators.operatorframework.io/project_layout": "go.kubebuilder.io/v2",
          "repository": "https://github.com/project-koku/koku-metrics-operator",
          "support": "Red Hat"
        },
        "apiServiceDefinitions": {},
        "crdDescriptions": {
          "owned": [
            {
              "name": "costmanagementmetricsconfigs.costmanagement-metrics-cfg.openshift.io",
              "version": "v1beta1",
              "kind": "CostManagementMetricsConfig",
              "description": "CostManagementMetricsConfig is the Schema for the costmanagementmetricsconfig API"
            }
          ]
        },
        "description": "# 3.0.1 Cost Management Metrics Operator\n## Introduction\nThe `costmanagement-metrics-operator` is a component of the [cost managment](https://access.redhat.com/documentation/en-us/cost_management_service) service for Openshift. The operator runs on the latest supported versions of Openshift. This operator obtains OpenShift usage data by querying Prometheus every hour to create metric reports that it uploads to Cost Management at [console.redhat.com](https://console.redhat.com) to be processed. For more information, reach out to <costmanagement@redhat.com>.\n\nThis operator is capable of functioning within a disconnected/restricted network (aka air-gapped mode). In this mode, the operator will store the packaged reports for manual retrieval instead of being uploaded to Cost Management. Documentation for installing an operator within a restricted network can be found [here](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html).\n\n## Features and Capabilities\n#### Metrics collection:\nThe CostManagement Metrics Operator (`costmanagement-metrics-operator`) collects the metrics required for Cost Management by:\n* Querying Prometheus to gather the necessary metrics for Cost Management.\n* Writing the results of Prometheus queries to CSV report files.\n* Packaging the CSV report files into tarballs.\n\n#### Additional Capabilities:\n* Resource Optimization metrics collection.\n* The operator can be configured to gather all previous data within the configured retention period or a maximum of 90 days. The default data collection period is the 14 previous days. This setting is only applicable to newly created CostManagementMetricsConfigs.\n* The operator can be configured to automatically upload the packaged reports to Cost Management through Red Hat Insights Ingress service.\n* The operator can create a source in console.redhat.com. A source is required for Cost Management to process the uploaded packages.\n* PersistentVolumeClaim (PVC) configuration: The CostManagementMetricsConfig CR can accept a PVC definition and the operator will create and mount the PVC. If one is not provided, a default PVC will be created.\n* Restricted network installation: this operator can function on a restricted network. In this mode, the operator stores the packaged reports for manual retrieval.\n\n## New in v3.0.0:\n* Daily report generation: Operator versions prior to v3.0.0 generated sequential reports. Now, reports are generated starting at 0:00 UTC. Any payloads generated throughout a given day will contain all data starting from 0:00 UTC. Once the next day starts, the previous day's reports are packaged, and the new report again starts at 0:00 UTC for the current day.\n* Failed query retry: In an attempt to prevent missing data, the operator will retry queries from the last successful query time, up to 5 times.\n\n## New in v2.0.0:\n* Adds metrics and report generation for resource optimization. This feature will collect additional usage metrics and create a new report in the payload. These metrics are enabled by default, but can be disabled by setting `disable_metrics_collection_resource_optimization` to `true`.\n* Collect all available Prometheus data upon CR creation. This feature only applies to newly created CostManagementMetricsConfigs. The operator will check the monitoring stack configuration in the `openshift-monitoring` namespace. The operator will use the `retention` period set in the `cluster-monitoring-config` ConfigMap if defined, up to a maximum of 90 days. Otherwise it will fall back to collecting 14 days of data, if available. This data collection may be disabled by setting `collect_previous_data` to `false`. Turning this feature off results in the operator collecting metrics from the time the CostManagementMetricsConfig is created, forward.\n\n## Limitations and Pre-Requisites\n#### Limitations (Potential for metrics data loss)\n* A source **must** exist in console.redhat.com for an uploaded payload to be processed by Cost Management. The operator sends the payload to the Red Hat Insights Ingress service which usually returns successfully, but the operator does not currently confirm with Cost Management that the payload was processed. After Ingress accepts the uploaded payload, it is deleted from the operator. If the data within the payload is not processed, a gap will be introduced in the usage metrics. Data may be recollected by deleting the `CostManagementMetricsConfig`, creating a new `CostManagementMetricsConfig`, and setting `collect_previous_data: true`. This re-collection of data will gather all data stored in Prometheus, up to 90 days.\n\n**Note** The following limitations are specific to operators configured to run in a restricted network:\n* The `costmanagement-metrics-operator` will not be able to generate new reports if the PVC storage is full. If this occurs, the reports must be manually deleted from the PVC so that the operator can function as normal.\n* The default report retention is 30 reports (about one week's worth of data). The reports must be manually downloaded and uploaded to console.redhat.com every week, or they will be deleted and the data will be lost.\n\n#### Storage configuration prerequisite\nThe operator will attempt to create and use the following PVC when installed:\n\n      volume_claim_template:\n        apiVersion: v1\n        kind: PersistentVolumeClaim\n        metadata:\n          name: costmanagement-metrics-operator-data\n        spec:\n          accessModes:\n            - ReadWriteOnce\n          resources:\n            requests:\n              storage: 10Gi\n\nIf a different PVC should be utilized, a valid PVC should be specified in the CostManagementMetricsConfig CR as described in the appropriate section below. The PVC to be used may exist already, or the operator will attempt to create it.\n\nTo use the default specification, the follow assumptions must be met:\n1. A default StorageClass is defined.\n2. Dynamic provisioning for that default StorageClass is enabled.\n\nIf these assumptions are not met, the operator will not deploy correctly. In these cases, storage must be manually configured. After configuring storage, a valid PVC template should be supplied in the `volume_claim_template` spec of the CostManagementMetricsConfig CR.\n\n## Configurable parameters:\n  * `authentication`:\n    * `type: token` -> The authentication method for connecting to `console.redhat.com`. The default and preferred method is `token`. `basic` is used when the openshift-config pull-secret does not contain a token for `console.redhat.com`.\n    * `secret_name` -> The Secret used by the operator when the authentication type is `basic`. This parameter is required **only if** the authentication type is `basic`.\n  * `packaging`:\n    * `max_reports_to_store: 30` -> The number of reports to store when configured in air-gapped mode. The default is 30, with a minimum of 1 and no maximum. When the operator is not configured in air-gapped mode, this parameter has no effect. Reports are removed as soon as they are uploaded.\n    * `max_size: 100` -> The maximum size for packaged files in Megabytes prior to compression. The default is 100, with a minimum of 1 and maximum of 100.\n  * `prometheus_config`:\n    * `collect_previous_data: true` -> Toggle for collecting all available data in Prometheus **upon CostManagementMetricsConfig creation** (This parameter will start to appear in CostManagementMetricsConfigs that were created prior to v2.0.0 but will not have any effect unless the CostManagementMetricsConfig is deleted and recreated). The default is `true`. The operator will first look for a `retention` period in the `cluster-monitoring-config` ConfigMap in the `openshift-monitoring` namespace and gather data over this time period up to a maximum of 90 days. If this configuration is not set, the default is 14 days. (New in v2.0.0)\n    * `disable_metrics_collection_cost_management: false` -> Toggle for disabling the collection of metrics for Cost Management. The default is false. (New in v2.0.0)\n    * `disable_metrics_collection_resource_optimization: false` -> Toggle for disabling the collection of metrics for Resource Optimization. The default is false. (New in v2.0.0)\n    * `context_timeout: 120` -> The time in seconds before Prometheus queries timeout due to exceeding context timeout. The default is 120, with a minimum of 10 and maximum of 180.\n  * `source`:\n    * `name: ''` -> The name of the source the operator will create in `console.redhat.com`. If the name value is empty, the default intergration name is the **cluster id**.\n    * `create_source: false` -> Toggle for whether or not the operator will create the source in `console.redhat.com`. The default is False. This parameter should be switched to True when a source does not already exist in `console.redhat.com` for this cluster.\n    * `check_cycle: 1440` -> The time in minutes to wait between checking if a source exists for this cluster. The default is 1440 minutes (24 hrs).\n  * `upload`:\n    * `upload_cycle: 360` -> The time in minutes between payload uploads. The default is 360 (6 hours).\n    * `upload_toggle: true` -> Toggle to turn upload on or off -> true means upload, false means do not upload (false == air-gapped mode). The default is `true`.\n    * `upload_wait` -> The amount of time (in seconds) to pause before uploading a payload. The default is a random number between 0 and 35. This is used to decrease service load, but may be set to `0` if desired.\n  * `volume_claim_template` -> see the \"Storage configuration prerequisite\" section above.\n\n## Configure the costmanagement-metrics-operator\n**Note** There are separate instructions for configuring the `costmanagement-metrics-operator` to run in a restricted network.\n##### Configure authentication\nThe default authentication for the operator is `token`. No further steps are required to configure token authentication. If `basic` is the preferred authentication method, a Secret must be created which holds username and password credentials:\n1. On the left navigation pane, select `Workloads` -> `Secrets` -> select Project: `costmanagement-metrics-operator` -> `Create` -> `Key/Value Secret`\n2. Give the Secret a name and add 2 keys: `username` and `password` (all lowercase). The values for these keys correspond to console.redhat.com credentials.\n3. Select `Create`.\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. For `basic` authentication, edit the following values in the spec:\n    * Replace `authentication: type:` with `basic`.\n    * Add the `secret_name` field under `authentication`, and set it equal to the name of the authentication Secret that was created above. The spec should look similar to the following:\n\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: basic\n        ```\n\n3. To configure the costmanagement-metrics-operator to create a cost management source, edit the following values in the `source` field:\n    * Replace the `name` field value with the preferred name of the source to be created.\n    * Replace the `create_source` field value with `true`.\n\n    **Note:** if the source already exists, replace the empty string value of the `name` field with the existing name, and leave `create_source` as false. This will allow the operator to confirm that the source exists.\n\n4. If not specified, the operator will create a default PersistentVolumeClaim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n5. Select `Create`.\n\n# Restricted Network Usage (disconnected/air-gapped mode)\n## Installation\nTo install the `costmanagement-metrics-operator` in a restricted network, follow the [olm documentation](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html). The operator is found in the `community-operators` Catalog in the `registry.redhat.io/redhat/community-operator-index:latest` Index. If pruning the index before pushing to the mirrored registry, keep the `costmanagement-metrics-operator` package.\n\nWithin a restricted network, the operator queries prometheus to gather the necessary usage metrics, writes the query results to CSV files, and packages the reports for storage in the PVC. These reports then need to be manually downloaded from the cluster and uploaded to [console.redhat.com](https://console.redhat.com).\n\n## Configure the costmanagement-metrics-operator for a restricted network\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. Specify the desired storage. If not specified, the operator will create a default Persistent Volume Claim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec (below is only a template. Any _valid_ `PersistentVolumeClaim` may be defined here):\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            storageClassName: <insert-class-name>\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n3. (Optional) Specify the desired report retention. The operator will retain 30 reports by default. This corresponds to approximately one week's worth of data if using the default packaging cycle. To modify the number of retained reports:\n    * Change the `packaging` spec field `max_reports_to_store` to the desired number of reports to retain. Once this max number is reached, the operator will start removing the oldest packages remaining on the PVC:\n\n      ```\n        packaging:\n          max_size_MB: 100\n          max_reports_to_store: 30\n      ```\n\n    **Note:** The number of retained reports directly affects the frequency that reports must be manually downloaded from the PVC. Take caution in setting this to a higher number of reports, as the operator cannot write data to the PVC if the storage is full.\n4. To configure the operator to perform in a restricted network, set the `upload_toggle` to `false`:\n\n  ```\n    upload:\n      upload_cycle: 360\n      upload_toggle: false\n  ```\n\n5. Select `Create`.\n\n## Download reports from the Operator & clean up the PVC\nIf the `costmanagement-metrics-operator` is configured to run in a restricted network, the metric reports will not automatically upload to cost managment. Instead, they need to be manually copied from the PVC for upload to [console.redhat.com](https://console.redhat.com). The default configuration saves one week of reports which means the process of downloading and uploading reports should be repeated weekly to prevent loss of metrics data. To download the reports, complete the following steps:\n1. Create the following Pod, ensuring the `claimName` matches the PVC containing the report data:\n\n  ```\n    kind: Pod\n    apiVersion: v1\n    metadata:\n      name: volume-shell\n      namespace: costmanagement-metrics-operator\n      labels:\n        app: costmanagement-metrics-operator\n    spec:\n      volumes:\n      - name: costmanagement-metrics-operator-reports\n        persistentVolumeClaim:\n          claimName: costmanagement-metrics-operator-data\n      containers:\n      - name: volume-shell\n        image: busybox\n        command: ['sleep', 'infinity']\n        volumeMounts:\n        - name: costmanagement-metrics-operator-reports\n          mountPath: /tmp/costmanagement-metrics-operator-reports\n  ```\n\n2. Use rsync to copy all of the files ready for upload from the PVC to a local folder:\n\n  ```\n  $ oc rsync volume-shell:/tmp/costmanagement-metrics-operator-reports/upload local/path/to/save/folder\n  ```\n\n3. Once confirming that the files have been successfully copied, use rsh to connect to the pod and delete the contents of the upload folder so that they are no longer in storage:\n\n  ```\n  $ oc rsh volume-shell\n  $ rm /tmp/costmanagement-metrics-operator-reports/upload/*\n  ```\n\n4. (Optional) Delete the pod that was used to connect to the PVC:\n\n  ```\n  $ oc delete -f volume-shell.yaml\n  ```\n\n## Create a Source\nIn a restricted network, the `costmanagement-metrics-operator` cannot automatically create a source. This process must be done manually. In the console.redhat.com platform, open the [Sources menu](https://console.redhat.com/settings/sources/) to begin adding an OpenShift source to Cost Management:\n\nPrerequisites:\n* The cluster identifier which can be found in the CostManagementMetricsConfig CR, the cluster Overview page, or the cluster Help > About.\n\nCreating a source:\n1. Navigate to the Sources menu\n2. Select the `Red Hat` tab\n3. Create a new `Red Hat Openshift Container Platform` source:\n    * give the source a unique name\n    * add the Cost Management application\n    * add the cluster identifier\n4. In the Source wizard, review the details and click `Finish` to create the source.\n\n## Upload the reports to cost managment\nUploading reports to cost managment is done through curl:\n\n    $ curl -vvvv -F \"file=@FILE_NAME.tar.gz;type=application/vnd.redhat.hccm.tar+tgz\"  https://console.redhat.com/api/ingress/v1/upload -u USERNAME:PASS\n\nwhere `USERNAME` and `PASS` correspond to the user credentials for [console.redhat.com](https://console.redhat.com), and `FILE_NAME` is the name of the report to upload.",
        "displayName": "Cost Management Metrics Operator",
        "installModes": [
          {
            "type": "OwnNamespace",
            "supported": true
          },
          {
            "type": "SingleNamespace",
            "supported": true
          },
          {
            "type": "MultiNamespace",
            "supported": false
          },
          {
            "type": "AllNamespaces",
            "supported": false
          }
        ],
        "keywords": [
          "cost",
          "management",
          "usage",
          "monitor"
        ],
        "maintainers": [
          {
            "name": "costmanagement",
            "email": "costmanagement@redhat.com"
          }
        ],
        "maturity": "alpha",
        "provider": {
          "name": "Red Hat"
        }
      }
    }
  ],
  "relatedImages": [
    {
      "name": "",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:afcee273a058fa1ac7643271ee775bdc1ca5d765f0ea36af3b3a6633d9fcbd73"
    },
    {
      "name": "costmanagement-metrics-rhel8-operator-2975ad772fa79ada598ab5f054e2cbd821dcb734bd7b11d0cbc7b38d7b29be54-annotation",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:2975ad772fa79ada598ab5f054e2cbd821dcb734bd7b11d0cbc7b38d7b29be54"
    },
    {
      "name": "manager",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:2975ad772fa79ada598ab5f054e2cbd821dcb734bd7b11d0cbc7b38d7b29be54"
    }
  ]
}
{
  "schema": "olm.bundle",
  "name": "costmanagement-metrics-operator.3.1.0",
  "package": "costmanagement-metrics-operator",
  "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:d3962cd30fa64b2dee9aca114a2b91f14c01e490024e5cfaf40246f5e88072d1",
  "properties": [
    {
      "type": "olm.gvk",
      "value": {
        "group": "costmanagement-metrics-cfg.openshift.io",
        "kind": "CostManagementMetricsConfig",
        "version": "v1beta1"
      }
    },
    {
      "type": "olm.package",
      "value": {
        "packageName": "costmanagement-metrics-operator",
        "version": "3.1.0"
      }
    },
    {
      "type": "olm.csv.metadata",
      "value": {
        "annotations": {
          "alm-examples": "[\n  {\n    \"apiVersion\": \"costmanagement-metrics-cfg.openshift.io/v1beta1\",\n    \"kind\": \"CostManagementMetricsConfig\",\n    \"metadata\": {\n      \"name\": \"costmanagementmetricscfg-sample-v1beta1\"\n    },\n    \"spec\": {\n      \"authentication\": {\n        \"type\": \"token\"\n      },\n      \"packaging\": {\n        \"max_reports_to_store\": 30,\n        \"max_size_MB\": 100\n      },\n      \"prometheus_config\": {\n        \"collect_previous_data\": true,\n        \"context_timeout\": 120,\n        \"disable_metrics_collection_cost_management\": false,\n        \"disable_metrics_collection_resource_optimization\": false\n      },\n      \"source\": {\n        \"check_cycle\": 1440,\n        \"create_source\": false,\n        \"name\": \"\"\n      },\n      \"upload\": {\n        \"upload_cycle\": 360,\n        \"upload_toggle\": true\n      }\n    }\n  }\n]",
          "capabilities": "Seamless Upgrades",
          "categories": "Monitoring",
          "certified": "true",
          "containerImage": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:999eb8a0aef8333e985120eb5236f6e53f887ef90f028439bb63bb5205dd01bf",
          "createdAt": "2023-12-09T01:12:04Z",
          "description": "A Golang-based OpenShift Operator that generates and uploads OpenShift usage metrics to cost management.",
          "operatorframework.io/suggested-namespace": "costmanagement-metrics-operator",
          "operators.openshift.io/infrastructure-features": "[\"Disconnected\"]",
          "operators.openshift.io/valid-subscription": "[\"OpenShift Kubernetes Engine\", \"OpenShift Container Platform\", \"OpenShift Platform Plus\"]",
          "operators.operatorframework.io/builder": "operator-sdk-v1.32.0",
          "operators.operatorframework.io/project_layout": "go.kubebuilder.io/v2",
          "repository": "https://github.com/project-koku/koku-metrics-operator",
          "support": "Red Hat"
        },
        "apiServiceDefinitions": {},
        "crdDescriptions": {
          "owned": [
            {
              "name": "costmanagementmetricsconfigs.costmanagement-metrics-cfg.openshift.io",
              "version": "v1beta1",
              "kind": "CostManagementMetricsConfig",
              "description": "CostManagementMetricsConfig is the Schema for the costmanagementmetricsconfig API"
            }
          ]
        },
        "description": "# 3.1.0 Cost Management Metrics Operator\n## Introduction\nThe `costmanagement-metrics-operator` is a component of the [cost managment](https://access.redhat.com/documentation/en-us/cost_management_service) service for Openshift. The operator runs on the latest supported versions of Openshift. This operator obtains OpenShift usage data by querying Prometheus every hour to create metric reports that it uploads to Cost Management at [console.redhat.com](https://console.redhat.com) to be processed. For more information, reach out to <costmanagement@redhat.com>.\n\nThis operator is capable of functioning within a disconnected/restricted network (aka air-gapped mode). In this mode, the operator will store the packaged reports for manual retrieval instead of being uploaded to Cost Management. Documentation for installing an operator within a restricted network can be found [here](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html).\n\n## Features and Capabilities\n#### Metrics collection:\nThe CostManagement Metrics Operator (`costmanagement-metrics-operator`) collects the metrics required for Cost Management by:\n* Querying Prometheus to gather the necessary metrics for Cost Management.\n* Writing the results of Prometheus queries to CSV report files.\n* Packaging the CSV report files into tarballs.\n\n#### Additional Capabilities:\n* Resource Optimization metrics collection.\n* The operator can be configured to gather all previous data within the configured retention period or a maximum of 90 days. The default data collection period is the 14 previous days. This setting is only applicable to newly created CostManagementMetricsConfigs.\n* The operator can be configured to automatically upload the packaged reports to Cost Management through Red Hat Insights Ingress service.\n* The operator can create an integration in console.redhat.com. An integration is required for Cost Management to process the uploaded packages.\n* PersistentVolumeClaim (PVC) configuration: The CostManagementMetricsConfig CR can accept a PVC definition and the operator will create and mount the PVC. If one is not provided, a default PVC will be created.\n* Restricted network installation: this operator can function on a restricted network. In this mode, the operator stores the packaged reports for manual retrieval.\n\n## New in v3.1.0:\n* Add service-account authentication type.\n* __Deprecation Notice:__ Basic authentication is deprecated and will be removed in a future version of the operator.\n\n## New in v3.0.0:\n* Daily report generation: Operator versions prior to v3.0.0 generated sequential reports. Now, reports are generated starting at 0:00 UTC. Any payloads generated throughout a given day will contain all data starting from 0:00 UTC. Once the next day starts, the previous day's reports are packaged, and the new report again starts at 0:00 UTC for the current day.\n* Failed query retry: In an attempt to prevent missing data, the operator will retry queries from the last successful query time, up to 5 times.\n\n## New in v2.0.0:\n* Adds metrics and report generation for resource optimization. This feature will collect additional usage metrics and create a new report in the payload. These metrics are enabled by default, but can be disabled by setting `disable_metrics_collection_resource_optimization` to `true`.\n* Collect all available Prometheus data upon CR creation. This feature only applies to newly created CostManagementMetricsConfigs. The operator will check the monitoring stack configuration in the `openshift-monitoring` namespace. The operator will use the `retention` period set in the `cluster-monitoring-config` ConfigMap if defined, up to a maximum of 90 days. Otherwise it will fall back to collecting 14 days of data, if available. This data collection may be disabled by setting `collect_previous_data` to `false`. Turning this feature off results in the operator collecting metrics from the time the CostManagementMetricsConfig is created, forward.\n\n## Limitations and Pre-Requisites\n#### Limitations (Potential for metrics data loss)\n* An integration **must** exist in console.redhat.com for an uploaded payload to be processed by Cost Management. The operator sends the payload to the Red Hat Insights Ingress service which usually returns successfully, but the operator does not currently confirm with Cost Management that the payload was processed. After Ingress accepts the uploaded payload, it is deleted from the operator. If the data within the payload is not processed, a gap will be introduced in the usage metrics. Data may be recollected by deleting the `CostManagementMetricsConfig`, creating a new `CostManagementMetricsConfig`, and setting `collect_previous_data: true`. This re-collection of data will gather all data stored in Prometheus, up to 90 days.\n\n**Note** The following limitations are specific to operators configured to run in a restricted network:\n* The `costmanagement-metrics-operator` will not be able to generate new reports if the PVC storage is full. If this occurs, the reports must be manually deleted from the PVC so that the operator can function as normal.\n* The default report retention is 30 reports (about one week's worth of data). The reports must be manually downloaded and uploaded to console.redhat.com every week, or they will be deleted and the data will be lost.\n\n#### Storage configuration prerequisite\nThe operator will attempt to create and use the following PVC when installed:\n\n      volume_claim_template:\n        apiVersion: v1\n        kind: PersistentVolumeClaim\n        metadata:\n          name: costmanagement-metrics-operator-data\n        spec:\n          accessModes:\n            - ReadWriteOnce\n          resources:\n            requests:\n              storage: 10Gi\n\nIf a different PVC should be utilized, a valid PVC should be specified in the CostManagementMetricsConfig CR as described in the appropriate section below. The PVC to be used may exist already, or the operator will attempt to create it.\n\nTo use the default specification, the follow assumptions must be met:\n1. A default StorageClass is defined.\n2. Dynamic provisioning for that default StorageClass is enabled.\n\nIf these assumptions are not met, the operator will not deploy correctly. In these cases, storage must be manually configured. After configuring storage, a valid PVC template should be supplied in the `volume_claim_template` spec of the CostManagementMetricsConfig CR.\n\n## Configurable parameters:\n  * `authentication`:\n    * `type: token` -> The authentication method for connecting to `console.redhat.com`. The default and preferred method is `token`. `basic` (deprecated) and `service-account` authentication methods are used when the openshift-config pull-secret does not contain a token for `console.redhat.com`.\n    * `secret_name` -> The Secret used by the operator when the authentication type is `basic` (deprecated) or `service-account`. This parameter is required **only if** the authentication type is `basic` (deprecated) or `service-account`.\n  * `packaging`:\n    * `max_reports_to_store: 30` -> The number of reports to store when configured in air-gapped mode. The default is 30, with a minimum of 1 and no maximum. When the operator is not configured in air-gapped mode, this parameter has no effect. Reports are removed as soon as they are uploaded.\n    * `max_size: 100` -> The maximum size for packaged files in Megabytes prior to compression. The default is 100, with a minimum of 1 and maximum of 100.\n  * `prometheus_config`:\n    * `collect_previous_data: true` -> Toggle for collecting all available data in Prometheus **upon CostManagementMetricsConfig creation** (This parameter will start to appear in CostManagementMetricsConfigs that were created prior to v2.0.0 but will not have any effect unless the CostManagementMetricsConfig is deleted and recreated). The default is `true`. The operator will first look for a `retention` period in the `cluster-monitoring-config` ConfigMap in the `openshift-monitoring` namespace and gather data over this time period up to a maximum of 90 days. If this configuration is not set, the default is 14 days. (New in v2.0.0)\n    * `disable_metrics_collection_cost_management: false` -> Toggle for disabling the collection of metrics for Cost Management. The default is false. (New in v2.0.0)\n    * `disable_metrics_collection_resource_optimization: false` -> Toggle for disabling the collection of metrics for Resource Optimization. The default is false. (New in v2.0.0)\n    * `context_timeout: 120` -> The time in seconds before Prometheus queries timeout due to exceeding context timeout. The default is 120, with a minimum of 10 and maximum of 180.\n  * `source`:\n    * `name: ''` -> The name of the integration the operator will create in `console.redhat.com`. If the name value is empty, the default intergration name is the **cluster id**.\n    * `create_source: false` -> Toggle for whether or not the operator will create the integration in `console.redhat.com`. The default is False. This parameter should be switched to True when an integration does not already exist in `console.redhat.com` for this cluster.\n    * `check_cycle: 1440` -> The time in minutes to wait between checking if an integration exists for this cluster. The default is 1440 minutes (24 hrs).\n  * `upload`:\n    * `upload_cycle: 360` -> The time in minutes between payload uploads. The default is 360 (6 hours).\n    * `upload_toggle: true` -> Toggle to turn upload on or off -> true means upload, false means do not upload (false == air-gapped mode). The default is `true`.\n    * `upload_wait` -> The amount of time (in seconds) to pause before uploading a payload. The default is a random number between 0 and 35. This is used to decrease service load, but may be set to `0` if desired.\n  * `volume_claim_template` -> see the \"Storage configuration prerequisite\" section above.\n\n## Configure the costmanagement-metrics-operator\n**Note** There are separate instructions for configuring the `costmanagement-metrics-operator` to run in a restricted network.\n##### Configure authentication\nThe default authentication for the operator is `token`. No further steps are required to configure token authentication. If `basic` (deprecated) or `service-account` is the preferred authentication method, a Secret which holds the credentials must be created:\n1. On the left navigation pane, select `Workloads` -> `Secrets` -> select Project: `costmanagement-metrics-operator` -> `Create` -> `Key/Value Secret`\n2. Give the Secret a name and add 2 keys (all lowercase) for the respective authentication type. The values for these keys correspond to console.redhat.com credentials:\n    * basic auth (deprecated): `username` and `password`\n    * service-account auth: `client_id` and `client_secret` \n\n3. Select `Create`.\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. For `basic` (deprecated) or `service-account` authentication, edit the following values in the spec:\n    * Replace `authentication: type:` with `basic` or `service-account`.\n    * Add the `secret_name` field under `authentication`, and set it equal to the name of the authentication Secret that was created above. The spec should look similar to the following:\n\n        * for basic auth type (deprecated)\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: basic\n        ```\n          \n        * for service-account auth type\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: service-account\n        ```\n\n3. To configure the costmanagement-metrics-operator to create a cost management integration, edit the following values in the `source` field:\n    * Replace the `name` field value with the preferred name of the integration to be created.\n    * Replace the `create_source` field value with `true`.\n\n    **Note:** if the integration already exists, replace the empty string value of the `name` field with the existing name, and leave `create_source` as false. This will allow the operator to confirm that the integration exists.\n\n4. If not specified, the operator will create a default PersistentVolumeClaim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n5. Select `Create`.\n\n# Restricted Network Usage (disconnected/air-gapped mode)\n## Installation\nTo install the `costmanagement-metrics-operator` in a restricted network, follow the [olm documentation](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html). The operator is found in the `community-operators` Catalog in the `registry.redhat.io/redhat/community-operator-index:latest` Index. If pruning the index before pushing to the mirrored registry, keep the `costmanagement-metrics-operator` package.\n\nWithin a restricted network, the operator queries prometheus to gather the necessary usage metrics, writes the query results to CSV files, and packages the reports for storage in the PVC. These reports then need to be manually downloaded from the cluster and uploaded to [console.redhat.com](https://console.redhat.com).\n\n## Configure the costmanagement-metrics-operator for a restricted network\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. Specify the desired storage. If not specified, the operator will create a default Persistent Volume Claim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec (below is only a template. Any _valid_ `PersistentVolumeClaim` may be defined here):\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            storageClassName: <insert-class-name>\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n3. (Optional) Specify the desired report retention. The operator will retain 30 reports by default. This corresponds to approximately one week's worth of data if using the default packaging cycle. To modify the number of retained reports:\n    * Change the `packaging` spec field `max_reports_to_store` to the desired number of reports to retain. Once this max number is reached, the operator will start removing the oldest packages remaining on the PVC:\n\n      ```\n        packaging:\n          max_size_MB: 100\n          max_reports_to_store: 30\n      ```\n\n    **Note:** The number of retained reports directly affects the frequency that reports must be manually downloaded from the PVC. Take caution in setting this to a higher number of reports, as the operator cannot write data to the PVC if the storage is full.\n4. To configure the operator to perform in a restricted network, set the `upload_toggle` to `false`:\n\n  ```\n    upload:\n      upload_cycle: 360\n      upload_toggle: false\n  ```\n\n5. Select `Create`.\n\n## Download reports from the Operator & clean up the PVC\nIf the `costmanagement-metrics-operator` is configured to run in a restricted network, the metric reports will not automatically upload to cost managment. Instead, they need to be manually copied from the PVC for upload to [console.redhat.com](https://console.redhat.com). The default configuration saves one week of reports which means the process of downloading and uploading reports should be repeated weekly to prevent loss of metrics data. To download the reports, complete the following steps:\n1. Create the following Pod, ensuring the `claimName` matches the PVC containing the report data:\n\n  ```\n    kind: Pod\n    apiVersion: v1\n    metadata:\n      name: volume-shell\n      namespace: costmanagement-metrics-operator\n      labels:\n        app: costmanagement-metrics-operator\n    spec:\n      volumes:\n      - name: costmanagement-metrics-operator-reports\n        persistentVolumeClaim:\n          claimName: costmanagement-metrics-operator-data\n      containers:\n      - name: volume-shell\n        image: busybox\n        command: ['sleep', 'infinity']\n        volumeMounts:\n        - name: costmanagement-metrics-operator-reports\n          mountPath: /tmp/costmanagement-metrics-operator-reports\n  ```\n\n2. Use rsync to copy all of the files ready for upload from the PVC to a local folder:\n\n  ```\n  $ oc rsync volume-shell:/tmp/costmanagement-metrics-operator-reports/upload local/path/to/save/folder\n  ```\n\n3. Once confirming that the files have been successfully copied, use rsh to connect to the pod and delete the contents of the upload folder so that they are no longer in storage:\n\n  ```\n  $ oc rsh volume-shell\n  $ rm /tmp/costmanagement-metrics-operator-reports/upload/*\n  ```\n\n4. (Optional) Delete the pod that was used to connect to the PVC:\n\n  ```\n  $ oc delete -f volume-shell.yaml\n  ```\n\n## Create an Integration\nIn a restricted network, the `costmanagement-metrics-operator` cannot automatically create an integration. This process must be done manually. In the console.redhat.com platform, open the [Integrations menu](https://console.redhat.com/settings/integrations/) to begin adding an OpenShift integration to Cost Management:\n\nPrerequisites:\n* The cluster identifier which can be found in the CostManagementMetricsConfig CR, the cluster Overview page, or the cluster Help > About.\n\nCreating an integration:\n1. Navigate to the Integrations menu\n2. Select the `Red Hat` tab\n3. Create a new `Red Hat Openshift Container Platform` integration:\n    * give the integration a unique name\n    * add the Cost Management application\n    * add the cluster identifier\n4. In the Source wizard, review the details and click `Finish` to create the source.\n\n## Upload the reports to cost managment\nUploading reports to cost managment is done through curl:\n\n    $ curl -vvvv -F \"file=@FILE_NAME.tar.gz;type=application/vnd.redhat.hccm.tar+tgz\"  https://console.redhat.com/api/ingress/v1/upload -u USERNAME:PASS\n\nwhere `USERNAME` and `PASS` correspond to the user credentials for [console.redhat.com](https://console.redhat.com), and `FILE_NAME` is the name of the report to upload.",
        "displayName": "Cost Management Metrics Operator",
        "installModes": [
          {
            "type": "OwnNamespace",
            "supported": true
          },
          {
            "type": "SingleNamespace",
            "supported": true
          },
          {
            "type": "MultiNamespace",
            "supported": false
          },
          {
            "type": "AllNamespaces",
            "supported": false
          }
        ],
        "keywords": [
          "cost",
          "management",
          "usage",
          "monitor"
        ],
        "maintainers": [
          {
            "name": "costmanagement",
            "email": "costmanagement@redhat.com"
          }
        ],
        "maturity": "alpha",
        "provider": {
          "name": "Red Hat"
        }
      }
    }
  ],
  "relatedImages": [
    {
      "name": "",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:d3962cd30fa64b2dee9aca114a2b91f14c01e490024e5cfaf40246f5e88072d1"
    },
    {
      "name": "costmanagement-metrics-rhel8-operator-999eb8a0aef8333e985120eb5236f6e53f887ef90f028439bb63bb5205dd01bf-annotation",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:999eb8a0aef8333e985120eb5236f6e53f887ef90f028439bb63bb5205dd01bf"
    },
    {
      "name": "manager",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:999eb8a0aef8333e985120eb5236f6e53f887ef90f028439bb63bb5205dd01bf"
    }
  ]
}
{
  "schema": "olm.bundle",
  "name": "costmanagement-metrics-operator.3.1.1",
  "package": "costmanagement-metrics-operator",
  "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:0dba5aba9060c84b1e6d0f5c4322f39940ace6fc4b91891cfe3211df7f53895a",
  "properties": [
    {
      "type": "olm.gvk",
      "value": {
        "group": "costmanagement-metrics-cfg.openshift.io",
        "kind": "CostManagementMetricsConfig",
        "version": "v1beta1"
      }
    },
    {
      "type": "olm.package",
      "value": {
        "packageName": "costmanagement-metrics-operator",
        "version": "3.1.1"
      }
    },
    {
      "type": "olm.csv.metadata",
      "value": {
        "annotations": {
          "alm-examples": "[\n  {\n    \"apiVersion\": \"costmanagement-metrics-cfg.openshift.io/v1beta1\",\n    \"kind\": \"CostManagementMetricsConfig\",\n    \"metadata\": {\n      \"name\": \"costmanagementmetricscfg-sample-v1beta1\"\n    },\n    \"spec\": {\n      \"authentication\": {\n        \"type\": \"token\"\n      },\n      \"packaging\": {\n        \"max_reports_to_store\": 30,\n        \"max_size_MB\": 100\n      },\n      \"prometheus_config\": {\n        \"collect_previous_data\": true,\n        \"context_timeout\": 120,\n        \"disable_metrics_collection_cost_management\": false,\n        \"disable_metrics_collection_resource_optimization\": false\n      },\n      \"source\": {\n        \"check_cycle\": 1440,\n        \"create_source\": false,\n        \"name\": \"\"\n      },\n      \"upload\": {\n        \"upload_cycle\": 360,\n        \"upload_toggle\": true\n      }\n    }\n  }\n]",
          "capabilities": "Seamless Upgrades",
          "categories": "Monitoring",
          "certified": "true",
          "containerImage": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:999eb8a0aef8333e985120eb5236f6e53f887ef90f028439bb63bb5205dd01bf",
          "createdAt": "2024-01-17T15:01:53Z",
          "description": "A Golang-based OpenShift Operator that generates and uploads OpenShift usage metrics to cost management.",
          "operatorframework.io/suggested-namespace": "costmanagement-metrics-operator",
          "operators.openshift.io/infrastructure-features": "[\"Disconnected\"]",
          "operators.openshift.io/valid-subscription": "[\"OpenShift Kubernetes Engine\", \"OpenShift Container Platform\", \"OpenShift Platform Plus\"]",
          "operators.operatorframework.io/builder": "operator-sdk-v1.32.0",
          "operators.operatorframework.io/project_layout": "go.kubebuilder.io/v2",
          "repository": "https://github.com/project-koku/koku-metrics-operator",
          "support": "Red Hat"
        },
        "apiServiceDefinitions": {},
        "crdDescriptions": {
          "owned": [
            {
              "name": "costmanagementmetricsconfigs.costmanagement-metrics-cfg.openshift.io",
              "version": "v1beta1",
              "kind": "CostManagementMetricsConfig",
              "description": "CostManagementMetricsConfig is the Schema for the costmanagementmetricsconfig API"
            }
          ]
        },
        "description": "# 3.1.1 Cost Management Metrics Operator\n## Introduction\nThe `costmanagement-metrics-operator` is a component of the [cost managment](https://access.redhat.com/documentation/en-us/cost_management_service) service for Openshift. The operator runs on the latest supported versions of Openshift. This operator obtains OpenShift usage data by querying Prometheus every hour to create metric reports that it uploads to Cost Management at [console.redhat.com](https://console.redhat.com) to be processed. For more information, reach out to <costmanagement@redhat.com>.\n\nThis operator is capable of functioning within a disconnected/restricted network (aka air-gapped mode). In this mode, the operator will store the packaged reports for manual retrieval instead of being uploaded to Cost Management. Documentation for installing an operator within a restricted network can be found [here](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html).\n\n## Features and Capabilities\n#### Metrics collection:\nThe CostManagement Metrics Operator (`costmanagement-metrics-operator`) collects the metrics required for Cost Management by:\n* Querying Prometheus to gather the necessary metrics for Cost Management.\n* Writing the results of Prometheus queries to CSV report files.\n* Packaging the CSV report files into tarballs.\n\n#### Additional Capabilities:\n* Resource Optimization metrics collection.\n* The operator can be configured to gather all previous data within the configured retention period or a maximum of 90 days. The default data collection period is the 14 previous days. This setting is only applicable to newly created CostManagementMetricsConfigs.\n* The operator can be configured to automatically upload the packaged reports to Cost Management through Red Hat Insights Ingress service.\n* The operator can create an integration in console.redhat.com. An integration is required for Cost Management to process the uploaded packages.\n* PersistentVolumeClaim (PVC) configuration: The CostManagementMetricsConfig CR can accept a PVC definition and the operator will create and mount the PVC. If one is not provided, a default PVC will be created.\n* Restricted network installation: this operator can function on a restricted network. In this mode, the operator stores the packaged reports for manual retrieval.\n\n## New in v3.1.0:\n* Add service-account authentication type.\n* __Deprecation Notice:__ Basic authentication is deprecated and will be removed in a future version of the operator.\n\n## New in v3.0.0:\n* Daily report generation: Operator versions prior to v3.0.0 generated sequential reports. Now, reports are generated starting at 0:00 UTC. Any payloads generated throughout a given day will contain all data starting from 0:00 UTC. Once the next day starts, the previous day's reports are packaged, and the new report again starts at 0:00 UTC for the current day.\n* Failed query retry: In an attempt to prevent missing data, the operator will retry queries from the last successful query time, up to 5 times.\n\n## New in v2.0.0:\n* Adds metrics and report generation for resource optimization. This feature will collect additional usage metrics and create a new report in the payload. These metrics are enabled by default, but can be disabled by setting `disable_metrics_collection_resource_optimization` to `true`.\n* Collect all available Prometheus data upon CR creation. This feature only applies to newly created CostManagementMetricsConfigs. The operator will check the monitoring stack configuration in the `openshift-monitoring` namespace. The operator will use the `retention` period set in the `cluster-monitoring-config` ConfigMap if defined, up to a maximum of 90 days. Otherwise it will fall back to collecting 14 days of data, if available. This data collection may be disabled by setting `collect_previous_data` to `false`. Turning this feature off results in the operator collecting metrics from the time the CostManagementMetricsConfig is created, forward.\n\n## Limitations and Pre-Requisites\n#### Limitations (Potential for metrics data loss)\n* An integration **must** exist in console.redhat.com for an uploaded payload to be processed by Cost Management. The operator sends the payload to the Red Hat Insights Ingress service which usually returns successfully, but the operator does not currently confirm with Cost Management that the payload was processed. After Ingress accepts the uploaded payload, it is deleted from the operator. If the data within the payload is not processed, a gap will be introduced in the usage metrics. Data may be recollected by deleting the `CostManagementMetricsConfig`, creating a new `CostManagementMetricsConfig`, and setting `collect_previous_data: true`. This re-collection of data will gather all data stored in Prometheus, up to 90 days.\n\n**Note** The following limitations are specific to operators configured to run in a restricted network:\n* The `costmanagement-metrics-operator` will not be able to generate new reports if the PVC storage is full. If this occurs, the reports must be manually deleted from the PVC so that the operator can function as normal.\n* The default report retention is 30 reports (about one week's worth of data). The reports must be manually downloaded and uploaded to console.redhat.com every week, or they will be deleted and the data will be lost.\n\n#### Storage configuration prerequisite\nThe operator will attempt to create and use the following PVC when installed:\n\n      volume_claim_template:\n        apiVersion: v1\n        kind: PersistentVolumeClaim\n        metadata:\n          name: costmanagement-metrics-operator-data\n        spec:\n          accessModes:\n            - ReadWriteOnce\n          resources:\n            requests:\n              storage: 10Gi\n\nIf a different PVC should be utilized, a valid PVC should be specified in the CostManagementMetricsConfig CR as described in the appropriate section below. The PVC to be used may exist already, or the operator will attempt to create it.\n\nTo use the default specification, the follow assumptions must be met:\n1. A default StorageClass is defined.\n2. Dynamic provisioning for that default StorageClass is enabled.\n\nIf these assumptions are not met, the operator will not deploy correctly. In these cases, storage must be manually configured. After configuring storage, a valid PVC template should be supplied in the `volume_claim_template` spec of the CostManagementMetricsConfig CR.\n\n## Configurable parameters:\n  * `authentication`:\n    * `type: token` -> The authentication method for connecting to `console.redhat.com`. The default and preferred method is `token`. `basic` (deprecated) and `service-account` authentication methods are used when the openshift-config pull-secret does not contain a token for `console.redhat.com`.\n    * `secret_name` -> The Secret used by the operator when the authentication type is `basic` (deprecated) or `service-account`. This parameter is required **only if** the authentication type is `basic` (deprecated) or `service-account`.\n  * `packaging`:\n    * `max_reports_to_store: 30` -> The number of reports to store when configured in air-gapped mode. The default is 30, with a minimum of 1 and no maximum. When the operator is not configured in air-gapped mode, this parameter has no effect. Reports are removed as soon as they are uploaded.\n    * `max_size: 100` -> The maximum size for packaged files in Megabytes prior to compression. The default is 100, with a minimum of 1 and maximum of 100.\n  * `prometheus_config`:\n    * `collect_previous_data: true` -> Toggle for collecting all available data in Prometheus **upon CostManagementMetricsConfig creation** (This parameter will start to appear in CostManagementMetricsConfigs that were created prior to v2.0.0 but will not have any effect unless the CostManagementMetricsConfig is deleted and recreated). The default is `true`. The operator will first look for a `retention` period in the `cluster-monitoring-config` ConfigMap in the `openshift-monitoring` namespace and gather data over this time period up to a maximum of 90 days. If this configuration is not set, the default is 14 days. (New in v2.0.0)\n    * `disable_metrics_collection_cost_management: false` -> Toggle for disabling the collection of metrics for Cost Management. The default is false. (New in v2.0.0)\n    * `disable_metrics_collection_resource_optimization: false` -> Toggle for disabling the collection of metrics for Resource Optimization. The default is false. (New in v2.0.0)\n    * `context_timeout: 120` -> The time in seconds before Prometheus queries timeout due to exceeding context timeout. The default is 120, with a minimum of 10 and maximum of 180.\n  * `source`:\n    * `name: ''` -> The name of the integration the operator will create in `console.redhat.com`. If the name value is empty, the default intergration name is the **cluster id**.\n    * `create_source: false` -> Toggle for whether or not the operator will create the integration in `console.redhat.com`. The default is False. This parameter should be switched to True when an integration does not already exist in `console.redhat.com` for this cluster.\n    * `check_cycle: 1440` -> The time in minutes to wait between checking if an integration exists for this cluster. The default is 1440 minutes (24 hrs).\n  * `upload`:\n    * `upload_cycle: 360` -> The time in minutes between payload uploads. The default is 360 (6 hours).\n    * `upload_toggle: true` -> Toggle to turn upload on or off -> true means upload, false means do not upload (false == air-gapped mode). The default is `true`.\n    * `upload_wait` -> The amount of time (in seconds) to pause before uploading a payload. The default is a random number between 0 and 35. This is used to decrease service load, but may be set to `0` if desired.\n  * `volume_claim_template` -> see the \"Storage configuration prerequisite\" section above.\n\n## Configure the costmanagement-metrics-operator\n**Note** There are separate instructions for configuring the `costmanagement-metrics-operator` to run in a restricted network.\n##### Configure authentication\nThe default authentication for the operator is `token`. No further steps are required to configure token authentication. If `basic` (deprecated) or `service-account` is the preferred authentication method, a Secret which holds the credentials must be created:\n1. On the left navigation pane, select `Workloads` -> `Secrets` -> select Project: `costmanagement-metrics-operator` -> `Create` -> `Key/Value Secret`\n2. Give the Secret a name and add 2 keys (all lowercase) for the respective authentication type. The values for these keys correspond to console.redhat.com credentials:\n    * basic auth (deprecated): `username` and `password`\n    * service-account auth: `client_id` and `client_secret`\n\n3. Select `Create`.\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. For `basic` (deprecated) or `service-account` authentication, edit the following values in the spec:\n    * Replace `authentication: type:` with `basic` or `service-account`.\n    * Add the `secret_name` field under `authentication`, and set it equal to the name of the authentication Secret that was created above. The spec should look similar to the following:\n\n        * for basic auth type (deprecated)\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: basic\n        ```\n\n        * for service-account auth type\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: service-account\n        ```\n\n3. To configure the costmanagement-metrics-operator to create a cost management integration, edit the following values in the `source` field:\n    * Replace the `name` field value with the preferred name of the integration to be created.\n    * Replace the `create_source` field value with `true`.\n\n    **Note:** if the integration already exists, replace the empty string value of the `name` field with the existing name, and leave `create_source` as false. This will allow the operator to confirm that the integration exists.\n\n4. If not specified, the operator will create a default PersistentVolumeClaim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n5. Select `Create`.\n\n# Restricted Network Usage (disconnected/air-gapped mode)\n## Installation\nTo install the `costmanagement-metrics-operator` in a restricted network, follow the [olm documentation](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html). The operator is found in the `community-operators` Catalog in the `registry.redhat.io/redhat/community-operator-index:latest` Index. If pruning the index before pushing to the mirrored registry, keep the `costmanagement-metrics-operator` package.\n\nWithin a restricted network, the operator queries prometheus to gather the necessary usage metrics, writes the query results to CSV files, and packages the reports for storage in the PVC. These reports then need to be manually downloaded from the cluster and uploaded to [console.redhat.com](https://console.redhat.com).\n\n## Configure the costmanagement-metrics-operator for a restricted network\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. Specify the desired storage. If not specified, the operator will create a default Persistent Volume Claim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec (below is only a template. Any _valid_ `PersistentVolumeClaim` may be defined here):\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            storageClassName: <insert-class-name>\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n3. (Optional) Specify the desired report retention. The operator will retain 30 reports by default. This corresponds to approximately one week's worth of data if using the default packaging cycle. To modify the number of retained reports:\n    * Change the `packaging` spec field `max_reports_to_store` to the desired number of reports to retain. Once this max number is reached, the operator will start removing the oldest packages remaining on the PVC:\n\n      ```\n        packaging:\n          max_size_MB: 100\n          max_reports_to_store: 30\n      ```\n\n    **Note:** The number of retained reports directly affects the frequency that reports must be manually downloaded from the PVC. Take caution in setting this to a higher number of reports, as the operator cannot write data to the PVC if the storage is full.\n4. To configure the operator to perform in a restricted network, set the `upload_toggle` to `false`:\n\n  ```\n    upload:\n      upload_cycle: 360\n      upload_toggle: false\n  ```\n\n5. Select `Create`.\n\n## Download reports from the Operator & clean up the PVC\nIf the `costmanagement-metrics-operator` is configured to run in a restricted network, the metric reports will not automatically upload to cost managment. Instead, they need to be manually copied from the PVC for upload to [console.redhat.com](https://console.redhat.com). The default configuration saves one week of reports which means the process of downloading and uploading reports should be repeated weekly to prevent loss of metrics data. To download the reports, complete the following steps:\n1. Create the following Pod, ensuring the `claimName` matches the PVC containing the report data:\n\n  ```\n    kind: Pod\n    apiVersion: v1\n    metadata:\n      name: volume-shell\n      namespace: costmanagement-metrics-operator\n      labels:\n        app: costmanagement-metrics-operator\n    spec:\n      volumes:\n      - name: costmanagement-metrics-operator-reports\n        persistentVolumeClaim:\n          claimName: costmanagement-metrics-operator-data\n      containers:\n      - name: volume-shell\n        image: busybox\n        command: ['sleep', 'infinity']\n        volumeMounts:\n        - name: costmanagement-metrics-operator-reports\n          mountPath: /tmp/costmanagement-metrics-operator-reports\n  ```\n\n2. Use rsync to copy all of the files ready for upload from the PVC to a local folder:\n\n  ```\n  $ oc rsync volume-shell:/tmp/costmanagement-metrics-operator-reports/upload local/path/to/save/folder\n  ```\n\n3. Once confirming that the files have been successfully copied, use rsh to connect to the pod and delete the contents of the upload folder so that they are no longer in storage:\n\n  ```\n  $ oc rsh volume-shell\n  $ rm /tmp/costmanagement-metrics-operator-reports/upload/*\n  ```\n\n4. (Optional) Delete the pod that was used to connect to the PVC:\n\n  ```\n  $ oc delete -f volume-shell.yaml\n  ```\n\n## Create an Integration\nIn a restricted network, the `costmanagement-metrics-operator` cannot automatically create an integration. This process must be done manually. In the console.redhat.com platform, open the [Integrations menu](https://console.redhat.com/settings/integrations/) to begin adding an OpenShift integration to Cost Management:\n\nPrerequisites:\n* The cluster identifier which can be found in the CostManagementMetricsConfig CR, the cluster Overview page, or the cluster Help > About.\n\nCreating an integration:\n1. Navigate to the Integrations menu\n2. Select the `Red Hat` tab\n3. Create a new `Red Hat Openshift Container Platform` integration:\n    * give the integration a unique name\n    * add the Cost Management application\n    * add the cluster identifier\n4. In the Source wizard, review the details and click `Finish` to create the source.\n\n## Upload the reports to cost managment\nUploading reports to cost managment is done through curl:\n\n    $ curl -vvvv -F \"file=@FILE_NAME.tar.gz;type=application/vnd.redhat.hccm.tar+tgz\"  https://console.redhat.com/api/ingress/v1/upload -u USERNAME:PASS\n\nwhere `USERNAME` and `PASS` correspond to the user credentials for [console.redhat.com](https://console.redhat.com), and `FILE_NAME` is the name of the report to upload.",
        "displayName": "Cost Management Metrics Operator",
        "installModes": [
          {
            "type": "OwnNamespace",
            "supported": true
          },
          {
            "type": "SingleNamespace",
            "supported": true
          },
          {
            "type": "MultiNamespace",
            "supported": false
          },
          {
            "type": "AllNamespaces",
            "supported": false
          }
        ],
        "keywords": [
          "cost",
          "management",
          "usage",
          "monitor"
        ],
        "maintainers": [
          {
            "name": "costmanagement",
            "email": "costmanagement@redhat.com"
          }
        ],
        "maturity": "alpha",
        "provider": {
          "name": "Red Hat"
        }
      }
    }
  ],
  "relatedImages": [
    {
      "name": "",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:0dba5aba9060c84b1e6d0f5c4322f39940ace6fc4b91891cfe3211df7f53895a"
    },
    {
      "name": "costmanagement-metrics-rhel8-operator-999eb8a0aef8333e985120eb5236f6e53f887ef90f028439bb63bb5205dd01bf-annotation",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:999eb8a0aef8333e985120eb5236f6e53f887ef90f028439bb63bb5205dd01bf"
    },
    {
      "name": "manager",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:999eb8a0aef8333e985120eb5236f6e53f887ef90f028439bb63bb5205dd01bf"
    }
  ]
}
{
  "schema": "olm.bundle",
  "name": "costmanagement-metrics-operator.3.2.0",
  "package": "costmanagement-metrics-operator",
  "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:3995f83eb27886d4b35c7051728cb57721ee0ba7ccfc0727592d368400a63fc8",
  "properties": [
    {
      "type": "olm.gvk",
      "value": {
        "group": "costmanagement-metrics-cfg.openshift.io",
        "kind": "CostManagementMetricsConfig",
        "version": "v1beta1"
      }
    },
    {
      "type": "olm.package",
      "value": {
        "packageName": "costmanagement-metrics-operator",
        "version": "3.2.0"
      }
    },
    {
      "type": "olm.csv.metadata",
      "value": {
        "annotations": {
          "alm-examples": "[\n  {\n    \"apiVersion\": \"costmanagement-metrics-cfg.openshift.io/v1beta1\",\n    \"kind\": \"CostManagementMetricsConfig\",\n    \"metadata\": {\n      \"name\": \"costmanagementmetricscfg-sample-v1beta1\"\n    },\n    \"spec\": {\n      \"authentication\": {\n        \"type\": \"token\"\n      },\n      \"packaging\": {\n        \"max_reports_to_store\": 30,\n        \"max_size_MB\": 100\n      },\n      \"prometheus_config\": {\n        \"collect_previous_data\": true,\n        \"context_timeout\": 120,\n        \"disable_metrics_collection_cost_management\": false,\n        \"disable_metrics_collection_resource_optimization\": false\n      },\n      \"source\": {\n        \"check_cycle\": 1440,\n        \"create_source\": false,\n        \"name\": \"\"\n      },\n      \"upload\": {\n        \"upload_cycle\": 360,\n        \"upload_toggle\": true\n      }\n    }\n  }\n]",
          "capabilities": "Seamless Upgrades",
          "categories": "Monitoring",
          "certified": "true",
          "containerImage": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:ce9d2f93f2c799a3a0b6aee3b09d8a94042dc221cb6105b7bd6bfeb2f1c4ebca",
          "createdAt": "2024-01-30T17:01:34Z",
          "description": "A Golang-based OpenShift Operator that generates and uploads OpenShift usage metrics to cost management.",
          "features.operators.openshift.io/disconnected": "true",
          "features.operators.openshift.io/fips-compliant": "false",
          "features.operators.openshift.io/proxy-aware": "true",
          "features.operators.openshift.io/tls-profiles": "false",
          "features.operators.openshift.io/token-auth-aws": "false",
          "features.operators.openshift.io/token-auth-azure": "false",
          "features.operators.openshift.io/token-auth-gcp": "false",
          "operatorframework.io/suggested-namespace": "costmanagement-metrics-operator",
          "operators.openshift.io/infrastructure-features": "[\"disconnected\", \"proxy-aware\"]",
          "operators.openshift.io/valid-subscription": "[\"OpenShift Kubernetes Engine\", \"OpenShift Container Platform\", \"OpenShift Platform Plus\"]",
          "operators.operatorframework.io/builder": "operator-sdk-v1.33.0",
          "operators.operatorframework.io/project_layout": "go.kubebuilder.io/v4",
          "repository": "https://github.com/project-koku/koku-metrics-operator",
          "support": "Red Hat"
        },
        "apiServiceDefinitions": {},
        "crdDescriptions": {
          "owned": [
            {
              "name": "costmanagementmetricsconfigs.costmanagement-metrics-cfg.openshift.io",
              "version": "v1beta1",
              "kind": "CostManagementMetricsConfig",
              "description": "CostManagementMetricsConfig is the Schema for the costmanagementmetricsconfig API"
            }
          ]
        },
        "description": "# 3.2.0 Cost Management Metrics Operator\n## Introduction\nThe `costmanagement-metrics-operator` is a component of the [cost managment](https://access.redhat.com/documentation/en-us/cost_management_service) service for Openshift. The operator runs on the latest supported versions of Openshift. This operator obtains OpenShift usage data by querying Prometheus every hour to create metric reports that it uploads to Cost Management at [console.redhat.com](https://console.redhat.com) to be processed. For more information, reach out to <costmanagement@redhat.com>.\n\nThis operator is capable of functioning within a disconnected/restricted network (aka air-gapped mode). In this mode, the operator will store the packaged reports for manual retrieval instead of being uploaded to Cost Management. Documentation for installing an operator within a restricted network can be found [here](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html).\n\n## Features and Capabilities\n#### Metrics collection:\nThe CostManagement Metrics Operator (`costmanagement-metrics-operator`) collects the metrics required for Cost Management by:\n* Querying Prometheus to gather the necessary metrics for Cost Management.\n* Writing the results of Prometheus queries to CSV report files.\n* Packaging the CSV report files into tarballs.\n\n#### Additional Capabilities:\n* Resource Optimization metrics collection.\n* The operator can be configured to gather all previous data within the configured retention period or a maximum of 90 days. The default data collection period is the 14 previous days. This setting is only applicable to newly created CostManagementMetricsConfigs.\n* The operator can be configured to automatically upload the packaged reports to Cost Management through Red Hat Insights Ingress service.\n* The operator can create an integration in console.redhat.com. An integration is required for Cost Management to process the uploaded packages.\n* PersistentVolumeClaim (PVC) configuration: The CostManagementMetricsConfig CR can accept a PVC definition and the operator will create and mount the PVC. If one is not provided, a default PVC will be created.\n* Restricted network installation: this operator can function on a restricted network. In this mode, the operator stores the packaged reports for manual retrieval.\n\n## New in v3.2.0:\n* Support for amd64, arm64, ppc64le, s390x architectures\n* add liveness and readiness probes to controller Pod\n* update pod security settings so that the controller Pod can run in Restricted mode [more info](https://sdk.operatorframework.io/docs/best-practices/pod-security-standards/)\n\n## New in v3.1.0:\n* Add service-account authentication type.\n* __Deprecation Notice:__ Basic authentication is deprecated and will be removed in a future version of the operator.\n\n## New in v3.0.0:\n* Daily report generation: Operator versions prior to v3.0.0 generated sequential reports. Now, reports are generated starting at 0:00 UTC. Any payloads generated throughout a given day will contain all data starting from 0:00 UTC. Once the next day starts, the previous day's reports are packaged, and the new report again starts at 0:00 UTC for the current day.\n* Failed query retry: In an attempt to prevent missing data, the operator will retry queries from the last successful query time, up to 5 times.\n\n## New in v2.0.0:\n* Adds metrics and report generation for resource optimization. This feature will collect additional usage metrics and create a new report in the payload. These metrics are enabled by default, but can be disabled by setting `disable_metrics_collection_resource_optimization` to `true`.\n* Collect all available Prometheus data upon CR creation. This feature only applies to newly created CostManagementMetricsConfigs. The operator will check the monitoring stack configuration in the `openshift-monitoring` namespace. The operator will use the `retention` period set in the `cluster-monitoring-config` ConfigMap if defined, up to a maximum of 90 days. Otherwise it will fall back to collecting 14 days of data, if available. This data collection may be disabled by setting `collect_previous_data` to `false`. Turning this feature off results in the operator collecting metrics from the time the CostManagementMetricsConfig is created, forward.\n\n## Limitations and Pre-Requisites\n#### Limitations (Potential for metrics data loss)\n* An integration **must** exist in console.redhat.com for an uploaded payload to be processed by Cost Management. The operator sends the payload to the Red Hat Insights Ingress service which usually returns successfully, but the operator does not currently confirm with Cost Management that the payload was processed. After Ingress accepts the uploaded payload, it is deleted from the operator. If the data within the payload is not processed, a gap will be introduced in the usage metrics. Data may be recollected by deleting the `CostManagementMetricsConfig`, creating a new `CostManagementMetricsConfig`, and setting `collect_previous_data: true`. This re-collection of data will gather all data stored in Prometheus, up to 90 days.\n\n**Note** The following limitations are specific to operators configured to run in a restricted network:\n* The `costmanagement-metrics-operator` will not be able to generate new reports if the PVC storage is full. If this occurs, the reports must be manually deleted from the PVC so that the operator can function as normal.\n* The default report retention is 30 reports (about one week's worth of data). The reports must be manually downloaded and uploaded to console.redhat.com every week, or they will be deleted and the data will be lost.\n\n#### Storage configuration prerequisite\nThe operator will attempt to create and use the following PVC when installed:\n\n      volume_claim_template:\n        apiVersion: v1\n        kind: PersistentVolumeClaim\n        metadata:\n          name: costmanagement-metrics-operator-data\n        spec:\n          accessModes:\n            - ReadWriteOnce\n          resources:\n            requests:\n              storage: 10Gi\n\nIf a different PVC should be utilized, a valid PVC should be specified in the CostManagementMetricsConfig CR as described in the appropriate section below. The PVC to be used may exist already, or the operator will attempt to create it.\n\nTo use the default specification, the follow assumptions must be met:\n1. A default StorageClass is defined.\n2. Dynamic provisioning for that default StorageClass is enabled.\n\nIf these assumptions are not met, the operator will not deploy correctly. In these cases, storage must be manually configured. After configuring storage, a valid PVC template should be supplied in the `volume_claim_template` spec of the CostManagementMetricsConfig CR.\n\n## Configurable parameters:\n  * `authentication`:\n    * `type: token` -> The authentication method for connecting to `console.redhat.com`. The default and preferred method is `token`. `basic` (deprecated) and `service-account` authentication methods are used when the openshift-config pull-secret does not contain a token for `console.redhat.com`.\n    * `secret_name` -> The Secret used by the operator when the authentication type is `basic` (deprecated) or `service-account`. This parameter is required **only if** the authentication type is `basic` (deprecated) or `service-account`.\n  * `packaging`:\n    * `max_reports_to_store: 30` -> The number of reports to store when configured in air-gapped mode. The default is 30, with a minimum of 1 and no maximum. When the operator is not configured in air-gapped mode, this parameter has no effect. Reports are removed as soon as they are uploaded.\n    * `max_size: 100` -> The maximum size for packaged files in Megabytes prior to compression. The default is 100, with a minimum of 1 and maximum of 100.\n  * `prometheus_config`:\n    * `collect_previous_data: true` -> Toggle for collecting all available data in Prometheus **upon CostManagementMetricsConfig creation** (This parameter will start to appear in CostManagementMetricsConfigs that were created prior to v2.0.0 but will not have any effect unless the CostManagementMetricsConfig is deleted and recreated). The default is `true`. The operator will first look for a `retention` period in the `cluster-monitoring-config` ConfigMap in the `openshift-monitoring` namespace and gather data over this time period up to a maximum of 90 days. If this configuration is not set, the default is 14 days. (New in v2.0.0)\n    * `disable_metrics_collection_cost_management: false` -> Toggle for disabling the collection of metrics for Cost Management. The default is false. (New in v2.0.0)\n    * `disable_metrics_collection_resource_optimization: false` -> Toggle for disabling the collection of metrics for Resource Optimization. The default is false. (New in v2.0.0)\n    * `context_timeout: 120` -> The time in seconds before Prometheus queries timeout due to exceeding context timeout. The default is 120, with a minimum of 10 and maximum of 180.\n  * `source`:\n    * `name: ''` -> The name of the integration the operator will create in `console.redhat.com`. If the name value is empty, the default intergration name is the **cluster id**.\n    * `create_source: false` -> Toggle for whether or not the operator will create the integration in `console.redhat.com`. The default is False. This parameter should be switched to True when an integration does not already exist in `console.redhat.com` for this cluster.\n    * `check_cycle: 1440` -> The time in minutes to wait between checking if an integration exists for this cluster. The default is 1440 minutes (24 hrs).\n  * `upload`:\n    * `upload_cycle: 360` -> The time in minutes between payload uploads. The default is 360 (6 hours).\n    * `upload_toggle: true` -> Toggle to turn upload on or off -> true means upload, false means do not upload (false == air-gapped mode). The default is `true`.\n    * `upload_wait` -> The amount of time (in seconds) to pause before uploading a payload. The default is a random number between 0 and 35. This is used to decrease service load, but may be set to `0` if desired.\n  * `volume_claim_template` -> see the \"Storage configuration prerequisite\" section above.\n\n## Configure the costmanagement-metrics-operator\n**Note** There are separate instructions for configuring the `costmanagement-metrics-operator` to run in a restricted network.\n##### Configure authentication\nThe default authentication for the operator is `token`. No further steps are required to configure token authentication. If `basic` (deprecated) or `service-account` is the preferred authentication method, a Secret which holds the credentials must be created:\n1. On the left navigation pane, select `Workloads` -> `Secrets` -> select Project: `costmanagement-metrics-operator` -> `Create` -> `Key/Value Secret`\n2. Give the Secret a name and add 2 keys (all lowercase) for the respective authentication type. The values for these keys correspond to console.redhat.com credentials:\n    * basic auth (deprecated): `username` and `password`\n    * service-account auth: `client_id` and `client_secret`\n\n3. Select `Create`.\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. For `basic` (deprecated) or `service-account` authentication, edit the following values in the spec:\n    * Replace `authentication: type:` with `basic` or `service-account`.\n    * Add the `secret_name` field under `authentication`, and set it equal to the name of the authentication Secret that was created above. The spec should look similar to the following:\n\n        * for basic auth type (deprecated)\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: basic\n        ```\n\n        * for service-account auth type\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: service-account\n        ```\n\n3. To configure the costmanagement-metrics-operator to create a cost management integration, edit the following values in the `source` field:\n    * Replace the `name` field value with the preferred name of the integration to be created.\n    * Replace the `create_source` field value with `true`.\n\n    **Note:** if the integration already exists, replace the empty string value of the `name` field with the existing name, and leave `create_source` as false. This will allow the operator to confirm that the integration exists.\n\n4. If not specified, the operator will create a default PersistentVolumeClaim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n5. Select `Create`.\n\n# Restricted Network Usage (disconnected/air-gapped mode)\n## Installation\nTo install the `costmanagement-metrics-operator` in a restricted network, follow the [olm documentation](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html). The operator is found in the `community-operators` Catalog in the `registry.redhat.io/redhat/community-operator-index:latest` Index. If pruning the index before pushing to the mirrored registry, keep the `costmanagement-metrics-operator` package.\n\nWithin a restricted network, the operator queries prometheus to gather the necessary usage metrics, writes the query results to CSV files, and packages the reports for storage in the PVC. These reports then need to be manually downloaded from the cluster and uploaded to [console.redhat.com](https://console.redhat.com).\n\n## Configure the costmanagement-metrics-operator for a restricted network\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. Specify the desired storage. If not specified, the operator will create a default Persistent Volume Claim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec (below is only a template. Any _valid_ `PersistentVolumeClaim` may be defined here):\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            storageClassName: <insert-class-name>\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n3. (Optional) Specify the desired report retention. The operator will retain 30 reports by default. This corresponds to approximately one week's worth of data if using the default packaging cycle. To modify the number of retained reports:\n    * Change the `packaging` spec field `max_reports_to_store` to the desired number of reports to retain. Once this max number is reached, the operator will start removing the oldest packages remaining on the PVC:\n\n      ```\n        packaging:\n          max_size_MB: 100\n          max_reports_to_store: 30\n      ```\n\n    **Note:** The number of retained reports directly affects the frequency that reports must be manually downloaded from the PVC. Take caution in setting this to a higher number of reports, as the operator cannot write data to the PVC if the storage is full.\n4. To configure the operator to perform in a restricted network, set the `upload_toggle` to `false`:\n\n  ```\n    upload:\n      upload_cycle: 360\n      upload_toggle: false\n  ```\n\n5. Select `Create`.\n\n## Download reports from the Operator & clean up the PVC\nIf the `costmanagement-metrics-operator` is configured to run in a restricted network, the metric reports will not automatically upload to cost managment. Instead, they need to be manually copied from the PVC for upload to [console.redhat.com](https://console.redhat.com). The default configuration saves one week of reports which means the process of downloading and uploading reports should be repeated weekly to prevent loss of metrics data. To download the reports, complete the following steps:\n1. Create the following Pod, ensuring the `claimName` matches the PVC containing the report data:\n\n  ```\n    kind: Pod\n    apiVersion: v1\n    metadata:\n      name: volume-shell\n      namespace: costmanagement-metrics-operator\n      labels:\n        app: costmanagement-metrics-operator\n    spec:\n      volumes:\n      - name: costmanagement-metrics-operator-reports\n        persistentVolumeClaim:\n          claimName: costmanagement-metrics-operator-data\n      containers:\n      - name: volume-shell\n        image: busybox\n        command: ['sleep', 'infinity']\n        volumeMounts:\n        - name: costmanagement-metrics-operator-reports\n          mountPath: /tmp/costmanagement-metrics-operator-reports\n  ```\n\n2. Use rsync to copy all of the files ready for upload from the PVC to a local folder:\n\n  ```\n  $ oc rsync volume-shell:/tmp/costmanagement-metrics-operator-reports/upload local/path/to/save/folder\n  ```\n\n3. Once confirming that the files have been successfully copied, use rsh to connect to the pod and delete the contents of the upload folder so that they are no longer in storage:\n\n  ```\n  $ oc rsh volume-shell\n  $ rm /tmp/costmanagement-metrics-operator-reports/upload/*\n  ```\n\n4. (Optional) Delete the pod that was used to connect to the PVC:\n\n  ```\n  $ oc delete -f volume-shell.yaml\n  ```\n\n## Create an Integration\nIn a restricted network, the `costmanagement-metrics-operator` cannot automatically create an integration. This process must be done manually. In the console.redhat.com platform, open the [Integrations menu](https://console.redhat.com/settings/integrations/) to begin adding an OpenShift integration to Cost Management:\n\nPrerequisites:\n* The cluster identifier which can be found in the CostManagementMetricsConfig CR, the cluster Overview page, or the cluster Help > About.\n\nCreating an integration:\n1. Navigate to the Integrations menu\n2. Select the `Red Hat` tab\n3. Create a new `Red Hat Openshift Container Platform` integration:\n    * give the integration a unique name\n    * add the Cost Management application\n    * add the cluster identifier\n4. In the Source wizard, review the details and click `Finish` to create the source.\n\n## Upload the reports to cost managment\nUploading reports to cost managment is done through curl:\n\n    $ curl -vvvv -F \"file=@FILE_NAME.tar.gz;type=application/vnd.redhat.hccm.tar+tgz\"  https://console.redhat.com/api/ingress/v1/upload -u USERNAME:PASS\n\nwhere `USERNAME` and `PASS` correspond to the user credentials for [console.redhat.com](https://console.redhat.com), and `FILE_NAME` is the name of the report to upload.",
        "displayName": "Cost Management Metrics Operator",
        "installModes": [
          {
            "type": "OwnNamespace",
            "supported": true
          },
          {
            "type": "SingleNamespace",
            "supported": true
          },
          {
            "type": "MultiNamespace",
            "supported": false
          },
          {
            "type": "AllNamespaces",
            "supported": false
          }
        ],
        "keywords": [
          "cost",
          "management",
          "usage",
          "monitor"
        ],
        "labels": {
          "operatorframework.io/arch.amd64": "supported",
          "operatorframework.io/arch.arm64": "supported",
          "operatorframework.io/arch.ppc64le": "supported",
          "operatorframework.io/arch.s390x": "supported",
          "operatorframework.io/os.linux": "supported"
        },
        "maintainers": [
          {
            "name": "costmanagement",
            "email": "costmanagement@redhat.com"
          }
        ],
        "maturity": "alpha",
        "minKubeVersion": "1.24.0",
        "provider": {
          "name": "Red Hat"
        }
      }
    }
  ],
  "relatedImages": [
    {
      "name": "",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:3995f83eb27886d4b35c7051728cb57721ee0ba7ccfc0727592d368400a63fc8"
    },
    {
      "name": "costmanagement-metrics-rhel8-operator-ce9d2f93f2c799a3a0b6aee3b09d8a94042dc221cb6105b7bd6bfeb2f1c4ebca-annotation",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:ce9d2f93f2c799a3a0b6aee3b09d8a94042dc221cb6105b7bd6bfeb2f1c4ebca"
    },
    {
      "name": "manager",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:ce9d2f93f2c799a3a0b6aee3b09d8a94042dc221cb6105b7bd6bfeb2f1c4ebca"
    }
  ]
}
{
  "schema": "olm.bundle",
  "name": "costmanagement-metrics-operator.3.2.1",
  "package": "costmanagement-metrics-operator",
  "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:a1dc9a219534acb572ea00c5749e5db7aa083682e2b381dd9faddbc907b4792b",
  "properties": [
    {
      "type": "olm.gvk",
      "value": {
        "group": "costmanagement-metrics-cfg.openshift.io",
        "kind": "CostManagementMetricsConfig",
        "version": "v1beta1"
      }
    },
    {
      "type": "olm.package",
      "value": {
        "packageName": "costmanagement-metrics-operator",
        "version": "3.2.1"
      }
    },
    {
      "type": "olm.csv.metadata",
      "value": {
        "annotations": {
          "alm-examples": "[\n  {\n    \"apiVersion\": \"costmanagement-metrics-cfg.openshift.io/v1beta1\",\n    \"kind\": \"CostManagementMetricsConfig\",\n    \"metadata\": {\n      \"name\": \"costmanagementmetricscfg-sample-v1beta1\"\n    },\n    \"spec\": {\n      \"authentication\": {\n        \"type\": \"token\"\n      },\n      \"packaging\": {\n        \"max_reports_to_store\": 30,\n        \"max_size_MB\": 100\n      },\n      \"prometheus_config\": {\n        \"collect_previous_data\": true,\n        \"context_timeout\": 120,\n        \"disable_metrics_collection_cost_management\": false,\n        \"disable_metrics_collection_resource_optimization\": false\n      },\n      \"source\": {\n        \"check_cycle\": 1440,\n        \"create_source\": false,\n        \"name\": \"\"\n      },\n      \"upload\": {\n        \"upload_cycle\": 360,\n        \"upload_toggle\": true\n      }\n    }\n  }\n]",
          "capabilities": "Seamless Upgrades",
          "categories": "Monitoring",
          "certified": "true",
          "containerImage": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:ee69d5cbf5909bdbffb85e2c55e8b830939ab1c9e6c3a679552bad8e0c90e657",
          "createdAt": "2024-03-19T13:51:37Z",
          "description": "A Golang-based OpenShift Operator that generates and uploads OpenShift usage metrics to cost management.",
          "features.operators.openshift.io/disconnected": "true",
          "features.operators.openshift.io/fips-compliant": "false",
          "features.operators.openshift.io/proxy-aware": "true",
          "features.operators.openshift.io/tls-profiles": "false",
          "features.operators.openshift.io/token-auth-aws": "false",
          "features.operators.openshift.io/token-auth-azure": "false",
          "features.operators.openshift.io/token-auth-gcp": "false",
          "operatorframework.io/suggested-namespace": "costmanagement-metrics-operator",
          "operators.openshift.io/infrastructure-features": "[\"disconnected\", \"proxy-aware\"]",
          "operators.openshift.io/valid-subscription": "[\"OpenShift Kubernetes Engine\", \"OpenShift Container Platform\", \"OpenShift Platform Plus\"]",
          "operators.operatorframework.io/builder": "operator-sdk-v1.33.0",
          "operators.operatorframework.io/project_layout": "go.kubebuilder.io/v4",
          "repository": "https://github.com/project-koku/koku-metrics-operator",
          "support": "Red Hat"
        },
        "apiServiceDefinitions": {},
        "crdDescriptions": {
          "owned": [
            {
              "name": "costmanagementmetricsconfigs.costmanagement-metrics-cfg.openshift.io",
              "version": "v1beta1",
              "kind": "CostManagementMetricsConfig",
              "displayName": "Cost Management Metrics Config",
              "description": "CostManagementMetricsConfig is the Schema for the costmanagementmetricsconfig API"
            }
          ]
        },
        "description": "# Cost Management Metrics Operator\n## Introduction\nThe `costmanagement-metrics-operator` is a component of the [cost managment](https://access.redhat.com/documentation/en-us/cost_management_service) service for Openshift. The operator runs on the latest supported versions of Openshift. This operator obtains OpenShift usage data by querying Prometheus every hour to create metric reports that it uploads to Cost Management at [console.redhat.com](https://console.redhat.com) to be processed. For more information, reach out to <costmanagement@redhat.com>.\n\nThis operator is capable of functioning within a disconnected/restricted network (aka air-gapped mode). In this mode, the operator will store the packaged reports for manual retrieval instead of being uploaded to Cost Management. Documentation for installing an operator within a restricted network can be found [here](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html).\n\n## Features and Capabilities\n#### Metrics collection:\nThe Cost Management Metrics Operator (`costmanagement-metrics-operator`) collects the metrics required for Cost Management by:\n* Querying Prometheus to gather the necessary metrics for Cost Management.\n* Writing the results of Prometheus queries to CSV report files.\n* Packaging the CSV report files into tarballs.\n\n#### Additional Capabilities:\n* Resource Optimization metrics collection.\n* The operator can be configured to gather all previous data within the configured retention period or a maximum of 90 days. The default data collection period is the 14 previous days. This setting is only applicable to newly created CostManagementMetricsConfigs.\n* The operator can be configured to automatically upload the packaged reports to Cost Management through Red Hat Insights Ingress service.\n* The operator can create an integration in console.redhat.com. An integration is required for Cost Management to process the uploaded packages.\n* PersistentVolumeClaim (PVC) configuration: The CostManagementMetricsConfig CR can accept a PVC definition and the operator will create and mount the PVC. If one is not provided, a default PVC will be created.\n* Restricted network installation: this operator can function on a restricted network. In this mode, the operator stores the packaged reports for manual retrieval.\n\n## New in v3.2.1:\n* The minimum supported configuration for `upload_cycle` is now 60 (minutes).\n* (Bugfix) many-to-many matching not allowed query fix.\n* (Bugfix) Sequentially collect data during initial install.\n\n## New in v3.2.0:\n* Support for amd64, arm64, ppc64le, s390x architectures.\n* add liveness and readiness probes to controller Pod.\n* update pod security settings so that the controller Pod can run in Restricted mode [more info](https://sdk.operatorframework.io/docs/best-practices/pod-security-standards/).\n\n## New in v3.1.0:\n* Add service-account authentication type.\n* __Deprecation Notice:__ Basic authentication is deprecated and will be removed in a future version of the operator.\n\n## New in v3.0.0:\n* Daily report generation: Operator versions prior to v3.0.0 generated sequential reports. Now, reports are generated starting at 0:00 UTC. Any payloads generated throughout a given day will contain all data starting from 0:00 UTC. Once the next day starts, the previous day's reports are packaged, and the new report again starts at 0:00 UTC for the current day.\n* Failed query retry: In an attempt to prevent missing data, the operator will retry queries from the last successful query time, up to 5 times.\n\n## New in v2.0.0:\n* Adds metrics and report generation for resource optimization. This feature will collect additional usage metrics and create a new report in the payload. These metrics are enabled by default, but can be disabled by setting `disable_metrics_collection_resource_optimization` to `true`.\n* Collect all available Prometheus data upon CR creation. This feature only applies to newly created CostManagementMetricsConfigs. The operator will check the monitoring stack configuration in the `openshift-monitoring` namespace. The operator will use the `retention` period set in the `cluster-monitoring-config` ConfigMap if defined, up to a maximum of 90 days. Otherwise it will fall back to collecting 14 days of data, if available. This data collection may be disabled by setting `collect_previous_data` to `false`. Turning this feature off results in the operator collecting metrics from the time the CostManagementMetricsConfig is created, forward.\n\n## Limitations and Pre-Requisites\n#### Limitations (Potential for metrics data loss)\n* An integration **must** exist in console.redhat.com for an uploaded payload to be processed by Cost Management. The operator sends the payload to the Red Hat Insights Ingress service which usually returns successfully, but the operator does not currently confirm with Cost Management that the payload was processed. After Ingress accepts the uploaded payload, it is deleted from the operator. If the data within the payload is not processed, a gap will be introduced in the usage metrics. Data may be recollected by deleting the `CostManagementMetricsConfig`, creating a new `CostManagementMetricsConfig`, and setting `collect_previous_data: true`. This re-collection of data will gather all data stored in Prometheus, up to 90 days.\n\n**Note** The following limitations are specific to operators configured to run in a restricted network:\n* The `costmanagement-metrics-operator` will not be able to generate new reports if the PVC storage is full. If this occurs, the reports must be manually deleted from the PVC so that the operator can function as normal.\n* The default report retention is 30 reports (about one week's worth of data). The reports must be manually downloaded and uploaded to console.redhat.com every week, or they will be deleted and the data will be lost.\n\n#### Storage configuration prerequisite\nThe operator will attempt to create and use the following PVC when installed:\n\n      volume_claim_template:\n        apiVersion: v1\n        kind: PersistentVolumeClaim\n        metadata:\n          name: costmanagement-metrics-operator-data\n        spec:\n          accessModes:\n            - ReadWriteOnce\n          resources:\n            requests:\n              storage: 10Gi\n\nIf a different PVC should be utilized, a valid PVC should be specified in the CostManagementMetricsConfig CR as described in the appropriate section below. The PVC to be used may exist already, or the operator will attempt to create it.\n\nTo use the default specification, the follow assumptions must be met:\n1. A default StorageClass is defined.\n2. Dynamic provisioning for that default StorageClass is enabled.\n\nIf these assumptions are not met, the operator will not deploy correctly. In these cases, storage must be manually configured. After configuring storage, a valid PVC template should be supplied in the `volume_claim_template` spec of the CostManagementMetricsConfig CR.\n\n## Configurable parameters:\n  * `authentication`:\n    * `type: token` -> The authentication method for connecting to `console.redhat.com`. The default and preferred method is `token`. `basic` (deprecated) and `service-account` authentication methods are used when the openshift-config pull-secret does not contain a token for `console.redhat.com`.\n    * `secret_name` -> The Secret used by the operator when the authentication type is `basic` (deprecated) or `service-account`. This parameter is required **only if** the authentication type is `basic` (deprecated) or `service-account`.\n  * `packaging`:\n    * `max_reports_to_store: 30` -> The number of reports to store when configured in air-gapped mode. The default is 30, with a minimum of 1 and no maximum. When the operator is not configured in air-gapped mode, this parameter has no effect. Reports are removed as soon as they are uploaded.\n    * `max_size: 100` -> The maximum size for packaged files in Megabytes prior to compression. The default is 100, with a minimum of 1 and maximum of 100.\n  * `prometheus_config`:\n    * `collect_previous_data: true` -> Toggle for collecting all available data in Prometheus **upon CostManagementMetricsConfig creation** (This parameter will start to appear in CostManagementMetricsConfigs that were created prior to v2.0.0 but will not have any effect unless the CostManagementMetricsConfig is deleted and recreated). The default is `true`. The operator will first look for a `retention` period in the `cluster-monitoring-config` ConfigMap in the `openshift-monitoring` namespace and gather data over this time period up to a maximum of 90 days. If this configuration is not set, the default is 14 days. (New in v2.0.0)\n    * `disable_metrics_collection_cost_management: false` -> Toggle for disabling the collection of metrics for Cost Management. The default is false. (New in v2.0.0)\n    * `disable_metrics_collection_resource_optimization: false` -> Toggle for disabling the collection of metrics for Resource Optimization. The default is false. (New in v2.0.0)\n    * `context_timeout: 120` -> The time in seconds before Prometheus queries timeout due to exceeding context timeout. The default is 120, with a minimum of 10 and maximum of 180.\n  * `source`:\n    * `name: ''` -> The name of the integration the operator will create in `console.redhat.com`. If the name value is empty, the default intergration name is the **cluster id**.\n    * `create_source: false` -> Toggle for whether or not the operator will create the integration in `console.redhat.com`. The default is False. This parameter should be switched to True when an integration does not already exist in `console.redhat.com` for this cluster.\n    * `check_cycle: 1440` -> The time in minutes to wait between checking if an integration exists for this cluster. The default is 1440 minutes (24 hrs).\n  * `upload`:\n    * `upload_cycle: 360` -> The time in minutes between payload uploads. The default is 360 (6 hours), minimum is 60 (1 hour).\n    * `upload_toggle: true` -> Toggle to turn upload on or off -> true means upload, false means do not upload (false == air-gapped mode). The default is `true`.\n    * `upload_wait` -> The amount of time (in seconds) to pause before uploading a payload. The default is a random number between 0 and 35. This is used to decrease service load, but may be set to `0` if desired.\n  * `volume_claim_template` -> see the \"Storage configuration prerequisite\" section above.\n\n## Configure the costmanagement-metrics-operator\n**Note** There are separate instructions for configuring the `costmanagement-metrics-operator` to run in a restricted network.\n##### Configure authentication\nThe default authentication for the operator is `token`. No further steps are required to configure token authentication. If `basic` (deprecated) or `service-account` is the preferred authentication method, a Secret which holds the credentials must be created:\n1. On the left navigation pane, select `Workloads` -> `Secrets` -> select Project: `costmanagement-metrics-operator` -> `Create` -> `Key/Value Secret`\n2. Give the Secret a name and add 2 keys (all lowercase) for the respective authentication type. The values for these keys correspond to console.redhat.com credentials:\n    * basic auth (deprecated): `username` and `password`\n    * service-account auth: `client_id` and `client_secret`\n\n3. Select `Create`.\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. For `basic` (deprecated) or `service-account` authentication, edit the following values in the spec:\n    * Replace `authentication: type:` with `basic` or `service-account`.\n    * Add the `secret_name` field under `authentication`, and set it equal to the name of the authentication Secret that was created above. The spec should look similar to the following:\n\n        * for basic auth type (deprecated)\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: basic\n        ```\n\n        * for service-account auth type\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: service-account\n        ```\n\n3. To configure the costmanagement-metrics-operator to create a cost management integration, edit the following values in the `source` field:\n    * Replace the `name` field value with the preferred name of the integration to be created.\n    * Replace the `create_source` field value with `true`.\n\n    **Note:** if the integration already exists, replace the empty string value of the `name` field with the existing name, and leave `create_source` as false. This will allow the operator to confirm that the integration exists.\n\n4. If not specified, the operator will create a default PersistentVolumeClaim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n5. Select `Create`.\n\n# Restricted Network Usage (disconnected/air-gapped mode)\n## Installation\nTo install the `costmanagement-metrics-operator` in a restricted network, follow the [olm documentation](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html). The operator is found in the `community-operators` Catalog in the `registry.redhat.io/redhat/community-operator-index:latest` Index. If pruning the index before pushing to the mirrored registry, keep the `costmanagement-metrics-operator` package.\n\nWithin a restricted network, the operator queries prometheus to gather the necessary usage metrics, writes the query results to CSV files, and packages the reports for storage in the PVC. These reports then need to be manually downloaded from the cluster and uploaded to [console.redhat.com](https://console.redhat.com).\n\n## Configure the costmanagement-metrics-operator for a restricted network\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. Specify the desired storage. If not specified, the operator will create a default Persistent Volume Claim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec (below is only a template. Any _valid_ `PersistentVolumeClaim` may be defined here):\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            storageClassName: <insert-class-name>\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n3. (Optional) Specify the desired report retention. The operator will retain 30 reports by default. This corresponds to approximately one week's worth of data if using the default packaging cycle. To modify the number of retained reports:\n    * Change the `packaging` spec field `max_reports_to_store` to the desired number of reports to retain. Once this max number is reached, the operator will start removing the oldest packages remaining on the PVC:\n\n      ```\n        packaging:\n          max_size_MB: 100\n          max_reports_to_store: 30\n      ```\n\n    **Note:** The number of retained reports directly affects the frequency that reports must be manually downloaded from the PVC. Take caution in setting this to a higher number of reports, as the operator cannot write data to the PVC if the storage is full.\n4. To configure the operator to perform in a restricted network, set the `upload_toggle` to `false`:\n\n  ```\n    upload:\n      upload_cycle: 360\n      upload_toggle: false\n  ```\n\n5. Select `Create`.\n\n## Download reports from the Operator & clean up the PVC\nIf the `costmanagement-metrics-operator` is configured to run in a restricted network, the metric reports will not automatically upload to cost managment. Instead, they need to be manually copied from the PVC for upload to [console.redhat.com](https://console.redhat.com). The default configuration saves one week of reports which means the process of downloading and uploading reports should be repeated weekly to prevent loss of metrics data. To download the reports, complete the following steps:\n1. Create the following Pod, ensuring the `claimName` matches the PVC containing the report data:\n\n  ```\n    kind: Pod\n    apiVersion: v1\n    metadata:\n      name: volume-shell\n      namespace: costmanagement-metrics-operator\n      labels:\n        app: costmanagement-metrics-operator\n    spec:\n      volumes:\n      - name: costmanagement-metrics-operator-reports\n        persistentVolumeClaim:\n          claimName: costmanagement-metrics-operator-data\n      containers:\n      - name: volume-shell\n        image: busybox\n        command: ['sleep', 'infinity']\n        volumeMounts:\n        - name: costmanagement-metrics-operator-reports\n          mountPath: /tmp/costmanagement-metrics-operator-reports\n  ```\n\n2. Use rsync to copy all of the files ready for upload from the PVC to a local folder:\n\n  ```\n  $ oc rsync volume-shell:/tmp/costmanagement-metrics-operator-reports/upload local/path/to/save/folder\n  ```\n\n3. Once confirming that the files have been successfully copied, use rsh to connect to the pod and delete the contents of the upload folder so that they are no longer in storage:\n\n  ```\n  $ oc rsh volume-shell\n  $ rm /tmp/costmanagement-metrics-operator-reports/upload/*\n  ```\n\n4. (Optional) Delete the pod that was used to connect to the PVC:\n\n  ```\n  $ oc delete -f volume-shell.yaml\n  ```\n\n## Create an Integration\nIn a restricted network, the `costmanagement-metrics-operator` cannot automatically create an integration. This process must be done manually. In the console.redhat.com platform, open the [Integrations menu](https://console.redhat.com/settings/integrations/) to begin adding an OpenShift integration to Cost Management:\n\nPrerequisites:\n* The cluster identifier which can be found in the CostManagementMetricsConfig CR, the cluster Overview page, or the cluster Help > About.\n\nCreating an integration:\n1. Navigate to the Integrations menu\n2. Select the `Red Hat` tab\n3. Create a new `Red Hat Openshift Container Platform` integration:\n    * give the integration a unique name\n    * add the Cost Management application\n    * add the cluster identifier\n4. In the Source wizard, review the details and click `Finish` to create the source.\n\n## Upload the reports to cost managment\nUploading reports to cost managment is done through curl:\n\n    $ curl -vvvv -F \"file=@FILE_NAME.tar.gz;type=application/vnd.redhat.hccm.tar+tgz\"  https://console.redhat.com/api/ingress/v1/upload -u USERNAME:PASS\n\nwhere `USERNAME` and `PASS` correspond to the user credentials for [console.redhat.com](https://console.redhat.com), and `FILE_NAME` is the name of the report to upload.\n",
        "displayName": "Cost Management Metrics Operator",
        "installModes": [
          {
            "type": "OwnNamespace",
            "supported": true
          },
          {
            "type": "SingleNamespace",
            "supported": true
          },
          {
            "type": "MultiNamespace",
            "supported": false
          },
          {
            "type": "AllNamespaces",
            "supported": false
          }
        ],
        "keywords": [
          "cost",
          "management",
          "usage",
          "monitor"
        ],
        "labels": {
          "operatorframework.io/arch.amd64": "supported",
          "operatorframework.io/arch.arm64": "supported",
          "operatorframework.io/arch.ppc64le": "supported",
          "operatorframework.io/arch.s390x": "supported",
          "operatorframework.io/os.linux": "supported"
        },
        "maintainers": [
          {
            "name": "costmanagement",
            "email": "costmanagement@redhat.com"
          }
        ],
        "maturity": "alpha",
        "minKubeVersion": "1.24.0",
        "provider": {
          "name": "Red Hat"
        }
      }
    }
  ],
  "relatedImages": [
    {
      "name": "",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:a1dc9a219534acb572ea00c5749e5db7aa083682e2b381dd9faddbc907b4792b"
    },
    {
      "name": "costmanagement-metrics-rhel8-operator-ee69d5cbf5909bdbffb85e2c55e8b830939ab1c9e6c3a679552bad8e0c90e657-annotation",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:ee69d5cbf5909bdbffb85e2c55e8b830939ab1c9e6c3a679552bad8e0c90e657"
    },
    {
      "name": "manager",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:ee69d5cbf5909bdbffb85e2c55e8b830939ab1c9e6c3a679552bad8e0c90e657"
    }
  ]
}
{
  "schema": "olm.bundle",
  "name": "costmanagement-metrics-operator.3.3.0",
  "package": "costmanagement-metrics-operator",
  "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:226634a6f640c8095b8c61055d8c9bb4c81dc50d1cf413267b23caa488982f1b",
  "properties": [
    {
      "type": "olm.gvk",
      "value": {
        "group": "costmanagement-metrics-cfg.openshift.io",
        "kind": "CostManagementMetricsConfig",
        "version": "v1beta1"
      }
    },
    {
      "type": "olm.package",
      "value": {
        "packageName": "costmanagement-metrics-operator",
        "version": "3.3.0"
      }
    },
    {
      "type": "olm.csv.metadata",
      "value": {
        "annotations": {
          "alm-examples": "[\n  {\n    \"apiVersion\": \"costmanagement-metrics-cfg.openshift.io/v1beta1\",\n    \"kind\": \"CostManagementMetricsConfig\",\n    \"metadata\": {\n      \"name\": \"costmanagementmetricscfg-sample-v1beta1\"\n    },\n    \"spec\": {\n      \"authentication\": {\n        \"type\": \"token\"\n      },\n      \"packaging\": {\n        \"max_reports_to_store\": 30,\n        \"max_size_MB\": 100\n      },\n      \"prometheus_config\": {\n        \"collect_previous_data\": true,\n        \"context_timeout\": 120,\n        \"disable_metrics_collection_cost_management\": false,\n        \"disable_metrics_collection_resource_optimization\": false\n      },\n      \"source\": {\n        \"check_cycle\": 1440,\n        \"create_source\": false,\n        \"name\": \"\"\n      },\n      \"upload\": {\n        \"upload_cycle\": 360,\n        \"upload_toggle\": true\n      }\n    }\n  }\n]",
          "capabilities": "Seamless Upgrades",
          "categories": "Monitoring",
          "certified": "true",
          "containerImage": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:d1e94a6e7a52e14e96a9acba54aeae4cb1aae0dad220298bb2ed034f9df19ee4",
          "createdAt": "2024-05-31T16:16:46Z",
          "description": "A Golang-based OpenShift Operator that generates and uploads OpenShift usage metrics to cost management.",
          "features.operators.openshift.io/disconnected": "true",
          "features.operators.openshift.io/fips-compliant": "false",
          "features.operators.openshift.io/proxy-aware": "true",
          "features.operators.openshift.io/tls-profiles": "false",
          "features.operators.openshift.io/token-auth-aws": "false",
          "features.operators.openshift.io/token-auth-azure": "false",
          "features.operators.openshift.io/token-auth-gcp": "false",
          "operatorframework.io/suggested-namespace": "costmanagement-metrics-operator",
          "operators.openshift.io/infrastructure-features": "[\"disconnected\", \"proxy-aware\"]",
          "operators.openshift.io/valid-subscription": "[\"OpenShift Kubernetes Engine\", \"OpenShift Container Platform\", \"OpenShift Platform Plus\"]",
          "operators.operatorframework.io/builder": "operator-sdk-v1.33.0",
          "operators.operatorframework.io/project_layout": "go.kubebuilder.io/v4",
          "repository": "https://github.com/project-koku/koku-metrics-operator",
          "support": "Red Hat"
        },
        "apiServiceDefinitions": {},
        "crdDescriptions": {
          "owned": [
            {
              "name": "costmanagementmetricsconfigs.costmanagement-metrics-cfg.openshift.io",
              "version": "v1beta1",
              "kind": "CostManagementMetricsConfig",
              "displayName": "Cost Management Metrics Config",
              "description": "CostManagementMetricsConfig is the Schema for the costmanagementmetricsconfig API"
            }
          ]
        },
        "description": "# Cost Management Metrics Operator\n## Introduction\nThe `costmanagement-metrics-operator` is a component of the [cost managment](https://access.redhat.com/documentation/en-us/cost_management_service) service for Openshift. The operator runs on the latest supported versions of Openshift. This operator obtains OpenShift usage data by querying Prometheus every hour to create metric reports that it uploads to Cost Management at [console.redhat.com](https://console.redhat.com) to be processed. For more information, reach out to <costmanagement@redhat.com>.\n\nThis operator is capable of functioning within a disconnected/restricted network (aka air-gapped mode). In this mode, the operator will store the packaged reports for manual retrieval instead of being uploaded to Cost Management. Documentation for installing an operator within a restricted network can be found [here](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html).\n\n## Features and Capabilities\n#### Metrics collection:\nThe Cost Management Metrics Operator (`costmanagement-metrics-operator`) collects the metrics required for Cost Management by:\n* Querying Prometheus to gather the necessary metrics for Cost Management.\n* Writing the results of Prometheus queries to CSV report files.\n* Packaging the CSV report files into tarballs.\n\n#### Additional Capabilities:\n* Resource Optimization metrics collection.\n* The operator can be configured to gather all previous data within the configured retention period or a maximum of 90 days. The default data collection period is the 14 previous days. This setting is only applicable to newly created CostManagementMetricsConfigs.\n* The operator can be configured to automatically upload the packaged reports to Cost Management through Red Hat Insights Ingress service.\n* The operator can create an integration in console.redhat.com. An integration is required for Cost Management to process the uploaded packages.\n* PersistentVolumeClaim (PVC) configuration: The CostManagementMetricsConfig CR can accept a PVC definition and the operator will create and mount the PVC. If one is not provided, a default PVC will be created.\n* Restricted network installation: this operator can function on a restricted network. In this mode, the operator stores the packaged reports for manual retrieval.\n\n## New in v3.3.0:\n* Storage reports now contain `node`, `csi_driver`, and `csi_volume_handle` fields.\n* The PVC capacity is now populated using the `kube_persistentvolume_capacity_bytes` metric instead of `kubelet_volume_stats_capacity_bytes`.\n* To receive resource optimization recommendations for your namespaces, you must now first enable each namespace. To enable a namespace, label it with `insights_cost_management_optimizations='true'`. In the CLI, run:\n  ```\n    oc label namespace NAMESPACE insights_cost_management_optimizations=\"true\" --overwrite=true\n  ```\n* __DEPRECATION NOTICE__: Basic authentication is deprecated and will not be supported beyond December 31, 2024. If the default token authentication method cannot be used, you must switch to [service account](https://console.redhat.com/iam/service-accounts) authentication ([more on creating a service account](https://access.redhat.com/articles/7036194)). Once you have created your service account, follow [this documentation](https://access.redhat.com/documentation/en-us/cost_management_service/1-latest/html-single/integrating_openshift_container_platform_data_into_cost_management/index#service-account-authentication_adding-an-ocp-int) on how to configure your operator to use service account authentication. Service-accounts must also be used if manually uploading payloads to console.redhat.com.\n\n## New in v3.2.1:\n* The minimum supported configuration for `upload_cycle` is now 60 (minutes).\n* (Bugfix) many-to-many matching not allowed query fix.\n* (Bugfix) Sequentially collect data during initial install.\n\n## New in v3.2.0:\n* Support for amd64, arm64, ppc64le, s390x architectures.\n* add liveness and readiness probes to controller Pod.\n* update pod security settings so that the controller Pod can run in Restricted mode [more info](https://sdk.operatorframework.io/docs/best-practices/pod-security-standards/).\n\n## New in v3.1.0:\n* Add service-account authentication type.\n* __Deprecation Notice:__ Basic authentication is deprecated and will be removed in a future version of the operator.\n\n## New in v3.0.0:\n* Daily report generation: Operator versions prior to v3.0.0 generated sequential reports. Now, reports are generated starting at 0:00 UTC. Any payloads generated throughout a given day will contain all data starting from 0:00 UTC. Once the next day starts, the previous day's reports are packaged, and the new report again starts at 0:00 UTC for the current day.\n* Failed query retry: In an attempt to prevent missing data, the operator will retry queries from the last successful query time, up to 5 times.\n\n## New in v2.0.0:\n* Adds metrics and report generation for resource optimization. This feature will collect additional usage metrics and create a new report in the payload. These metrics are enabled by default, but can be disabled by setting `disable_metrics_collection_resource_optimization` to `true`.\n* Collect all available Prometheus data upon CR creation. This feature only applies to newly created CostManagementMetricsConfigs. The operator will check the monitoring stack configuration in the `openshift-monitoring` namespace. The operator will use the `retention` period set in the `cluster-monitoring-config` ConfigMap if defined, up to a maximum of 90 days. Otherwise it will fall back to collecting 14 days of data, if available. This data collection may be disabled by setting `collect_previous_data` to `false`. Turning this feature off results in the operator collecting metrics from the time the CostManagementMetricsConfig is created, forward.\n\n## Limitations and Pre-Requisites\n#### Limitations (Potential for metrics data loss)\n* An integration **must** exist in console.redhat.com for an uploaded payload to be processed by Cost Management. The operator sends the payload to the Red Hat Insights Ingress service which usually returns successfully, but the operator does not currently confirm with Cost Management that the payload was processed. After Ingress accepts the uploaded payload, it is deleted from the operator. If the data within the payload is not processed, a gap will be introduced in the usage metrics. Data may be recollected by deleting the `CostManagementMetricsConfig`, creating a new `CostManagementMetricsConfig`, and setting `collect_previous_data: true`. This re-collection of data will gather all data stored in Prometheus, up to 90 days.\n\n**Note** The following limitations are specific to operators configured to run in a restricted network:\n* The `costmanagement-metrics-operator` will not be able to generate new reports if the PVC storage is full. If this occurs, the reports must be manually deleted from the PVC so that the operator can function as normal.\n* The default report retention is 30 reports (about one week's worth of data). The reports must be manually downloaded and uploaded to console.redhat.com every week, or they will be deleted and the data will be lost.\n\n#### Storage configuration prerequisite\nThe operator will attempt to create and use the following PVC when installed:\n\n      volume_claim_template:\n        apiVersion: v1\n        kind: PersistentVolumeClaim\n        metadata:\n          name: costmanagement-metrics-operator-data\n        spec:\n          accessModes:\n            - ReadWriteOnce\n          resources:\n            requests:\n              storage: 10Gi\n\nIf a different PVC should be utilized, a valid PVC should be specified in the CostManagementMetricsConfig CR as described in the appropriate section below. The PVC to be used may exist already, or the operator will attempt to create it.\n\nTo use the default specification, the follow assumptions must be met:\n1. A default StorageClass is defined.\n2. Dynamic provisioning for that default StorageClass is enabled.\n\nIf these assumptions are not met, the operator will not deploy correctly. In these cases, storage must be manually configured. After configuring storage, a valid PVC template should be supplied in the `volume_claim_template` spec of the CostManagementMetricsConfig CR.\n\n## Configurable parameters:\n  * `authentication`:\n    * `type: token` -> The authentication method for connecting to `console.redhat.com`. The default and preferred method is `token`. `basic` (deprecated) and `service-account` authentication methods are used when the openshift-config pull-secret does not contain a token for `console.redhat.com`.\n    * `secret_name` -> The Secret used by the operator when the authentication type is `basic` (deprecated) or `service-account`. This parameter is required **only if** the authentication type is `basic` (deprecated) or `service-account`.\n  * `packaging`:\n    * `max_reports_to_store: 30` -> The number of reports to store when configured in air-gapped mode. The default is 30, with a minimum of 1 and no maximum. When the operator is not configured in air-gapped mode, this parameter has no effect. Reports are removed as soon as they are uploaded.\n    * `max_size: 100` -> The maximum size for packaged files in Megabytes prior to compression. The default is 100, with a minimum of 1 and maximum of 100.\n  * `prometheus_config`:\n    * `collect_previous_data: true` -> Toggle for collecting all available data in Prometheus **upon CostManagementMetricsConfig creation** (This parameter will start to appear in CostManagementMetricsConfigs that were created prior to v2.0.0 but will not have any effect unless the CostManagementMetricsConfig is deleted and recreated). The default is `true`. The operator will first look for a `retention` period in the `cluster-monitoring-config` ConfigMap in the `openshift-monitoring` namespace and gather data over this time period up to a maximum of 90 days. If this configuration is not set, the default is 14 days. (New in v2.0.0)\n    * `disable_metrics_collection_cost_management: false` -> Toggle for disabling the collection of metrics for Cost Management. The default is false. (New in v2.0.0)\n    * `disable_metrics_collection_resource_optimization: false` -> Toggle for disabling the collection of metrics for Resource Optimization. The default is false. (New in v2.0.0)\n    * `context_timeout: 120` -> The time in seconds before Prometheus queries timeout due to exceeding context timeout. The default is 120, with a minimum of 10 and maximum of 180.\n  * `source`:\n    * `name: ''` -> The name of the integration the operator will create in `console.redhat.com`. If the name value is empty, the default intergration name is the **cluster id**.\n    * `create_source: false` -> Toggle for whether or not the operator will create the integration in `console.redhat.com`. The default is False. This parameter should be switched to True when an integration does not already exist in `console.redhat.com` for this cluster.\n    * `check_cycle: 1440` -> The time in minutes to wait between checking if an integration exists for this cluster. The default is 1440 minutes (24 hrs).\n  * `upload`:\n    * `upload_cycle: 360` -> The time in minutes between payload uploads. The default is 360 (6 hours), minimum is 60 (1 hour).\n    * `upload_toggle: true` -> Toggle to turn upload on or off -> true means upload, false means do not upload (false == air-gapped mode). The default is `true`.\n    * `upload_wait` -> The amount of time (in seconds) to pause before uploading a payload. The default is a random number between 0 and 35. This is used to decrease service load, but may be set to `0` if desired.\n  * `volume_claim_template` -> see the \"Storage configuration prerequisite\" section above.\n\n## Configure the costmanagement-metrics-operator\n**Note** There are separate instructions for configuring the `costmanagement-metrics-operator` to run in a restricted network.\n##### Configure authentication\nThe default authentication for the operator is `token`. No further steps are required to configure token authentication. If `basic` (deprecated) or `service-account` is the preferred authentication method, a Secret which holds the credentials must be created:\n1. On the left navigation pane, select `Workloads` -> `Secrets` -> select Project: `costmanagement-metrics-operator` -> `Create` -> `Key/Value Secret`\n2. Give the Secret a name and add 2 keys (all lowercase) for the respective authentication type. The values for these keys correspond to console.redhat.com credentials:\n    * basic auth (deprecated): `username` and `password`\n    * service-account auth: `client_id` and `client_secret`\n\n3. Select `Create`.\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. For `basic` (deprecated) or `service-account` authentication, edit the following values in the spec:\n    * Replace `authentication: type:` with `basic` or `service-account`.\n    * Add the `secret_name` field under `authentication`, and set it equal to the name of the authentication Secret that was created above. The spec should look similar to the following:\n\n        * for basic auth type (deprecated)\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: basic\n        ```\n\n        * for service-account auth type\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: service-account\n        ```\n\n3. To configure the costmanagement-metrics-operator to create a cost management integration, edit the following values in the `source` field:\n    * Replace the `name` field value with the preferred name of the integration to be created.\n    * Replace the `create_source` field value with `true`.\n\n    **Note:** if the integration already exists, replace the empty string value of the `name` field with the existing name, and leave `create_source` as false. This will allow the operator to confirm that the integration exists.\n\n4. If not specified, the operator will create a default PersistentVolumeClaim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n5. Select `Create`.\n\n# Restricted Network Usage (disconnected/air-gapped mode)\n## Installation\nTo install the `costmanagement-metrics-operator` in a restricted network, follow the [olm documentation](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html). The operator is found in the `community-operators` Catalog in the `registry.redhat.io/redhat/community-operator-index:latest` Index. If pruning the index before pushing to the mirrored registry, keep the `costmanagement-metrics-operator` package.\n\nWithin a restricted network, the operator queries prometheus to gather the necessary usage metrics, writes the query results to CSV files, and packages the reports for storage in the PVC. These reports then need to be manually downloaded from the cluster and uploaded to [console.redhat.com](https://console.redhat.com).\n\n## Configure the costmanagement-metrics-operator for a restricted network\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. Specify the desired storage. If not specified, the operator will create a default Persistent Volume Claim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec (below is only a template. Any _valid_ `PersistentVolumeClaim` may be defined here):\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            storageClassName: <insert-class-name>\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n3. (Optional) Specify the desired report retention. The operator will retain 30 reports by default. This corresponds to approximately one week's worth of data if using the default packaging cycle. To modify the number of retained reports:\n    * Change the `packaging` spec field `max_reports_to_store` to the desired number of reports to retain. Once this max number is reached, the operator will start removing the oldest packages remaining on the PVC:\n\n      ```\n        packaging:\n          max_size_MB: 100\n          max_reports_to_store: 30\n      ```\n\n    **Note:** The number of retained reports directly affects the frequency that reports must be manually downloaded from the PVC. Take caution in setting this to a higher number of reports, as the operator cannot write data to the PVC if the storage is full.\n4. To configure the operator to perform in a restricted network, set the `upload_toggle` to `false`:\n\n  ```\n    upload:\n      upload_cycle: 360\n      upload_toggle: false\n  ```\n\n5. Select `Create`.\n\n## Download reports from the Operator & clean up the PVC\nIf the `costmanagement-metrics-operator` is configured to run in a restricted network, the metric reports will not automatically upload to cost managment. Instead, they need to be manually copied from the PVC for upload to [console.redhat.com](https://console.redhat.com). The default configuration saves one week of reports which means the process of downloading and uploading reports should be repeated weekly to prevent loss of metrics data. To download the reports, complete the following steps:\n1. Create the following Pod, ensuring the `claimName` matches the PVC containing the report data:\n\n  ```\n    kind: Pod\n    apiVersion: v1\n    metadata:\n      name: volume-shell\n      namespace: costmanagement-metrics-operator\n      labels:\n        app: costmanagement-metrics-operator\n    spec:\n      volumes:\n      - name: costmanagement-metrics-operator-reports\n        persistentVolumeClaim:\n          claimName: costmanagement-metrics-operator-data\n      containers:\n      - name: volume-shell\n        image: busybox\n        command: ['sleep', 'infinity']\n        volumeMounts:\n        - name: costmanagement-metrics-operator-reports\n          mountPath: /tmp/costmanagement-metrics-operator-reports\n  ```\n\n2. Use rsync to copy all of the files ready for upload from the PVC to a local folder:\n\n  ```\n  $ oc rsync volume-shell:/tmp/costmanagement-metrics-operator-reports/upload local/path/to/save/folder\n  ```\n\n3. Once confirming that the files have been successfully copied, use rsh to connect to the pod and delete the contents of the upload folder so that they are no longer in storage:\n\n  ```\n  $ oc rsh volume-shell\n  $ rm /tmp/costmanagement-metrics-operator-reports/upload/*\n  ```\n\n4. (Optional) Delete the pod that was used to connect to the PVC:\n\n  ```\n  $ oc delete -f volume-shell.yaml\n  ```\n\n## Create an Integration\nIn a restricted network, the `costmanagement-metrics-operator` cannot automatically create an integration. This process must be done manually. In the console.redhat.com platform, open the [Integrations menu](https://console.redhat.com/settings/integrations/) to begin adding an OpenShift integration to Cost Management:\n\nPrerequisites:\n* The cluster identifier which can be found in the CostManagementMetricsConfig CR, the cluster Overview page, or the cluster Help > About.\n\nCreating an integration:\n1. Navigate to the Integrations menu\n2. Select the `Red Hat` tab\n3. Create a new `Red Hat Openshift Container Platform` integration:\n    * give the integration a unique name\n    * add the Cost Management application\n    * add the cluster identifier\n4. In the Source wizard, review the details and click `Finish` to create the source.\n\n## Upload the reports to cost managment\nUploading reports to cost managment is done through curl:\n\n    $ curl -vvvv -F \"file=@FILE_NAME.tar.gz;type=application/vnd.redhat.hccm.tar+tgz\" https://console.redhat.com/api/ingress/v1/upload -H \"Authorization: Bearer ${ACCESS_TOKEN}\"\n\nwhere `FILE_NAME` is the name of the report to upload. The `ACCESS_TOKEN` is acquired using a [service-account](https://access.redhat.com/articles/7036194).\n",
        "displayName": "Cost Management Metrics Operator",
        "installModes": [
          {
            "type": "OwnNamespace",
            "supported": true
          },
          {
            "type": "SingleNamespace",
            "supported": true
          },
          {
            "type": "MultiNamespace",
            "supported": false
          },
          {
            "type": "AllNamespaces",
            "supported": false
          }
        ],
        "keywords": [
          "cost",
          "management",
          "usage",
          "monitor"
        ],
        "labels": {
          "operatorframework.io/arch.amd64": "supported",
          "operatorframework.io/arch.arm64": "supported",
          "operatorframework.io/arch.ppc64le": "supported",
          "operatorframework.io/arch.s390x": "supported",
          "operatorframework.io/os.linux": "supported"
        },
        "links": [
          {
            "name": "Cost Management Metrics Operator source code repository",
            "url": "https://github.com/project-koku/koku-metrics-operator"
          }
        ],
        "maintainers": [
          {
            "name": "costmanagement",
            "email": "costmanagement@redhat.com"
          }
        ],
        "maturity": "alpha",
        "minKubeVersion": "1.24.0",
        "provider": {
          "name": "Red Hat"
        }
      }
    }
  ],
  "relatedImages": [
    {
      "name": "",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:226634a6f640c8095b8c61055d8c9bb4c81dc50d1cf413267b23caa488982f1b"
    },
    {
      "name": "costmanagement-metrics-rhel8-operator-d1e94a6e7a52e14e96a9acba54aeae4cb1aae0dad220298bb2ed034f9df19ee4-annotation",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:d1e94a6e7a52e14e96a9acba54aeae4cb1aae0dad220298bb2ed034f9df19ee4"
    },
    {
      "name": "manager",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:d1e94a6e7a52e14e96a9acba54aeae4cb1aae0dad220298bb2ed034f9df19ee4"
    }
  ]
}
{
  "schema": "olm.bundle",
  "name": "costmanagement-metrics-operator.3.3.1",
  "package": "costmanagement-metrics-operator",
  "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:01cab18a6af3cc819a936ce434004d5dce4495474e62bc116643eb753c25cd91",
  "properties": [
    {
      "type": "olm.gvk",
      "value": {
        "group": "costmanagement-metrics-cfg.openshift.io",
        "kind": "CostManagementMetricsConfig",
        "version": "v1beta1"
      }
    },
    {
      "type": "olm.package",
      "value": {
        "packageName": "costmanagement-metrics-operator",
        "version": "3.3.1"
      }
    },
    {
      "type": "olm.csv.metadata",
      "value": {
        "annotations": {
          "alm-examples": "[\n  {\n    \"apiVersion\": \"costmanagement-metrics-cfg.openshift.io/v1beta1\",\n    \"kind\": \"CostManagementMetricsConfig\",\n    \"metadata\": {\n      \"name\": \"costmanagementmetricscfg-sample-v1beta1\"\n    },\n    \"spec\": {\n      \"authentication\": {\n        \"type\": \"token\"\n      },\n      \"packaging\": {\n        \"max_reports_to_store\": 30,\n        \"max_size_MB\": 100\n      },\n      \"prometheus_config\": {\n        \"collect_previous_data\": true,\n        \"context_timeout\": 120,\n        \"disable_metrics_collection_cost_management\": false,\n        \"disable_metrics_collection_resource_optimization\": false\n      },\n      \"source\": {\n        \"check_cycle\": 1440,\n        \"create_source\": false,\n        \"name\": \"\"\n      },\n      \"upload\": {\n        \"upload_cycle\": 360,\n        \"upload_toggle\": true\n      }\n    }\n  }\n]",
          "capabilities": "Seamless Upgrades",
          "categories": "Monitoring",
          "certified": "true",
          "containerImage": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:f03828d6e5c1d0aef3a10230f5199ac768328535cde12b594920b98106845477",
          "createdAt": "2024-08-12T20:58:49Z",
          "description": "A Golang-based OpenShift Operator that generates and uploads OpenShift usage metrics to cost management.",
          "features.operators.openshift.io/disconnected": "true",
          "features.operators.openshift.io/fips-compliant": "false",
          "features.operators.openshift.io/proxy-aware": "true",
          "features.operators.openshift.io/tls-profiles": "false",
          "features.operators.openshift.io/token-auth-aws": "false",
          "features.operators.openshift.io/token-auth-azure": "false",
          "features.operators.openshift.io/token-auth-gcp": "false",
          "operatorframework.io/suggested-namespace": "costmanagement-metrics-operator",
          "operators.openshift.io/infrastructure-features": "[\"disconnected\", \"proxy-aware\"]",
          "operators.openshift.io/valid-subscription": "[\"OpenShift Kubernetes Engine\", \"OpenShift Container Platform\", \"OpenShift Platform Plus\"]",
          "operators.operatorframework.io/builder": "operator-sdk-v1.35.0",
          "operators.operatorframework.io/project_layout": "go.kubebuilder.io/v4",
          "repository": "https://github.com/project-koku/koku-metrics-operator",
          "support": "Red Hat"
        },
        "apiServiceDefinitions": {},
        "crdDescriptions": {
          "owned": [
            {
              "name": "costmanagementmetricsconfigs.costmanagement-metrics-cfg.openshift.io",
              "version": "v1beta1",
              "kind": "CostManagementMetricsConfig",
              "displayName": "Cost Management Metrics Config",
              "description": "CostManagementMetricsConfig is the Schema for the costmanagementmetricsconfig API"
            }
          ]
        },
        "description": "# Cost Management Metrics Operator\n## Introduction\nThe `costmanagement-metrics-operator` is a component of the [cost managment](https://access.redhat.com/documentation/en-us/cost_management_service) service for Openshift. The operator runs on the latest supported versions of Openshift. This operator obtains OpenShift usage data by querying Prometheus every hour to create metric reports that it uploads to Cost Management at [console.redhat.com](https://console.redhat.com) to be processed. For more information, reach out to <costmanagement@redhat.com>.\n\nThis operator is capable of functioning within a disconnected/restricted network (aka air-gapped mode). In this mode, the operator will store the packaged reports for manual retrieval instead of being uploaded to Cost Management. Documentation for installing an operator within a restricted network can be found [here](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html).\n\n## Features and Capabilities\n#### Metrics collection:\nThe Cost Management Metrics Operator (`costmanagement-metrics-operator`) collects the metrics required for Cost Management by:\n* Querying Prometheus to gather the necessary metrics for Cost Management.\n* Writing the results of Prometheus queries to CSV report files.\n* Packaging the CSV report files into tarballs.\n\n#### Additional Capabilities:\n* Resource Optimization metrics collection.\n* The operator can be configured to gather all previous data within the configured retention period or a maximum of 90 days. The default data collection period is the 14 previous days. This setting is only applicable to newly created CostManagementMetricsConfigs.\n* The operator can be configured to automatically upload the packaged reports to Cost Management through Red Hat Insights Ingress service.\n* The operator can create an integration in console.redhat.com. An integration is required for Cost Management to process the uploaded packages.\n* PersistentVolumeClaim (PVC) configuration: The CostManagementMetricsConfig CR can accept a PVC definition and the operator will create and mount the PVC. If one is not provided, a default PVC will be created.\n* Restricted network installation: this operator can function on a restricted network. In this mode, the operator stores the packaged reports for manual retrieval.\n\n## New in v3.3.1:\n* Optimize memory usage when reading CSV files.\n\n## New in v3.3.0:\n* Storage reports now contain `node`, `csi_driver`, and `csi_volume_handle` fields.\n* The PVC capacity is now populated using the `kube_persistentvolume_capacity_bytes` metric instead of `kubelet_volume_stats_capacity_bytes`.\n* To receive resource optimization recommendations for your namespaces, you must now first enable each namespace. To enable a namespace, label it with `insights_cost_management_optimizations='true'`. In the CLI, run:\n  ```\n    oc label namespace NAMESPACE insights_cost_management_optimizations=\"true\" --overwrite=true\n  ```\n* __DEPRECATION NOTICE__: Basic authentication is deprecated and will not be supported beyond December 31, 2024. If the default token authentication method cannot be used, you must switch to [service account](https://console.redhat.com/iam/service-accounts) authentication ([more on creating a service account](https://access.redhat.com/articles/7036194)). Once you have created your service account, follow [this documentation](https://access.redhat.com/documentation/en-us/cost_management_service/1-latest/html-single/integrating_openshift_container_platform_data_into_cost_management/index#service-account-authentication_adding-an-ocp-int) on how to configure your operator to use service account authentication. Service-accounts must also be used if manually uploading payloads to console.redhat.com.\n\n## New in v3.2.1:\n* The minimum supported configuration for `upload_cycle` is now 60 (minutes).\n* (Bugfix) many-to-many matching not allowed query fix.\n* (Bugfix) Sequentially collect data during initial install.\n\n## New in v3.2.0:\n* Support for amd64, arm64, ppc64le, s390x architectures.\n* add liveness and readiness probes to controller Pod.\n* update pod security settings so that the controller Pod can run in Restricted mode [more info](https://sdk.operatorframework.io/docs/best-practices/pod-security-standards/).\n\n## New in v3.1.0:\n* Add service-account authentication type.\n* __Deprecation Notice:__ Basic authentication is deprecated and will be removed in a future version of the operator.\n\n## New in v3.0.0:\n* Daily report generation: Operator versions prior to v3.0.0 generated sequential reports. Now, reports are generated starting at 0:00 UTC. Any payloads generated throughout a given day will contain all data starting from 0:00 UTC. Once the next day starts, the previous day's reports are packaged, and the new report again starts at 0:00 UTC for the current day.\n* Failed query retry: In an attempt to prevent missing data, the operator will retry queries from the last successful query time, up to 5 times.\n\n## New in v2.0.0:\n* Adds metrics and report generation for resource optimization. This feature will collect additional usage metrics and create a new report in the payload. These metrics are enabled by default, but can be disabled by setting `disable_metrics_collection_resource_optimization` to `true`.\n* Collect all available Prometheus data upon CR creation. This feature only applies to newly created CostManagementMetricsConfigs. The operator will check the monitoring stack configuration in the `openshift-monitoring` namespace. The operator will use the `retention` period set in the `cluster-monitoring-config` ConfigMap if defined, up to a maximum of 90 days. Otherwise it will fall back to collecting 14 days of data, if available. This data collection may be disabled by setting `collect_previous_data` to `false`. Turning this feature off results in the operator collecting metrics from the time the CostManagementMetricsConfig is created, forward.\n\n## Limitations and Pre-Requisites\n#### Limitations (Potential for metrics data loss)\n* An integration **must** exist in console.redhat.com for an uploaded payload to be processed by Cost Management. The operator sends the payload to the Red Hat Insights Ingress service which usually returns successfully, but the operator does not currently confirm with Cost Management that the payload was processed. After Ingress accepts the uploaded payload, it is deleted from the operator. If the data within the payload is not processed, a gap will be introduced in the usage metrics. Data may be recollected by deleting the `CostManagementMetricsConfig`, creating a new `CostManagementMetricsConfig`, and setting `collect_previous_data: true`. This re-collection of data will gather all data stored in Prometheus, up to 90 days.\n\n**Note** The following limitations are specific to operators configured to run in a restricted network:\n* The `costmanagement-metrics-operator` will not be able to generate new reports if the PVC storage is full. If this occurs, the reports must be manually deleted from the PVC so that the operator can function as normal.\n* The default report retention is 30 reports (about one week's worth of data). The reports must be manually downloaded and uploaded to console.redhat.com every week, or they will be deleted and the data will be lost.\n\n#### Storage configuration prerequisite\nThe operator will attempt to create and use the following PVC when installed:\n\n      volume_claim_template:\n        apiVersion: v1\n        kind: PersistentVolumeClaim\n        metadata:\n          name: costmanagement-metrics-operator-data\n        spec:\n          accessModes:\n            - ReadWriteOnce\n          resources:\n            requests:\n              storage: 10Gi\n\nIf a different PVC should be utilized, a valid PVC should be specified in the CostManagementMetricsConfig CR as described in the appropriate section below. The PVC to be used may exist already, or the operator will attempt to create it.\n\nTo use the default specification, the follow assumptions must be met:\n1. A default StorageClass is defined.\n2. Dynamic provisioning for that default StorageClass is enabled.\n\nIf these assumptions are not met, the operator will not deploy correctly. In these cases, storage must be manually configured. After configuring storage, a valid PVC template should be supplied in the `volume_claim_template` spec of the CostManagementMetricsConfig CR.\n\n## Configurable parameters:\n  * `authentication`:\n    * `type: token` -> The authentication method for connecting to `console.redhat.com`. The default and preferred method is `token`. `basic` (deprecated) and `service-account` authentication methods are used when the openshift-config pull-secret does not contain a token for `console.redhat.com`.\n    * `secret_name` -> The Secret used by the operator when the authentication type is `basic` (deprecated) or `service-account`. This parameter is required **only if** the authentication type is `basic` (deprecated) or `service-account`.\n  * `packaging`:\n    * `max_reports_to_store: 30` -> The number of reports to store when configured in air-gapped mode. The default is 30, with a minimum of 1 and no maximum. When the operator is not configured in air-gapped mode, this parameter has no effect. Reports are removed as soon as they are uploaded.\n    * `max_size: 100` -> The maximum size for packaged files in Megabytes prior to compression. The default is 100, with a minimum of 1 and maximum of 100.\n  * `prometheus_config`:\n    * `collect_previous_data: true` -> Toggle for collecting all available data in Prometheus **upon CostManagementMetricsConfig creation** (This parameter will start to appear in CostManagementMetricsConfigs that were created prior to v2.0.0 but will not have any effect unless the CostManagementMetricsConfig is deleted and recreated). The default is `true`. The operator will first look for a `retention` period in the `cluster-monitoring-config` ConfigMap in the `openshift-monitoring` namespace and gather data over this time period up to a maximum of 90 days. If this configuration is not set, the default is 14 days. (New in v2.0.0)\n    * `disable_metrics_collection_cost_management: false` -> Toggle for disabling the collection of metrics for Cost Management. The default is false. (New in v2.0.0)\n    * `disable_metrics_collection_resource_optimization: false` -> Toggle for disabling the collection of metrics for Resource Optimization. The default is false. (New in v2.0.0)\n    * `context_timeout: 120` -> The time in seconds before Prometheus queries timeout due to exceeding context timeout. The default is 120, with a minimum of 10 and maximum of 180.\n  * `source`:\n    * `name: ''` -> The name of the integration the operator will create in `console.redhat.com`. If the name value is empty, the default intergration name is the **cluster id**.\n    * `create_source: false` -> Toggle for whether or not the operator will create the integration in `console.redhat.com`. The default is False. This parameter should be switched to True when an integration does not already exist in `console.redhat.com` for this cluster.\n    * `check_cycle: 1440` -> The time in minutes to wait between checking if an integration exists for this cluster. The default is 1440 minutes (24 hrs).\n  * `upload`:\n    * `upload_cycle: 360` -> The time in minutes between payload uploads. The default is 360 (6 hours), minimum is 60 (1 hour).\n    * `upload_toggle: true` -> Toggle to turn upload on or off -> true means upload, false means do not upload (false == air-gapped mode). The default is `true`.\n    * `upload_wait` -> The amount of time (in seconds) to pause before uploading a payload. The default is a random number between 0 and 35. This is used to decrease service load, but may be set to `0` if desired.\n  * `volume_claim_template` -> see the \"Storage configuration prerequisite\" section above.\n\n## Configure the costmanagement-metrics-operator\n**Note** There are separate instructions for configuring the `costmanagement-metrics-operator` to run in a restricted network.\n##### Configure authentication\nThe default authentication for the operator is `token`. No further steps are required to configure token authentication. If `basic` (deprecated) or `service-account` is the preferred authentication method, a Secret which holds the credentials must be created:\n1. On the left navigation pane, select `Workloads` -> `Secrets` -> select Project: `costmanagement-metrics-operator` -> `Create` -> `Key/Value Secret`\n2. Give the Secret a name and add 2 keys (all lowercase) for the respective authentication type. The values for these keys correspond to console.redhat.com credentials:\n    * basic auth (deprecated): `username` and `password`\n    * service-account auth: `client_id` and `client_secret`\n\n3. Select `Create`.\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. For `basic` (deprecated) or `service-account` authentication, edit the following values in the spec:\n    * Replace `authentication: type:` with `basic` or `service-account`.\n    * Add the `secret_name` field under `authentication`, and set it equal to the name of the authentication Secret that was created above. The spec should look similar to the following:\n\n        * for basic auth type (deprecated)\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: basic\n        ```\n\n        * for service-account auth type\n        ```\n          authentication:\n            secret_name: SECRET-NAME\n            type: service-account\n        ```\n\n3. To configure the costmanagement-metrics-operator to create a cost management integration, edit the following values in the `source` field:\n    * Replace the `name` field value with the preferred name of the integration to be created.\n    * Replace the `create_source` field value with `true`.\n\n    **Note:** if the integration already exists, replace the empty string value of the `name` field with the existing name, and leave `create_source` as false. This will allow the operator to confirm that the integration exists.\n\n4. If not specified, the operator will create a default PersistentVolumeClaim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec:\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n5. Select `Create`.\n\n# Restricted Network Usage (disconnected/air-gapped mode)\n## Installation\nTo install the `costmanagement-metrics-operator` in a restricted network, follow the [olm documentation](https://docs.openshift.com/container-platform/latest/operators/admin/olm-restricted-networks.html). The operator is found in the `community-operators` Catalog in the `registry.redhat.io/redhat/community-operator-index:latest` Index. If pruning the index before pushing to the mirrored registry, keep the `costmanagement-metrics-operator` package.\n\nWithin a restricted network, the operator queries prometheus to gather the necessary usage metrics, writes the query results to CSV files, and packages the reports for storage in the PVC. These reports then need to be manually downloaded from the cluster and uploaded to [console.redhat.com](https://console.redhat.com).\n\n## Configure the costmanagement-metrics-operator for a restricted network\n##### Create the CostManagementMetricsConfig\nConfigure the costmanagement-metrics-operator by creating a `CostManagementMetricsConfig`.\n1. On the left navigation pane, select `Operators` -> `Installed Operators` -> `costmanagement-metrics-operator` -> `CostManagementMetricsConfig` -> `Create Instance`.\n2. Specify the desired storage. If not specified, the operator will create a default Persistent Volume Claim called `costmanagement-metrics-operator-data` with 10Gi of storage. To configure the costmanagement-metrics-operator to use or create a different PVC, edit the following in the spec:\n    * Add the desired configuration to the `volume_claim_template` field in the spec (below is only a template. Any _valid_ `PersistentVolumeClaim` may be defined here):\n\n      ```\n        volume_claim_template:\n          apiVersion: v1\n          kind: PersistentVolumeClaim\n          metadata:\n            name: <insert-name>\n          spec:\n            storageClassName: <insert-class-name>\n            accessModes:\n              - ReadWriteOnce\n            resources:\n              requests:\n                storage: 10Gi\n      ```\n\n    **Note:** If using the YAML View, the `volume_claim_template` field must be added to the spec\n3. (Optional) Specify the desired report retention. The operator will retain 30 reports by default. This corresponds to approximately one week's worth of data if using the default packaging cycle. To modify the number of retained reports:\n    * Change the `packaging` spec field `max_reports_to_store` to the desired number of reports to retain. Once this max number is reached, the operator will start removing the oldest packages remaining on the PVC:\n\n      ```\n        packaging:\n          max_size_MB: 100\n          max_reports_to_store: 30\n      ```\n\n    **Note:** The number of retained reports directly affects the frequency that reports must be manually downloaded from the PVC. Take caution in setting this to a higher number of reports, as the operator cannot write data to the PVC if the storage is full.\n4. To configure the operator to perform in a restricted network, set the `upload_toggle` to `false`:\n\n  ```\n    upload:\n      upload_cycle: 360\n      upload_toggle: false\n  ```\n\n5. Select `Create`.\n\n## Download reports from the Operator & clean up the PVC\nIf the `costmanagement-metrics-operator` is configured to run in a restricted network, the metric reports will not automatically upload to cost managment. Instead, they need to be manually copied from the PVC for upload to [console.redhat.com](https://console.redhat.com). The default configuration saves one week of reports which means the process of downloading and uploading reports should be repeated weekly to prevent loss of metrics data. To download the reports, complete the following steps:\n1. Create the following Pod, ensuring the `claimName` matches the PVC containing the report data:\n\n  ```\n    kind: Pod\n    apiVersion: v1\n    metadata:\n      name: volume-shell\n      namespace: costmanagement-metrics-operator\n      labels:\n        app: costmanagement-metrics-operator\n    spec:\n      volumes:\n      - name: costmanagement-metrics-operator-reports\n        persistentVolumeClaim:\n          claimName: costmanagement-metrics-operator-data\n      containers:\n      - name: volume-shell\n        image: busybox\n        command: ['sleep', 'infinity']\n        volumeMounts:\n        - name: costmanagement-metrics-operator-reports\n          mountPath: /tmp/costmanagement-metrics-operator-reports\n  ```\n\n2. Use rsync to copy all of the files ready for upload from the PVC to a local folder:\n\n  ```\n  $ oc rsync volume-shell:/tmp/costmanagement-metrics-operator-reports/upload local/path/to/save/folder\n  ```\n\n3. Once confirming that the files have been successfully copied, use rsh to connect to the pod and delete the contents of the upload folder so that they are no longer in storage:\n\n  ```\n  $ oc rsh volume-shell\n  $ rm /tmp/costmanagement-metrics-operator-reports/upload/*\n  ```\n\n4. (Optional) Delete the pod that was used to connect to the PVC:\n\n  ```\n  $ oc delete -f volume-shell.yaml\n  ```\n\n## Create an Integration\nIn a restricted network, the `costmanagement-metrics-operator` cannot automatically create an integration. This process must be done manually. In the console.redhat.com platform, open the [Integrations menu](https://console.redhat.com/settings/integrations/) to begin adding an OpenShift integration to Cost Management:\n\nPrerequisites:\n* The cluster identifier which can be found in the CostManagementMetricsConfig CR, the cluster Overview page, or the cluster Help > About.\n\nCreating an integration:\n1. Navigate to the Integrations menu\n2. Select the `Red Hat` tab\n3. Create a new `Red Hat Openshift Container Platform` integration:\n    * give the integration a unique name\n    * add the Cost Management application\n    * add the cluster identifier\n4. In the Source wizard, review the details and click `Finish` to create the source.\n\n## Upload the reports to cost managment\nUploading reports to cost managment is done through curl:\n\n    $ curl -vvvv -F \"file=@FILE_NAME.tar.gz;type=application/vnd.redhat.hccm.tar+tgz\" https://console.redhat.com/api/ingress/v1/upload -H \"Authorization: Bearer ${ACCESS_TOKEN}\"\n\nwhere `FILE_NAME` is the name of the report to upload. The `ACCESS_TOKEN` is acquired using a [service-account](https://access.redhat.com/articles/7036194).\n",
        "displayName": "Cost Management Metrics Operator",
        "installModes": [
          {
            "type": "OwnNamespace",
            "supported": true
          },
          {
            "type": "SingleNamespace",
            "supported": true
          },
          {
            "type": "MultiNamespace",
            "supported": false
          },
          {
            "type": "AllNamespaces",
            "supported": false
          }
        ],
        "keywords": [
          "cost",
          "management",
          "usage",
          "monitor"
        ],
        "labels": {
          "operatorframework.io/arch.amd64": "supported",
          "operatorframework.io/arch.arm64": "supported",
          "operatorframework.io/arch.ppc64le": "supported",
          "operatorframework.io/arch.s390x": "supported",
          "operatorframework.io/os.linux": "supported"
        },
        "links": [
          {
            "name": "Cost Management Metrics Operator source code repository",
            "url": "https://github.com/project-koku/koku-metrics-operator"
          }
        ],
        "maintainers": [
          {
            "name": "costmanagement",
            "email": "costmanagement@redhat.com"
          }
        ],
        "maturity": "alpha",
        "minKubeVersion": "1.24.0",
        "provider": {
          "name": "Red Hat"
        }
      }
    }
  ],
  "relatedImages": [
    {
      "name": "",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-operator-bundle@sha256:01cab18a6af3cc819a936ce434004d5dce4495474e62bc116643eb753c25cd91"
    },
    {
      "name": "costmanagement-metrics-rhel8-operator-f03828d6e5c1d0aef3a10230f5199ac768328535cde12b594920b98106845477-annotation",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:f03828d6e5c1d0aef3a10230f5199ac768328535cde12b594920b98106845477"
    },
    {
      "name": "manager",
      "image": "registry.redhat.io/costmanagement/costmanagement-metrics-rhel8-operator@sha256:f03828d6e5c1d0aef3a10230f5199ac768328535cde12b594920b98106845477"
    }
  ]
}
