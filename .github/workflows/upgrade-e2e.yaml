name: upgrade-e2e

on:
  workflow_dispatch:
  pull_request:
  merge_group:
  push:
    branches:
      - main

jobs:
  upgrade-e2e:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    - uses: actions/setup-go@v5
      with:
        go-version-file: go.mod

    - name: Run the upgrade e2e test
      run: ARTIFACT_PATH=/tmp/artifacts make test-upgrade-e2e

    - uses: cytopia/upload-artifact-retry-action@v0.1.7
      if: failure()
      with:
        name: upgrade-e2e-artifacts
        path: /tmp/artifacts/
